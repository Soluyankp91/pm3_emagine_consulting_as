<div class="workflow-sales">
    <ng-container *ngIf="(activeSideSection.typeId !== workflowSideSections.TerminateWorkflow) && (activeSideSection.typeId !== workflowSideSections.TerminateConsultant); else terminationTemplate">
        <form [formGroup]="salesMainDataForm" id="mainData" class="workflow-form workflow-form--main u-w--100">
            <ng-container *ngIf="(activeSideSection.typeId === workflowSideSections.StartConsultantPeriod) || (activeSideSection.typeId === workflowSideSections.ChangeConsultantPeriod) || (activeSideSection.typeId === workflowSideSections.ExtendConsultantPeriod); else startClientPeriodTemplate">
                <div fxLayout="column" fxLayoutAlign="start start" class="workflow-sales--process-data u-w--100" id="salesMainDataAnchor">
                    <h1 class="workflow-section--header-main">Main data</h1>
                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100 u-mb--10  u-mt--10">
                        <mat-form-field appearance="outline" class="textarea-input formFieldNoMarginPadding  form-width-559" [ngClass]="{'disabled-input': readOnlyMode}">
                            <mat-label>Remarks</mat-label>
                            <textarea required matInput autocomplete="new-password" name="remarks" formControlName="remarks" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2" [disabled]="readOnlyMode">
                            </textarea>
                            <mat-error>
                                <app-validator [control]="salesMainDataForm.remarks"></app-validator>
                            </mat-error>
                        </mat-form-field>
                    </div>
                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--20" [fxHide]="readOnlyMode && !salesMainDataForm.noRemarks?.value">
                        <mat-checkbox color="accent" [disabled]="readOnlyMode" formControlName="noRemarks" name="noRemarks" class="black-checkbox" (change)="disableOrEnableInput(salesMainDataForm.noRemarks?.value, salesMainDataForm.remarks)">
                            None
                        </mat-checkbox>
                    </div>
                </div>
            </ng-container>
            <ng-template #startClientPeriodTemplate>
                <div fxLayout="column" fxLayoutAlign="start start" class="workflow-sales--process-data u-w--100" id="salesMainDataAnchor">
                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                        <div fxLayout="row" fxLayoutAlign="space-between center" class="u-w--100">
                            <h1 class="workflow-section--header-main">Main data</h1>
                            <ng-container *ngIf="readOnlyMode">
                                <div fxLayout="row" fxLayoutAlign="start start">
                                    <ng-container *ngIf="canToggleEditMode">
                                        <button
                                            class="absolute-edit-toggle contract-manager-action u-mr--8"
                                            mat-icon-button
                                            appPreventDoubleClick (throttledClick)="toggleEditMode()">
                                            <mat-icon svgIcon="edit-icon"></mat-icon>
                                        </button>
                                    </ng-container>
                                    <button mat-icon-button appPreventDoubleClick (throttledClick)="$event.stopPropagation();" type="button" [matMenuTriggerFor]="returnToSalesMenu" class="three-dots-actions-btn contract-manager-action">
                                        <mat-icon svgIcon="3-dots"></mat-icon>
                                    </button>
                                    <mat-menu #returnToSalesMenu>
                                        <div class="u-w--100 u-h--100"
                                            [matTooltip]="permissionsForCurrentUser!['Reopen'] ? '' : 'Not available after the Contracts step has been completed'"
                                            matTooltipClass="white-tooltip">
                                            <button
                                                class="menu-item menu-item--edit contract-manager-action"
                                                mat-menu-item
                                                [disabled]="!permissionsForCurrentUser!['Reopen']"
                                                appPreventDoubleClick (throttledClick)="returnToSales()">
                                                <mat-icon svgIcon="return-icon"></mat-icon>
                                                Return to Sales
                                            </button>
                                        </div>
                                    </mat-menu>
                                </div>
                            </ng-container>
                        </div>
                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16" id="salesMainProject">
                            <span class="workflow-section--number">1</span>
                            <h2 class="workflow-section--header">Project</h2>
                        </div>
                        <div class="workflow-section--content">
                            <ng-container *ngIf="activeSideSection.typeId === workflowSideSections.StartClientPeriod || activeSideSection.typeId === workflowSideSections.ExtendClientPeriod || activeSideSection.typeId === workflowSideSections.ChangeClientPeriod">
                                <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mt--10">
                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-235">
                                        <mat-label>Project Type (Legacy)</mat-label>
                                        <mat-select required [disabled]="readOnlyMode" formControlName="projectType" [disableOptionCentering]="true" [compareWith]="compareWithFn" (selectionChange)="getDataBasedOnProjectType($event)">
                                            <ng-container *ngFor="let item of projectTypes; trackBy: trackById">
                                                <mat-option [value]="item">
                                                    {{ item.name }}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error>
                                            <app-validator [control]="salesMainDataForm.projectType"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-150">
                                        <mat-label>Sales Type</mat-label>
                                        <mat-select required [disabled]="readOnlyMode" formControlName="salesType" [disableOptionCentering]="true" [compareWith]="compareWithFn" (selectionChange)="salesTypeChange($event.value)">
                                            <ng-container *ngFor="let item of saleTypes; trackBy: trackById">
                                                <mat-option [value]="item">
                                                    {{ item.name }}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error>
                                            <app-validator [control]="salesMainDataForm.salesType"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-150">
                                        <mat-label>Delivery Type</mat-label>
                                        <mat-select required [disabled]="readOnlyMode" formControlName="deliveryType" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                            <ng-container *ngFor="let item of deliveryTypes; trackBy: trackById">
                                                <ng-container *ngIf="(item?.id === 1 && salesMainDataForm.salesType?.value?.id === 3) || (item?.id !== 1 && salesMainDataForm.salesType?.value?.id !== 3)">
                                                    <mat-option [value]="item">
                                                        {{ item.name }}
                                                    </mat-option>
                                                </ng-container>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error>
                                            <app-validator [control]="salesMainDataForm.deliveryType"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                                <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-235">
                                        <mat-label>Project Category</mat-label>
                                        <mat-select required formControlName="projectCategory" [disableOptionCentering]="true" [compareWith]="compareWithFn" [disabled]="readOnlyMode">
                                            <ng-container *ngFor="let item of projectCategories; trackBy: trackById">
                                                <mat-option [value]="item">
                                                    {{ item.name }}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error>
                                            <app-validator [control]="salesMainDataForm.projectCategory"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-150">
                                        <mat-label>Margin</mat-label>
                                        <mat-select [disabled]="readOnlyMode" formControlName="margin" [disableOptionCentering]="true" [compareWith]="compareWithFn" required>
                                            <mat-option class="mat-select-clear-option">
                                                Clear
                                            </mat-option>
                                            <ng-container *ngFor="let item of margins; trackBy: trackById">
                                                <mat-option [value]="item">
                                                    {{ item.name }}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error>
                                            <app-validator [control]="salesMainDataForm.margin"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                            </ng-container>

                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding textarea-input form-width-559" [ngClass]="{'disabled-input': readOnlyMode}">
                                    <mat-label>Project Name</mat-label>
                                    <textarea matInput [disabled]="readOnlyMode" autocomplete="new-password" name="projectName" required formControlName="projectName" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                                    </textarea>
                                    <mat-error>
                                        <app-validator [control]="salesMainDataForm.projectName"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                            </div>

                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding textarea-input form-width-559" [ngClass]="{'disabled-input': readOnlyMode}">
                                    <mat-label>Project Description</mat-label>
                                    <textarea matInput [disabled]="readOnlyMode" autocomplete="new-password" name="projectDescription" required formControlName="projectDescription" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                                    </textarea>
                                    <mat-error>
                                        <app-validator [control]="salesMainDataForm.projectDescription"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesMainInvoicing">
                        <div fxLayout="row" fxLayoutAlign="start start" class="u-mt--16 u-mb--16">
                            <span class="workflow-section--number">2</span>
                            <h2 class="workflow-section--header">Invoicing</h2>
                        </div>
                        <div class="workflow-section--content">
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--10">
                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-150">
                                    <mat-label>Discounts</mat-label>
                                    <mat-select [disabled]="readOnlyMode" formControlName="discounts" [disableOptionCentering]="true" [compareWith]="compareWithFn" required>
                                        <mat-option class="mat-select-clear-option">
                                            Clear
                                        </mat-option>
                                        <ng-container *ngFor="let item of discounts; trackBy: trackById">
                                            <mat-option [value]="item">
                                                {{ item.name }}
                                            </mat-option>
                                        </ng-container>
                                    </mat-select>
                                    <mat-error>
                                        <app-validator [control]="salesMainDataForm.discounts"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                            <div class="inline-edit-form u-w--100">
                                <ng-container *ngIf="salesMainDataForm.commissions?.controls?.length">
                                    <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px" class="workflow-sales-inline--form__header-container u-w--100">
                                        <span fxFlex="10%" class="workflow-sales-inline--form__header u-w--100">
                                            Type
                                        </span>
                                        <span fxFlex="10%" class="workflow-sales-inline--form__header u-w--100">
                                            Value
                                        </span>
                                        <span fxFlex="10%" class="workflow-sales-inline--form__header u-w--100">
                                            Currency
                                        </span>
                                        <span fxFlex="10%" class="workflow-sales-inline--form__header u-w--100">
                                            Recipient type
                                        </span>
                                        <span fxFlex="1 0 30%" class="workflow-sales-inline--form__header u-w--100">
                                            Recipient
                                        </span>
                                        <span fxFlex="20%" class="workflow-sales-inline--form__header u-w--100">
                                            Frequency
                                        </span>
                                        <span fxFlex="10%" class="workflow-sales-inline--form__header u-w--100" [fxHide]="readOnlyMode">

                                        </span>
                                    </div>
                                </ng-container>
                                <ng-container formArrayName="commissions" class="u-w--100">
                                    <ng-container *ngFor="let commission of salesMainDataForm.commissions.controls; index as i" [formArrayName]="i">
                                        <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px" class="workflow-sales-inline--form__row u-w--100">
                                            <ng-container *ngIf="salesMainDataForm.commissions.at(i).get('editable')?.value">
                                                <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="10%">
                                                    <mat-select required formControlName="type" placeholder="Type" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                        <ng-container *ngFor="let item of commissionTypes; trackBy: trackById">
                                                            <mat-option [value]="item">
                                                                {{ item.name }}
                                                            </mat-option>
                                                        </ng-container>
                                                    </mat-select>
                                                </mat-form-field>
                                                <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="10%">
                                                    <input required matInput type="number" formControlName="amount" placeholder="Value" />
                                                </mat-form-field>
                                                <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="10%">
                                                    <mat-select required formControlName="currency" placeholder="Currency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                        <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                            <mat-option [value]="item">
                                                                {{ item.name }}
                                                            </mat-option>
                                                        </ng-container>
                                                    </mat-select>
                                                </mat-form-field>
                                                <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="10%">
                                                    <mat-select formControlName="recipientType" placeholder="Recipient type" [disableOptionCentering]="true" (selectionChange)="commissionRecipientTypeChanged($event, i)" [compareWith]="compareWithFn">
                                                        <ng-container *ngFor="let item of commissionRecipientTypeList; trackBy: trackById">
                                                            <mat-option [value]="item">
                                                                {{ item.name }}
                                                            </mat-option>
                                                        </ng-container>
                                                    </mat-select>
                                                </mat-form-field>
                                                <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="30%" [ngClass]="{'disabled-autocomplete': commission.value.recipientType === null || commission.value.recipientType === ''}">
                                                    <!-- recipientType?.id === 4 - PDC entity -->
                                                    <ng-container *ngIf="commission.value.recipientType?.id === 4; else commissionRecipientAutocomplete">
                                                        <mat-select formControlName="recipient" placeholder="Recipient" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                            <ng-container *ngFor="let item of legalEntities; trackBy: trackById">
                                                                <mat-option [value]="item">
                                                                    <b>{{ item.tenantName + ' ' + '(' + item.name + ')' }}</b>
                                                                </mat-option>
                                                            </ng-container>
                                                        </mat-select>
                                                    </ng-container>
                                                    <ng-template #commissionRecipientAutocomplete>
                                                        <input #recipientFilterInput type="text" matInput [matAutocomplete]="recipientAutocomplete" formControlName="recipient" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Recipient">
                                                        <mat-autocomplete #recipientAutocomplete="matAutocomplete" [displayWith]="displayRecipientFn"
                                                            (optionSelected)="focusOutMethod()" (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                                            <ng-container>
                                                                <ng-container *ngFor="let recipient of filteredRecipients; trackBy: trackById">
                                                                    <mat-option [value]="recipient" [ngClass]="{ 'no-data': recipient.id === 'no-data' }">
                                                                        <ng-container [ngSwitch]="commission.value.recipientType?.id">
                                                                            <!-- 'Client' -->
                                                                            <span *ngSwitchCase="3">
                                                                                <div class="multilineDropdown-option--column">
                                                                                    <span class="multilineDropdown-option--column-client-name">{{ recipient.clientName }}</span>
                                                                                    <ng-container *ngIf="recipient.id !== 'no-data'">
                                                                                        <span class="multilineDropdown-option--column-client-info">
                                                                                            #{{recipient.clientId}} | {{recipient.city ?? ''}} {{recipient.countryName ? ', ' + recipient.countryName : ''}}
                                                                                        </span>
                                                                                    </ng-container>
                                                                                </div>
                                                                            </span>
                                                                            <!-- 'Supplier' -->
                                                                            <span *ngSwitchCase="1">
                                                                                <span class="autocopmlete-option-name">{{ recipient.supplierName }}</span>
                                                                            </span>
                                                                            <!-- 'Consultant' -->
                                                                            <span *ngSwitchCase="2">
                                                                                <div class="multilineDropdown-option--row">
                                                                                    <ng-container *ngIf="recipient.id !== 'no-data'">
                                                                                        <img class="image-settings u-mr--16" [src]="consultantProfileUrl(recipient.externalId!)" />
                                                                                    </ng-container>
                                                                                    <div class="multilineDropdown-option--column">
                                                                                        <span class="multilineDropdown-option--column-client-name">{{ recipient.name }}</span>
                                                                                        <ng-container *ngIf="recipient.id !== 'no-data'">
                                                                                            <span class="multilineDropdown-option--column-client-info">
                                                                                                {{recipient.companyName}} | {{recipient.city}} | #{{recipient.id}} / {{recipient.legacyId}}
                                                                                            </span>
                                                                                        </ng-container>
                                                                                    </div>
                                                                                </div>
                                                                            </span>
                                                                        </ng-container>
                                                                    </mat-option>
                                                                </ng-container>
                                                            </ng-container>
                                                        </mat-autocomplete>
                                                    </ng-template>
                                                </mat-form-field>
                                                <div fxFlex="20%">
                                                    <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="1 0 40%">
                                                        <mat-select formControlName="frequency" placeholder="Frequency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                            <ng-container *ngFor="let item of commissionFrequencies; trackBy: trackById">
                                                                <mat-option [value]="item">
                                                                    {{ item.name }}
                                                                </mat-option>
                                                            </ng-container>
                                                        </mat-select>
                                                    </mat-form-field>
                                                    <!--id = 2 == 'One time' -->
                                                    <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select formFieldDatePicker" fxFlex="0 0 60%" [fxHide]="commission.value.frequency?.id !== 2">
                                                        <input autocomplete="off" matInput
                                                                [required]="commission.value.frequency?.id === 2"
                                                                [matDatepicker]="oneTimeDatePicker"
                                                                placeholder="Date"
                                                                name="oneTimeDate" formControlName="oneTimeDate"
                                                                (focus)="oneTimeDatePicker.open()"
                                                                appPreventDoubleClick (throttledClick)="oneTimeDatePicker.open()" readonly>
                                                        <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                                                        <mat-datepicker #oneTimeDatePicker></mat-datepicker>
                                                    </mat-form-field>
                                                </div>
                                                <div fxFlex="10%" class="u-w--100 text-truncate-ellipsis" fxLayoutAlign="end center">
                                                    <button [disabled]="!salesMainDataForm.commissions.at(i).valid" mat-icon-button type="button" appPreventDoubleClick (throttledClick)="editOrSaveCommissionRow(i)" class="rates-and-fees--inline-edit-form--btn__save">
                                                        <mat-icon svgIcon="rates-save-icon"></mat-icon>
                                                    </button>
                                                    <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="isCommissionInitialAdd ? removeCommission(i) : cancelEditCommissionRow(i)" class="rates-and-fees--inline-edit-form--btn__cancel">
                                                        <mat-icon svgIcon="rates-cancel-icon"></mat-icon>
                                                    </button>
                                                </div>
                                            </ng-container>
                                            <ng-container *ngIf="!commission.value.editable">
                                                <span fxFlex="10%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="salesMainDataForm.commissions.at(i).get('type')?.value?.name" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                    {{commission.value.type?.name}}
                                                </span>
                                                <span fxFlex="10%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="salesMainDataForm.commissions.at(i).get('amount')?.value" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                    {{commission.value.amount}}
                                                </span>
                                                <span fxFlex="10%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="salesMainDataForm.commissions.at(i).get('currency')?.value?.name" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                    {{commission.value.currency?.name}}
                                                </span>
                                                <span fxFlex="10%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="salesMainDataForm.commissions.at(i).get('recipientType')?.value?.name" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                    {{commission.value.recipientType?.name}}
                                                </span>
                                                <span fxFlex="1 0 30%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="salesMainDataForm.commissions.at(i).get('recipient')?.value?.name" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                    <ng-container [ngSwitch]="commission.value.recipientType?.name">
                                                        <ng-container *ngSwitchCase="'Client'">
                                                            <div fxLayout="row" fxLayoutAlign="start center">
                                                                <div fxLayout="column" fxLayoutAlign="start start">
                                                                    <span>
                                                                        {{commission.value.recipient?.clientName}}
                                                                    </span>
                                                                    <span>
                                                                        {{commission.value.recipient?.clientId ? '#' + commission.value.recipient?.clientId + ' | ' : ''}}
                                                                        {{commission.value.recipient?.city ? commission.value.recipient?.city + ' | ' : ''}}
                                                                        {{commission.value.recipient?.address ? commission.value.recipient?.address + ' | ' : ''}}
                                                                        {{commission.value.recipient?.address2 ? commission.value.recipient?.address2 + ' | ' : ''}}
                                                                        {{commission.value.recipient?.postCode}}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </ng-container>
                                                        <ng-container *ngSwitchCase="'Consultant'">
                                                            <div fxLayout="row" fxLayoutAlign="start center">
                                                                <!-- FIXME: use consultant info component -->
                                                                <div fxLayout="column" fxLayoutAlign="start start">
                                                                    <span>
                                                                        {{commission.value.recipient?.name}}
                                                                    </span>
                                                                    <span>
                                                                        {{commission.value.recipient?.companyName ? commission.value.recipient?.companyName + ' | ' : ''}}
                                                                        {{commission.value.recipient?.city ? commission.value.recipient?.city + ' | ' : ''}}
                                                                        #{{commission.value.recipient?.id}} / {{getTenantCodeFromId(commission.value.recipient?.tenantId) + '-' +commission.value.recipient?.legacyId}}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </ng-container>
                                                        <ng-container *ngSwitchCase="'Supplier'">
                                                            {{commission.value.recipient?.supplierName}}
                                                        </ng-container>
                                                        <ng-container *ngSwitchCase="'PDC entity'">
                                                            {{commission.value.recipient?.tenantName + ' ' + '(' + commission.value.recipient?.name + ')'}}
                                                        </ng-container>
                                                    </ng-container>
                                                </span>
                                                <span fxFlex="20%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="salesMainDataForm.commissions.at(i).get('frequency')?.value?.name" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                    <!-- frequency id === 2 -- 'One time' -->
                                                    <ng-container *ngIf="salesMainDataForm.commissions.at(i).get('frequency')?.value?.id === 2; else commissionFrequency">
                                                        {{salesMainDataForm.commissions.at(i).get('frequency')?.value?.name}} {{salesMainDataForm.commissions.at(i).get('oneTimeDate')?.value | momentFormat}}
                                                    </ng-container>
                                                    <ng-template #commissionFrequency>
                                                        {{salesMainDataForm.commissions.at(i).get('frequency')?.value?.name}}
                                                    </ng-template>
                                                </span>
                                                <div fxFlex="10%" fxLayoutAlign="end center" class="u-w--100" [fxHide]="readOnlyMode">
                                                    <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="$event.stopPropagation();" [matMenuTriggerFor]="commissionMenu" class="three-dots-actions-btn">
                                                        <mat-icon svgIcon="3-dots"></mat-icon>
                                                    </button>
                                                    <mat-menu #commissionMenu>
                                                        <button
                                                            class="menu-item green-color"
                                                            mat-menu-item
                                                            [disabled]="isCommissionEditing"
                                                            appPreventDoubleClick (throttledClick)="editOrSaveCommissionRow(i)">
                                                            <mat-icon svgIcon="edit-icon-green"></mat-icon>
                                                            Edit
                                                        </button>
                                                        <button
                                                            class="menu-item menu-item--cancel"
                                                            mat-menu-item
                                                            appPreventDoubleClick (throttledClick)="removeCommission(i)">
                                                            <mat-icon svgIcon="close-icon"></mat-icon>
                                                            Remove
                                                        </button>
                                                    </mat-menu>
                                                </div>
                                            </ng-container>
                                        </div>
                                    </ng-container>
                                </ng-container>
                                <ng-container *ngIf="!readOnlyMode">
                                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                        <button class="button-add" mat-flat-button type="button" [disabled]="isCommissionEditing"
                                            appPreventDoubleClick (throttledClick)="addCommission(true)">
                                            <mat-icon>add</mat-icon>
                                            Add commission
                                        </button>
                                    </div>
                                </ng-container>
                            </div>
                        </div>
                    </div>

                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100 u-mb--20" id="salesMainAccountManager">
                        <div fxLayout="row" fxLayoutAlign="start start" class="u-mt--16 u-mb--16">
                            <span class="workflow-section--number">3</span>
                            <h2 class="workflow-section--header">Account manager</h2>
                        </div>
                        <div class="workflow-section--content">
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-235" [ngClass]="{'disabled-input': readOnlyMode}">
                                    <mat-label>Sales Account Manager</mat-label>
                                    <input required [disabled]="readOnlyMode" #salesAccountManagerFilterInput type="text" matInput [matAutocomplete]="salesManagerAutocomplete" formControlName="salesAccountManagerIdValue" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Select account manager(s)">
                                    <mat-autocomplete #salesManagerAutocomplete="matAutocomplete" [displayWith]="displayNameFn"
                                        (optionSelected)="focusOutMethod()" (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                        <ng-container *ngFor="let manager of filteredSalesAccountManagers; trackBy: trackById">
                                            <mat-option [value]="manager" [ngClass]="{ 'no-data': manager.id === 'no-data' }">
                                                <span class="autocopmlete-option-name">{{ manager.name }}</span>
                                            </mat-option>
                                        </ng-container>
                                    </mat-autocomplete>
                                    <mat-error>
                                        <app-validator [control]="salesMainDataForm.salesAccountManagerIdValue"></app-validator>
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-235" [ngClass]="{'disabled-input': readOnlyMode}">
                                    <mat-label>Commission Account Manager</mat-label>
                                    <input #commissionManagerFilterInput type="text" [disabled]="readOnlyMode" matInput [matAutocomplete]="commissionManagerAutocomplete" formControlName="commissionAccountManagerIdValue" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Select account manager(s)">
                                        <mat-autocomplete #commissionManagerAutocomplete="matAutocomplete" [displayWith]="displayNameFn"
                                            (optionSelected)="focusOutMethod()" (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                            <ng-container *ngFor="let manager of filteredCommisionAccountManagers; trackBy: trackById">
                                                <mat-option [value]="manager" [ngClass]="{ 'no-data': manager.id === 'no-data' }">
                                                    <span class="autocopmlete-option-name">{{ manager.name }}</span>
                                                </mat-option>
                                            </ng-container>
                                        </mat-autocomplete>
                                </mat-form-field>
                            </div>
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--10">
                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-180">
                                    <mat-label>Expiration notification</mat-label>
                                    <mat-select [disabled]="readOnlyMode" formControlName="contractExpirationNotification" [disableOptionCentering]="true" [multiple]="true">
                                        <mat-option [value]="999">
                                            Manual date
                                        </mat-option>
                                        <ng-container *ngFor="let item of contractExpirationNotificationDuration | keyvalue">
                                            <mat-option [value]="+item.key">
                                                {{ item.value }}
                                            </mat-option>
                                        </ng-container>
                                    </mat-select>
                                </mat-form-field>
                                <ng-container *ngIf="salesMainDataForm.contractExpirationNotification?.value?.includes(999)">
                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding form-width-180" [ngClass]="{'disabled-input': readOnlyMode}">
                                        <mat-label>Expiration notification date</mat-label>
                                        <input [disabled]="readOnlyMode" autocomplete="off" matInput
                                                [matDatepicker]="customContractExpirationNotificationDatePicker"
                                                name="customContractExpirationNotificationDate" formControlName="customContractExpirationNotificationDate"
                                                (focus)="customContractExpirationNotificationDatePicker.open()"
                                                appPreventDoubleClick (throttledClick)="customContractExpirationNotificationDatePicker.open()" readonly>
                                        <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                                        <mat-datepicker #customContractExpirationNotificationDatePicker></mat-datepicker>
                                    </mat-form-field>
                                </ng-container>
                            </div>
                            <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100 u-mb--10">
                                <ng-container formArrayName="commissionedUsers" class="u-w--100">
                                    <ng-container *ngFor="let user of salesMainDataForm.commissionedUsers.controls; index as i" [formArrayName]="i">
                                        <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--10">
                                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-235" [ngClass]="{'disabled-input': readOnlyMode}">
                                                <mat-label>Commissioned employee</mat-label>
                                                <input required [disabled]="readOnlyMode" #commissionedUserInput type="text" matInput [matAutocomplete]="commissionedUserAutocomplete" formControlName="commissionedUser" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Type something">
                                                <mat-autocomplete #commissionedUserAutocomplete="matAutocomplete" [displayWith]="displayNameFn"
                                                    (optionSelected)="focusOutMethod()" (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                                    <ng-container *ngFor="let employee of filteredEmployees; trackBy: trackById">
                                                        <mat-option [value]="employee" [ngClass]="{ 'no-data': employee.id === undefined }">
                                                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                                                <ng-container *ngIf="employee.id !== undefined">
                                                                    <img class="border-rounded-50 image-settings--dropdown u-mr--5"
                                                                        [src]="employeeProfileUrl(employee?.externalId!)" />
                                                                </ng-container>
                                                                <span class="autocopmlete-option-name">{{ employee.name }}</span>
                                                            </div>
                                                        </mat-option>
                                                    </ng-container>
                                                </mat-autocomplete>
                                                <mat-error>
                                                    <app-validator [control]="user.get('commissionedUser')"></app-validator>
                                                </mat-error>
                                            </mat-form-field>
                                            <ng-container *ngIf="!readOnlyMode">
                                                <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="removeCommissionedUser(i)" class="small-icon-button u-mt--8">
                                                    <mat-icon svgIcon="dialog-close-icon"></mat-icon>
                                                </button>
                                            </ng-container>
                                        </div>
                                    </ng-container>
                                </ng-container>
                                <ng-container *ngIf="!readOnlyMode">
                                    <button class="button-add u-mt--5" mat-flat-button type="button" appPreventDoubleClick (throttledClick)="addCommissionedUser()">
                                        <mat-icon>add</mat-icon>
                                        Add commissioned employee
                                    </button>
                                </ng-container>
                            </div>
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding textarea-input u-mr--12 form-width-559" [ngClass]="{'disabled-input': readOnlyMode}">
                                    <mat-label>Remarks</mat-label>
                                    <textarea [disabled]="readOnlyMode" required matInput autocomplete="new-password" name="remarks" formControlName="remarks" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                                    </textarea>
                                    <mat-error>
                                        <app-validator [control]="salesMainDataForm.remarks"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                                <ng-container *ngIf="!readOnlyMode || salesMainDataForm.noRemarks?.value">
                                    <mat-checkbox [disabled]="readOnlyMode" color="accent" formControlName="noRemarks" name="noRemarks" class="black-checkbox u-mt--8" (change)="disableOrEnableInput(salesMainDataForm.noRemarks?.value, salesMainDataForm.remarks)">
                                        None
                                    </mat-checkbox>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-template>
        </form>

        <ng-container *ngIf="(activeSideSection.typeId !== workflowSideSections.StartConsultantPeriod) && (activeSideSection.typeId !== workflowSideSections.ChangeConsultantPeriod) && (activeSideSection.typeId !== workflowSideSections.ExtendConsultantPeriod)">
            <form [formGroup]="salesClientDataForm" id="clientData" class="workflow-form workflow-form--client u-w--100" id="salesClientDataAnchor">
                <div fxLayout="column" fxLayoutAlign="start start" class="workflow-sales--process-data u-w--100">
                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientRelation">
                        <h1 class="workflow-section--header-main">Client data</h1>
                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                            <span class="workflow-section--number">1</span>
                            <h2 class="workflow-section--header">Client relation</h2>
                        </div>
                        <div class="workflow-section--content">
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-235">
                                    <mat-label>Client relation</mat-label>
                                    <mat-select [disabled]="readOnlyMode" formControlName="differentEndClient" [disableOptionCentering]="true" required>
                                        <mat-option [value]="false">
                                            Direct client
                                        </mat-option>
                                        <mat-option [value]="true">
                                            Different end-client
                                        </mat-option>
                                    </mat-select>
                                    <mat-error>
                                        <app-validator [control]="salesClientDataForm.differentEndClient"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                            <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding client-and-consultant-autocomplete" [ngClass]="{'disabled-input': readOnlyMode}">
                                        <mat-label>Direct client</mat-label>
                                        <input [disabled]="readOnlyMode" required #directClientFilterInput type="text" matInput [matAutocomplete]="directClientAutocomplete" formControlName="directClientIdValue" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Direct client name + address">
                                        <mat-autocomplete #directClientAutocomplete="matAutocomplete"
                                                        [displayWith]="displayClientNameFn"
                                                        (optionSelected)="directClientSelected($event)"
                                                        (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                            <ng-container *ngFor="let client of filteredDirectClients; trackBy: trackById">
                                                <mat-option [value]="client" [ngClass]="{ 'no-data': client.id === 'no-data' }">
                                                    <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                                        <span class="multilineDropdown-option--column-client-name">{{ client.clientName }}</span>
                                                        <ng-container *ngIf="client.id !== 'no-data'">
                                                            <span class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                                                #{{client.clientId}} | {{client.city ?? ''}} {{client.countryName ? ', ' + client.countryName : ''}}
                                                            </span>
                                                        </ng-container>
                                                    </div>
                                                </mat-option>
                                            </ng-container>
                                        </mat-autocomplete>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.directClientIdValue"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                                <ng-container [ngTemplateOutlet]="clientAdditionalInfo" [ngTemplateOutletContext]="{client: salesClientDataForm.directClientIdValue?.value}">
                                </ng-container>
                            </div>
                            <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" [fxHide]="!salesClientDataForm.differentEndClient?.value">
                                <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding client-and-consultant-autocomplete" [ngClass]="{'disabled-input': readOnlyMode}">
                                        <mat-label>End client</mat-label>
                                        <input [disabled]="readOnlyMode" [required]="salesClientDataForm.differentEndClient?.value" #endClientFilterInput type="text" matInput [matAutocomplete]="endClientAutocomplete" formControlName="endClientIdValue" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="End client name + address">
                                        <mat-autocomplete #endClientAutocomplete="matAutocomplete" [displayWith]="displayClientNameFn"
                                            (optionSelected)="focusOutMethod()" (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                            <ng-container *ngFor="let client of filteredEndClients; trackBy: trackById">
                                                <mat-option [value]="client" [ngClass]="{ 'no-data': client.id === 'no-data' }">
                                                    <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                                        <span class="multilineDropdown-option--column-client-name">{{ client.clientName }}</span>
                                                        <ng-container *ngIf="client.id !== 'no-data'">
                                                            <span class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                                                #{{client.clientId}} | {{client.city ?? ''}} {{client.countryName ? ', ' + client.countryName : ''}}
                                                            </span>
                                                        </ng-container>
                                                    </div>
                                                </mat-option>
                                            </ng-container>
                                        </mat-autocomplete>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.endClientIdValue"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                                <ng-container [ngTemplateOutlet]="clientAdditionalInfo" [ngTemplateOutletContext]="{client: salesClientDataForm.endClientIdValue?.value}">
                                </ng-container>
                            </div>
                        </div>
                    </div>
                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientProjectDuration">
                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                            <span class="workflow-section--number">2</span>
                            <h2 class="workflow-section--header">Client project duration</h2>
                        </div>
                        <div class="workflow-section--content">
                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                <mat-form-field appearance="outline" class="u-mr--12 formFieldNoMarginPadding form-width-150" [ngClass]="{'disabled-input': readOnlyMode}">
                                    <mat-label>Start date</mat-label>
                                    <input [disabled]="readOnlyMode" required autocomplete="off" matInput
                                            [matDatepicker]="clientContractStartDatePicker"
                                            name="clientContractStartDate" formControlName="clientContractStartDate"
                                            (focus)="clientContractStartDatePicker.open()"
                                            appPreventDoubleClick (throttledClick)="clientContractStartDatePicker.open()" readonly>
                                    <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                                    <mat-datepicker #clientContractStartDatePicker></mat-datepicker>
                                    <mat-error>
                                        <app-validator [control]="salesClientDataForm.clientContractStartDate"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                                <mat-form-field appearance="outline" class="u-mr--12 formFieldNoMarginPadding form-width-150" [ngClass]="{'disabled-input': readOnlyMode}">
                                    <mat-label>End date</mat-label>
                                    <input [disabled]="readOnlyMode" required autocomplete="off" matInput
                                            [matDatepicker]="clientContractEndDatePicker"
                                            name="clientContractEndDate" formControlName="clientContractEndDate"
                                            (focus)="clientContractEndDatePicker.open()"
                                            appPreventDoubleClick (throttledClick)="clientContractEndDatePicker.open()" readonly>
                                    <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                                    <mat-datepicker #clientContractEndDatePicker></mat-datepicker>
                                    <mat-error>
                                        <app-validator [control]="salesClientDataForm.clientContractEndDate"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                                <ng-container *ngIf="!readOnlyMode || salesClientDataForm.clientContractNoEndDate?.value">
                                    <mat-checkbox [disabled]="readOnlyMode" color="accent" formControlName="clientContractNoEndDate" name="clientContractNoEndDate" class="black-checkbox" (change)="disableOrEnableInput(salesClientDataForm.clientContractNoEndDate?.value, salesClientDataForm.clientContractEndDate)">
                                        No end date
                                    </mat-checkbox>
                                </ng-container>
                            </div>

                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--20">
                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-150">
                                    <mat-label>Option to extend</mat-label>
                                    <mat-select [disabled]="readOnlyMode" formControlName="noClientExtensionOption" [disableOptionCentering]="true" required>
                                        <mat-option [value]="false">
                                            Option to extend
                                        </mat-option>
                                        <mat-option [value]="true">
                                            No option
                                        </mat-option>
                                    </mat-select>
                                    <mat-error>
                                        <app-validator [control]="salesClientDataForm.noClientExtensionOption"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                                <ng-container *ngIf="!salesClientDataForm.noClientExtensionOption?.value">
                                    <mat-form-field appearance="outline" class="filter-select formFieldNoMarginPadding u-mr--12 form-width-150">
                                        <mat-label> Duration</mat-label>
                                        <mat-select [disabled]="readOnlyMode" [required]="!salesClientDataForm.noClientExtensionOption?.value" formControlName="clientExtensionDuration" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                            <ng-container *ngFor="let item of clientExtensionDurations; trackBy: trackById">
                                                <mat-option [value]="item">
                                                    {{ item.name }}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.clientExtensionDuration"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" class="filter-select formFieldNoMarginPadding u-mr--12 form-width-150">
                                        <mat-label> Deadline</mat-label>
                                        <mat-select [disabled]="readOnlyMode" [required]="!salesClientDataForm.noClientExtensionOption?.value" formControlName="clientExtensionDeadline" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                            <ng-container *ngFor="let item of clientExtensionDeadlines; trackBy: trackById">
                                                <mat-option [value]="item">
                                                    {{ item.name }}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.clientExtensionDeadline"></app-validator>
                                        </mat-error>
                                    </mat-form-field>

                                    <mat-form-field class="formFieldNoMarginPadding form-width-150" appearance="outline" [fxHide]="salesClientDataForm.clientExtensionDeadline?.value?.name !== 'Manual date'" [ngClass]="{'disabled-input': readOnlyMode}">
                                        <mat-label>Specific date</mat-label>
                                        <input [disabled]="readOnlyMode" [required]="salesClientDataForm.clientExtensionDeadline?.value?.name === 'Manual date'" autocomplete="off" matInput
                                                [matDatepicker]="clientExtensionEndDatePicker"
                                                name="clientExtensionEndDate" formControlName="clientExtensionEndDate"
                                                (focus)="clientExtensionEndDatePicker.open()"
                                                appPreventDoubleClick (throttledClick)="clientExtensionEndDatePicker.open()" readonly>
                                        <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                                        <mat-datepicker #clientExtensionEndDatePicker></mat-datepicker>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.clientExtensionEndDate"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                </ng-container>
                            </div>
                        </div>
                    </div>

                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientInvoicing">
                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                            <span class="workflow-section--number">3</span>
                            <h2 class="workflow-section--header">Client invoicing</h2>
                        </div>
                        <div class="workflow-section--content">
                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-312">
                                    <mat-label>emagine entity</mat-label>
                                    <mat-select [disabled]="readOnlyMode" required formControlName="pdcInvoicingEntityId" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                        <ng-container *ngFor="let item of legalEntities; trackBy: trackById">
                                            <mat-option [value]="item">
                                                {{ item.tenantName + ' ' + '(' + item.name + ')' }}
                                            </mat-option>
                                        </ng-container>
                                    </mat-select>
                                    <mat-error>
                                        <app-validator [control]="salesClientDataForm.pdcInvoicingEntityId"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                            <ng-container *ngIf="salesClientDataForm.value?.pdcInvoicingEntityId?.id">
                                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                    <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding client-and-consultant-autocomplete u-mr--12" [ngClass]="{'disabled-input': readOnlyMode}">
                                            <mat-label>Client invoicing recipient</mat-label>
                                            <input [disabled]="readOnlyMode" #clientInvoicingRecipientInput type="text" matInput [matAutocomplete]="clientInvoicingRecipientAutocomplete" formControlName="clientInvoicingRecipientIdValue" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Client invoicing recipient">
                                            <mat-autocomplete #clientInvoicingRecipientAutocomplete="matAutocomplete" [displayWith]="displayClientNameFn"
                                                (optionSelected)="focusOutMethod()" (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                                <ng-container *ngFor="let client of filteredClientInvoicingRecipients; trackBy: trackById">
                                                    <mat-option [value]="client" [ngClass]="{ 'no-data': client.id === 'no-data' }">
                                                        <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                                            <span class="multilineDropdown-option--column-client-name">{{ client.clientName }}</span>
                                                            <ng-container *ngIf="client.id !== 'no-data'">
                                                                <span class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                                                    #{{client.clientId}} | {{client.city ?? ''}} {{client.countryName ? ', ' + client.countryName : ''}}
                                                                </span>
                                                            </ng-container>
                                                        </div>
                                                    </mat-option>
                                                </ng-container>
                                            </mat-autocomplete>
                                            <mat-error>
                                                <app-validator [control]="salesClientDataForm.clientInvoicingRecipientIdValue"></app-validator>
                                            </mat-error>
                                        </mat-form-field>
                                        <ng-container *ngIf="!readOnlyMode || salesClientDataForm.clientInvoicingRecipientSameAsDirectClient?.value">
                                            <mat-checkbox [disabled]="readOnlyMode" color="accent" formControlName="clientInvoicingRecipientSameAsDirectClient" name="clientInvoicingRecipientSameAsDirectClient" class="black-checkbox" (change)="setValueAndToggleDisalbeState(salesClientDataForm.clientInvoicingRecipientSameAsDirectClient?.value, salesClientDataForm.clientInvoicingRecipientIdValue, salesClientDataForm.directClientIdValue?.value)">
                                                Same as direct client
                                            </mat-checkbox>
                                        </ng-container>
                                    </div>
                                    <ng-container [ngTemplateOutlet]="clientAdditionalInfo"
                                        [ngTemplateOutletContext]="{client: salesClientDataForm.clientInvoicingRecipientIdValue?.value}">
                                    </ng-container>
                                </div>
                                <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-150">
                                        <mat-label>Price type</mat-label>
                                        <mat-select [disabled]="readOnlyMode" required formControlName="clientRateAndInvoicing" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                            <ng-container *ngFor="let item of clientRateTypes; trackBy: trackById">
                                                <mat-option [value]="item">
                                                    {{ item.name }}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.clientRateAndInvoicing"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding u-mr--12 form-width-150" [ngClass]="{'disabled-input': readOnlyMode}">
                                        <mat-label>Rate</mat-label>
                                        <input [disabled]="readOnlyMode" required autocomplete="off" matInput formControlName="clientPrice" type="number">
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.clientPrice"></app-validator>
                                        </mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-150" [fxHide]="salesClientDataForm.clientRateAndInvoicing?.value?.id !== 1">
                                        <mat-label>Unit type</mat-label>
                                        <mat-select [disabled]="readOnlyMode" [required]="salesClientDataForm.clientRateAndInvoicing?.value?.id === 1" formControlName="rateUnitTypeId" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                            <ng-container *ngFor="let item of rateUnitTypes; trackBy: trackById">
                                                <mat-option [value]="item">
                                                    {{ item.name }}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.rateUnitTypeId"></app-validator>
                                        </mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-150">
                                        <mat-label>Currency</mat-label>
                                        <mat-select [disabled]="readOnlyMode" required formControlName="clientCurrency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                            <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                <mat-option [value]="item">
                                                    {{ item.name }}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.clientCurrency"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                                <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                    <mat-form-field appearance="outline" class="filter-select formFieldNoMarginPadding u-mr--12 form-width-150">
                                        <mat-label>Invoicing currency</mat-label>
                                        <mat-select [disabled]="readOnlyMode" required formControlName="clientInvoiceCurrency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                            <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                <mat-option [value]="item">
                                                    {{ item.name }}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.clientInvoiceCurrency"></app-validator>
                                        </mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-312" [ngClass]="{'u-mr--12': salesClientDataForm.clientInvoiceFrequency?.value?.name === 'Manual date'}" [fxHide]="salesClientDataForm.clientRateAndInvoicing?.value?.id !== 1">
                                        <mat-label>Invoicing frequency</mat-label>
                                        <mat-select [disabled]="readOnlyMode" [required]="salesClientDataForm.clientRateAndInvoicing?.value?.id === 1" formControlName="clientInvoiceFrequency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                            <ng-container *ngFor="let item of invoiceFrequencies; trackBy: trackById">
                                                <mat-option [value]="item">
                                                    {{ item.name }}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.clientInvoiceFrequency"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                    <mat-form-field class="formFieldNoMarginPadding form-width-150" [fxHide]="salesClientDataForm.clientInvoiceFrequency?.value?.name !== 'Manual date'" appearance="outline" [ngClass]="{'disabled-input': readOnlyMode}">
                                        <mat-label>Date</mat-label>
                                        <input [disabled]="readOnlyMode" [required]="salesClientDataForm.clientInvoiceFrequency?.value?.name === 'Manual date'" autocomplete="off" matInput
                                                [matDatepicker]="clientInvoicingDatePicker"
                                                name="clientInvoicingDate" formControlName="clientInvoicingDate"
                                                (focus)="clientInvoicingDatePicker.open()"
                                                appPreventDoubleClick (throttledClick)="clientInvoicingDatePicker.open()" readonly>
                                        <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                                        <mat-datepicker #clientInvoicingDatePicker></mat-datepicker>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.clientInvoicingDate"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-312" [ngClass]="{'u-mr--12': salesClientDataForm.clientInvoiceTime?.value?.name === 'Manual date' && salesClientDataForm.clientRateAndInvoicing?.value?.id === 2}" [fxHide]="salesClientDataForm.clientRateAndInvoicing?.value?.id !== 2">
                                        <mat-label>Invoicing time</mat-label>
                                        <mat-select [disabled]="readOnlyMode" [required]="salesClientDataForm.clientRateAndInvoicing?.value?.id === 2" formControlName="clientInvoiceTime" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                            <ng-container *ngFor="let item of invoicingTimes; trackBy: trackById">
                                                <mat-option [value]="item">
                                                    {{ item.name }}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.clientInvoiceTime"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                    <!-- id: 2 - manual date -->
                                    <mat-form-field class="formFieldNoMarginPadding form-width-150" [fxHide]="salesClientDataForm.clientRateAndInvoicing?.value?.id !== 2 || salesClientDataForm.clientInvoiceTime?.value?.name !== 'Manual date'" appearance="outline" [ngClass]="{'disabled-input': readOnlyMode}">
                                        <mat-label>Date</mat-label>
                                        <input [disabled]="readOnlyMode" [required]="salesClientDataForm.clientInvoiceTime?.value?.id === 2" autocomplete="off" matInput
                                                [matDatepicker]="clientInvoicingDateDatePicker"
                                                name="clientInvoicingDate" formControlName="clientInvoicingDate"
                                                (focus)="clientInvoicingDateDatePicker.open()"
                                                appPreventDoubleClick (throttledClick)="clientInvoicingDateDatePicker.open()" readonly>
                                        <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                                        <mat-datepicker #clientInvoicingDateDatePicker></mat-datepicker>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.clientInvoicingDate"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                            </ng-container>
                        </div>

                    </div>

                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientInvoicingNumber">
                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                            <span class="workflow-section--number">4</span>
                            <h2 class="workflow-section--header">Invoicing number</h2>
                        </div>
                        <div class="workflow-section--content">
                            <ng-container *ngIf="salesClientDataForm.value?.pdcInvoicingEntityId?.id">
                                <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding form-width-312" [ngClass]="{'disabled-input': readOnlyMode}">
                                        <mat-label>Invoicing Reference Number</mat-label>
                                        <input [disabled]="readOnlyMode" autocomplete="off" matInput formControlName="invoicingReferenceNumber" type="text">
                                    </mat-form-field>
                                </div>

                                <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-312" [ngClass]="{'disabled-input': readOnlyMode}">
                                        <mat-label>Invoice / Paperwork Contact</mat-label>
                                        <input [disabled]="readOnlyMode" required #invoicingReferencePersonInput type="text" matInput [matAutocomplete]="invoicingReferencePersonAutocomplete" formControlName="invoicePaperworkContactIdValue" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Invoice / Paperwork Contact">
                                        <mat-autocomplete #invoicingReferencePersonAutocomplete="matAutocomplete" [displayWith]="displayFullNameFn"
                                            (optionSelected)="focusOutMethod()" (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                            <ng-container *ngFor="let contact of filteredReferencePersons; trackBy: trackById">
                                                <mat-option [value]="contact" [ngClass]="{ 'no-data': contact.id === 'no-data' }">
                                                        <span class="autocopmlete-option-name">{{ contact.firstName + ' ' + contact.lastName }}</span>
                                                </mat-option>
                                            </ng-container>
                                        </mat-autocomplete>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.invoicePaperworkContactIdValue"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                            </ng-container>

                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-312">
                                    <mat-label>Shared cap on time reporting</mat-label>
                                    <mat-select [disabled]="readOnlyMode" required formControlName="capOnTimeReporting" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                        <ng-container *ngFor="let item of clientTimeReportingCap; trackBy: trackById">
                                            <mat-option [value]="item">
                                                {{ item.name }}
                                            </mat-option>
                                        </ng-container>
                                    </mat-select>
                                    <mat-error>
                                        <app-validator [control]="salesClientDataForm.capOnTimeReporting"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                            <!--not visible if 'Individual cap' Id = 3 'No cap' id = 4 -->
                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100" [fxHide]="salesClientDataForm.capOnTimeReporting?.value?.id === 3 || salesClientDataForm.capOnTimeReporting?.value?.id === 4">
                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding u-mr--12 form-width-150" [ngClass]="{'disabled-input': readOnlyMode}">
                                    <mat-label>Max value</mat-label>
                                    <input [disabled]="readOnlyMode" [required]="salesClientDataForm.capOnTimeReporting?.value?.id !== 3 && salesClientDataForm.capOnTimeReporting?.value?.id !== 4" autocomplete="off" matInput formControlName="capOnTimeReportingValue" type="number">
                                    <mat-error>
                                        <app-validator [control]="salesClientDataForm.capOnTimeReportingValue"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                                <span class="workflow-step-readonly--blue-text-bold">
                                    <ng-container [ngSwitch]="salesClientDataForm.capOnTimeReporting?.value?.id">
                                        <ng-container *ngSwitchCase="1">
                                            <!-- Cap on units -->
                                            <ng-container [ngSwitch]="salesClientDataForm.rateUnitTypeId?.value?.id">
                                                <ng-container *ngSwitchCase="1">
                                                    <!-- Per hour -->
                                                    hours
                                                </ng-container>
                                                <ng-container *ngSwitchCase="2">
                                                    <!-- Per day -->
                                                    days
                                                </ng-container>
                                                <ng-container *ngSwitchCase="4">
                                                    <!-- Per month -->
                                                    months
                                                </ng-container>
                                            </ng-container>
                                        </ng-container>
                                        <ng-container *ngSwitchCase="2">
                                            <!-- Cap on value -->
                                            {{salesClientDataForm.clientCurrency?.value?.name ?
                                            salesClientDataForm.clientCurrency?.value?.name : '-'}}
                                        </ng-container>
                                    </ng-container>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientRatesFees">
                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                            <span class="workflow-section--number">5</span>
                            <h2 class="workflow-section--header">Client rates and fees</h2>
                        </div>
                        <div class="workflow-section--content">
                            <div class="inline-edit-form u-w--100">
                                <ng-container *ngIf="salesClientDataForm.clientRates?.controls?.length">
                                    <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px" class="workflow-sales-inline--form__header-container u-w--100">
                                        <span fxFlex="1 0 35%" class="workflow-sales-inline--form__header u-w--100">
                                            Rate name
                                        </span>
                                        <span fxFlex="30%" class="workflow-sales-inline--form__header u-w--100">
                                            Reporting unit
                                        </span>
                                        <span fxFlex="25%" class="workflow-sales-inline--form__header u-w--100">
                                            Client rate
                                        </span>
                                        <span fxFlex="10%" class="workflow-sales-inline--form__header u-w--100" [fxHide]="readOnlyMode">
                                        </span>
                                    </div>
                                </ng-container>
                                <ng-container formArrayName="clientRates" class="u-w--100">
                                    <ng-container *ngFor="let rate of salesClientDataForm.clientRates.controls; index as i" [formArrayName]="i">
                                        <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px" class="workflow-sales-inline--form__row u-w--100">
                                            <ng-container>
                                                <span fxFlex="1 0 35%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="rate.value.rateName" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                    {{rate.value.rateName ?? '-'}}
                                                </span>
                                                <span fxFlex="30%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="rate.value.reportingUnit?.name" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                    {{rate.value.reportingUnit?.name ?? '-'}}
                                                </span>

                                                <ng-container *ngIf="rate.value.editable; else clientRateCurrencyDisplay">
                                                    <div fxFlex="25%" fxLayout="row" fxLayoutAlign="start start">
                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--10" fxFlex="30%">
                                                            <input required matInput type="number" placeholder="Rate" formControlName="clientRateValue">
                                                        </mat-form-field>
                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="50%">
                                                            <mat-select required formControlName="clientRateCurrency" placeholder="Currency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                    <mat-option [value]="item">
                                                                        {{ item.name }}
                                                                    </mat-option>
                                                                </ng-container>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>
                                                </ng-container>
                                                <ng-template #clientRateCurrencyDisplay>
                                                    <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="rate.value.clientRateValue + ' ' + rate.value.clientRateCurrency?.name" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                        {{rate.value.clientRateValue || rate.value.clientRateCurrency?.name ? rate.value.clientRateValue + ' ' + rate.value.clientRateCurrency?.name : '-'}}
                                                    </span>
                                                </ng-template>
                                                <ng-container *ngIf="rate.value.editable; else clientRateActionDisplay">
                                                    <div fxFlex="10%" class="u-w--100 text-truncate-ellipsis" fxLayoutAlign="end center" [fxHide]="readOnlyMode">
                                                        <button mat-icon-button type="button" [disabled]="!rate.valid" appPreventDoubleClick (throttledClick)="editOrSaveSpecialRate(rate.value.editable, i)" class="rates-and-fees--inline-edit-form--btn__save">
                                                            <mat-icon svgIcon="rates-save-icon"></mat-icon>
                                                        </button>
                                                        <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="cancelEditClientRate(i)" class="rates-and-fees--inline-edit-form--btn__cancel">
                                                            <mat-icon svgIcon="rates-cancel-icon"></mat-icon>
                                                        </button>
                                                    </div>
                                                </ng-container>
                                                <ng-template #clientRateActionDisplay>
                                                    <div fxFlex="10%" fxLayoutAlign="end center" class="u-w--100" [fxHide]="readOnlyMode">
                                                        <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="$event.stopPropagation();" [matMenuTriggerFor]="clientRateMenu" class="three-dots-actions-btn">
                                                            <mat-icon svgIcon="3-dots"></mat-icon>
                                                        </button>
                                                        <mat-menu #clientRateMenu>
                                                            <button
                                                                class="menu-item"
                                                                [ngClass]="salesClientDataForm.clientRates.at(i).get('editable')?.value ? 'menu-item--add': 'menu-item--edit'"
                                                                mat-menu-item
                                                                [disabled]="isClientRateEditing"
                                                                appPreventDoubleClick (throttledClick)="editOrSaveSpecialRate(rate.value.editable, i)">
                                                                <mat-icon svgIcon="edit-icon-green"></mat-icon>
                                                                Edit
                                                            </button>
                                                            <button
                                                                class="menu-item menu-item--cancel"
                                                                mat-menu-item
                                                                appPreventDoubleClick (throttledClick)="removeClientRate(i)">
                                                                <mat-icon svgIcon="close-icon"></mat-icon>
                                                                Delete
                                                            </button>
                                                        </mat-menu>
                                                    </div>
                                                </ng-template>
                                            </ng-container>
                                        </div>
                                    </ng-container>
                                    <ng-container *ngIf="salesClientDataForm.clientRates.controls?.length === 0 && readOnlyMode">
                                        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px" class="workflow-sales-inline--form__row u-w--100">
                                            <span>
                                                No client rates
                                            </span>
                                        </div>
                                    </ng-container>
                                </ng-container>
                            </div>
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-mb--10" [fxHide]="readOnlyMode">
                                <button class="rates-and-fees--btn button-add" mat-flat-button
                                    type="button" (menuOpened)="clientSpecialRateSelect.open();"
                                    [matMenuTriggerFor]="clientSpecialRateMenu" #clientRateMenuTrigger="matMenuTrigger" [disabled]="isClientRateEditing">
                                    <mat-icon>add</mat-icon>
                                    Add special rates
                                </button>
                                <mat-menu #clientSpecialRateMenu backdropClass="add-rates-button--menu">
                                    <div mat-menu-item appPreventDoubleClick (throttledClick)="$event.stopPropagation()"
                                        class="u-pg--0">
                                        <mat-form-field appearance="fill"
                                            class="add-rates-button--dropdown filter-select u-w--100">
                                            <mat-label>Choose special rate</mat-label>
                                            <mat-select #clientSpecialRateSelect [formControl]="clientSpecialRateFilter" [disableOptionCentering]="true">
                                                <ng-container *ngIf="clientSpecialRateList.length == 0">
                                                    <mat-option (click)="$event.stopPropagation();">
                                                        No results
                                                    </mat-option>
                                                </ng-container>
                                                <ng-container *ngFor="let item of clientSpecialRateList | excludeIds: salesClientDataForm!.clientRates?.value : 'clientSpecialRateId'; trackBy: trackById">
                                                    <mat-option [value]="item.id" appPreventDoubleClick (throttledClick)="selectClientSpecialRate($event, item, clientRateMenuTrigger)">
                                                        {{ item.internalName }}
                                                    </mat-option>
                                                </ng-container>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>
                                </mat-menu>
                            </div>
                            <div class="inline-edit-form u-w--100">
                                <ng-container *ngIf="salesClientDataForm.clientFees?.controls?.length">
                                    <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px" class="workflow-sales-inline--form__header-container u-w--100">
                                        <span fxFlex="1 0 35%" class="workflow-sales-inline--form__header u-w--100">
                                            Fee name
                                        </span>
                                        <span fxFlex="30%" class="workflow-sales-inline--form__header u-w--100">
                                            Frequency
                                        </span>
                                        <span fxFlex="25%" class="workflow-sales-inline--form__header u-w--100">
                                            Client fee
                                        </span>
                                        <span fxFlex="10%" class="workflow-sales-inline--form__header u-w--100" [fxHide]="readOnlyMode">
                                        </span>
                                    </div>
                                </ng-container>
                                <ng-container formArrayName="clientFees" class="u-w--100">
                                    <ng-container *ngFor="let fee of salesClientDataForm.clientFees.controls; index as i" [formArrayName]="i">
                                        <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px" class="workflow-sales-inline--form__row u-w--100">
                                            <ng-container>
                                                <span fxFlex="1 0 35%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="fee.value.feeName ?? '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                    {{fee.value.feeName ?? '-'}}
                                                </span>
                                                <span fxFlex="30%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="fee.value.feeFrequency?.name ?? '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                    {{fee.value.feeFrequency?.name ?? '-'}}
                                                </span>

                                                <ng-container *ngIf="fee.value.editable; else clientFeeCurrencyDisplay">
                                                    <div fxFlex="25%" fxLayout="row" fxLayoutAlign="start start">
                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--10" fxFlex="30%">
                                                            <input required matInput type="number" placeholder="Rate" formControlName="clientRateValue">
                                                        </mat-form-field>
                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="50%">
                                                            <mat-select required formControlName="clientRateCurrency" placeholder="Currency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                    <mat-option [value]="item">
                                                                        {{ item.name }}
                                                                    </mat-option>
                                                                </ng-container>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>
                                                </ng-container>
                                                <ng-template #clientFeeCurrencyDisplay>
                                                    <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="fee.value.clientRateValue + ' ' + fee.value.clientRateCurrency?.name" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                        {{fee.value.clientRateValue || fee.value.clientRateCurrency?.name ? fee.value.clientRateValue + ' ' + fee.value.clientRateCurrency?.name : '-'}}
                                                    </span>
                                                </ng-template>

                                                <ng-container *ngIf="fee.value.editable; else clientFeeActionDisplay">
                                                    <div fxFlex="10%" class="u-w--100 text-truncate-ellipsis" fxLayoutAlign="end center" [fxHide]="readOnlyMode">
                                                        <button mat-icon-button type="button" [disabled]="!fee.valid" appPreventDoubleClick (throttledClick)="editOrSaveClientFee(fee.value.editable, i)" class="rates-and-fees--inline-edit-form--btn__save">
                                                            <mat-icon svgIcon="rates-save-icon"></mat-icon>
                                                        </button>
                                                        <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="cancelEditClientFee(i)" class="rates-and-fees--inline-edit-form--btn__cancel">
                                                            <mat-icon svgIcon="rates-cancel-icon"></mat-icon>
                                                        </button>
                                                    </div>
                                                </ng-container>
                                                <ng-template #clientFeeActionDisplay>
                                                    <div fxFlex="10%" fxLayoutAlign="end center" class="u-w--100" [fxHide]="readOnlyMode">
                                                        <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="$event.stopPropagation();" [matMenuTriggerFor]="clientFeeMenu" class="three-dots-actions-btn">
                                                            <mat-icon svgIcon="3-dots"></mat-icon>
                                                        </button>
                                                        <mat-menu #clientFeeMenu>
                                                            <button
                                                                class="menu-item menu-item--edit"
                                                                mat-menu-item
                                                                [disabled]="isClientFeeEditing"
                                                                appPreventDoubleClick (throttledClick)="editOrSaveClientFee(fee.value.editable, i)">
                                                                <mat-icon svgIcon="edit-icon-green"></mat-icon>
                                                                Edit
                                                            </button>
                                                            <button
                                                                class="menu-item menu-item--cancel"
                                                                mat-menu-item
                                                                appPreventDoubleClick (throttledClick)="removeClientFee(i)">
                                                                <mat-icon svgIcon="close-icon"></mat-icon>
                                                                Delete
                                                            </button>
                                                        </mat-menu>
                                                    </div>
                                                </ng-template>
                                            </ng-container>
                                        </div>
                                    </ng-container>
                                    <ng-container *ngIf="salesClientDataForm.clientFees.controls?.length === 0 && readOnlyMode">
                                        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px" class="workflow-sales-inline--form__row u-w--100">
                                            <span>
                                                No client fees
                                            </span>
                                        </div>
                                    </ng-container>
                                </ng-container>
                            </div>
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-mb--20" [fxHide]="readOnlyMode">
                                <button
                                    class="rates-and-fees--btn button-add"
                                    mat-flat-button
                                    type="button"
                                    [disabled]="isClientFeeEditing"
                                    [matMenuTriggerFor]="clientSpecialFeeMenu"
                                    (menuOpened)="clientSpecialFeeFilter.setValue(''); clientSpecialFeeSelect.open()"
                                    #clientFeeMenuTrigger="matMenuTrigger">
                                    <mat-icon>add</mat-icon>
                                    Add special fees
                                </button>
                                <mat-menu #clientSpecialFeeMenu backdropClass="add-rates-button--menu">
                                    <div mat-menu-item appPreventDoubleClick (throttledClick)="$event.stopPropagation()"
                                        class="u-pg--0">
                                        <mat-form-field appearance="fill"
                                            class="add-rates-button--dropdown filter-select u-w--100">
                                            <mat-label>Choose special fee</mat-label>
                                            <mat-select #clientSpecialFeeSelect [formControl]="clientSpecialFeeFilter" [disableOptionCentering]="true">
                                                <ng-container *ngIf="clientSpecialFeeList.length == 0">
                                                    <mat-option (click)="$event.stopPropagation();">
                                                        No results
                                                    </mat-option>
                                                </ng-container>
                                                <ng-container *ngFor="let item of clientSpecialFeeList | excludeIds: salesClientDataForm!.clientFees?.value : 'clientSpecialFeeId'; trackBy: trackById">
                                                    <mat-option [value]="item.id" appPreventDoubleClick (throttledClick)="selectClientSpecialFee($event, item, clientFeeMenuTrigger)">
                                                        {{ item.internalName }}
                                                    </mat-option>
                                                </ng-container>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>
                                </mat-menu>
                            </div>
                        </div>
                    </div>
                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientEvaluation">
                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                            <span class="workflow-section--number">6</span>
                            <h2 class="workflow-section--header">Client evaluation</h2>
                        </div>
                        <div class="workflow-section--content">
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-150">
                                    <mat-label>Evaluations</mat-label>
                                    <mat-select [disabled]="readOnlyMode" required formControlName="evaluationsDisabled" [disableOptionCentering]="true">
                                        <mat-option [value]="false">
                                            Enable
                                        </mat-option>
                                        <mat-option [value]="true">
                                            Disable
                                        </mat-option>
                                    </mat-select>
                                    <mat-error>
                                        <app-validator [control]="salesClientDataForm.evaluationsDisabled"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                            </div>

                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--10">
                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-300" [fxHide]="salesClientDataForm.value?.evaluationsDisabled" [ngClass]="{'disabled-input': readOnlyMode}">
                                    <mat-label>Evaluation Reference Person</mat-label>
                                    <input [disabled]="readOnlyMode" [required]="!salesClientDataForm.value?.evaluationsDisabled" type="text" matInput [matAutocomplete]="evaluationReferencePersonAutocomplete" name="evaluationsReferencePerson" formControlName="evaluationsReferencePersonIdValue" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Final Evaluation Reference Person">
                                    <mat-autocomplete #evaluationReferencePersonAutocomplete="matAutocomplete" [displayWith]="displayFullNameFn"
                                        (optionSelected)="focusOutMethod()" (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                        <ng-container *ngFor="let contact of filteredEvaluationReferencePersons; trackBy: trackById">
                                            <mat-option [value]="contact" [ngClass]="{ 'no-data': contact.id === 'no-data' }">
                                                    <span class="autocopmlete-option-name">{{ contact.firstName + ' ' + contact.lastName }}</span>
                                            </mat-option>
                                        </ng-container>
                                    </mat-autocomplete>
                                    <mat-error>
                                        <app-validator [control]="salesClientDataForm.evaluationsReferencePersonIdValue"></app-validator>
                                    </mat-error>
                                </mat-form-field>

                                <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100" [fxHide]="!salesClientDataForm.value?.evaluationsDisabled">
                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding textarea-input form-width-559" [ngClass]="{'disabled-input': readOnlyMode}">
                                        <mat-label>Disable Evaluations Reason</mat-label>
                                        <textarea [disabled]="readOnlyMode" [required]="salesClientDataForm.value?.evaluationsDisabled" matInput autocomplete="new-password" name="evaluationsDisabledReason" formControlName="evaluationsDisabledReason" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                                        </textarea>
                                        <mat-error>
                                            <app-validator [control]="salesClientDataForm.evaluationsDisabledReason"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientContract">
                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                            <span class="workflow-section--number">7</span>
                            <h2 class="workflow-section--header">Client contract</h2>
                        </div>
                        <div class="workflow-section--content">
                            <div fxLayout="row" fxLayoutAlign="start start" fxLayoutGap="10px" class="u-w--100 u-mb--10">
                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding textarea-input form-width-559" [ngClass]="{'disabled-input': readOnlyMode}">
                                    <mat-label>Special Contract Terms</mat-label>
                                    <textarea [disabled]="readOnlyMode" required matInput autocomplete="new-password" name="specialContractTerms" formControlName="specialContractTerms" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                                    </textarea>
                                    <mat-error>
                                        <app-validator [control]="salesClientDataForm.specialContractTerms"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                                <ng-container *ngIf="!readOnlyMode || salesClientDataForm.noSpecialContractTerms?.value">
                                    <mat-checkbox [disabled]="readOnlyMode" color="accent" formControlName="noSpecialContractTerms" name="noSpecialContractTerms" class="black-checkbox u-mt--8" (change)="disableOrEnableInput(salesClientDataForm.noSpecialContractTerms?.value, salesClientDataForm.specialContractTerms)" >
                                        None
                                    </mat-checkbox>
                                </ng-container>
                            </div>
                            <h3 class="workflow-gray--header u-mb--10">Client Contract Signers</h3>
                            <div formArrayName="contractSigners" class="u-w--100 u-mb--10">
                                <ng-container *ngFor="let signer of contractSigners.controls; let i = index" [formGroupName]="i">
                                    <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100 u-mb--10">
                                        <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--16" fxFlex="33%" [ngClass]="{'disabled-input': readOnlyMode}">
                                            <mat-label>Name</mat-label>
                                            <input [disabled]="readOnlyMode" required type="text" matInput [matAutocomplete]="contactSignerAutocomplete" formControlName="clientContact" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Name">
                                            <mat-autocomplete #contactSignerAutocomplete="matAutocomplete" [displayWith]="displayFullNameFn"
                                                (optionSelected)="focusOutMethod()" (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                                <ng-container *ngFor="let contact of filteredContractSigners; trackBy: trackById">
                                                    <mat-option [value]="contact" [ngClass]="{ 'no-data': contact.id === 'no-data' }">
                                                            <span class="autocopmlete-option-name">{{ contact.firstName + ' ' + contact.lastName }}</span>
                                                    </mat-option>
                                                </ng-container>
                                            </mat-autocomplete>
                                            <mat-error>
                                                <app-validator [control]="contractSigners.at(i).get('clientContact')"></app-validator>
                                            </mat-error>
                                        </mat-form-field>

                                        <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--16" fxFlex="33%">
                                            <mat-label>Client Role</mat-label>
                                            <mat-select [disabled]="readOnlyMode" required formControlName="clientRole" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                <ng-container *ngFor="let item of signerRoles; trackBy: trackById">
                                                    <mat-option [value]="item">
                                                        {{ item.name }}
                                                    </mat-option>
                                                </ng-container>
                                            </mat-select>
                                            <mat-error>
                                                <app-validator [control]="contractSigners.at(i).get('clientRole')"></app-validator>
                                            </mat-error>
                                        </mat-form-field>

                                        <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--16" fxFlex="20%">
                                            <mat-label>Sequence</mat-label>
                                            <mat-select [disabled]="readOnlyMode" required formControlName="clientSequence" [disableOptionCentering]="true">
                                                <ng-container *ngFor="let item of [1,2,3,4,5,6,7]">
                                                    <mat-option [value]="item">
                                                        {{ item }}
                                                    </mat-option>
                                                </ng-container>
                                            </mat-select>
                                            <mat-error>
                                                <app-validator [control]="contractSigners.at(i).get('clientSequence')"></app-validator>
                                            </mat-error>
                                        </mat-form-field>
                                        <ng-container *ngIf="!readOnlyMode">
                                            <button class="form-icon--delete-row" type="button" mat-icon-button appPreventDoubleClick (throttledClick)="removeSigner(i)"><mat-icon svgIcon="remove-icon"></mat-icon></button>
                                        </ng-container>
                                    </div>
                                </ng-container>
                                <ng-container *ngIf="contractSigners.controls?.length === 0 && readOnlyMode">
                                    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px" class="workflow-sales-inline--form__row u-w--100">
                                        <span>
                                            No contract signers
                                        </span>
                                    </div>
                                </ng-container>
                                <ng-container *ngIf="!readOnlyMode">
                                    <button class="button-add" mat-flat-button type="button" appPreventDoubleClick (throttledClick)="addSignerToForm()">
                                        <mat-icon>add</mat-icon>
                                        Add Signer
                                    </button>
                                </ng-container>
                            </div>
                        </div>

                    </div>
                </div>
            </form>
        </ng-container>
        <form [formGroup]="consultantsForm" id="consultantData" class="workflow-form--consultants u-w--100">
            <ng-container formArrayName="consultantData" class="u-mb--20">
                <div fxLayout="column" fxLayoutAlign="start start" class="workflow-sales--process-data u-w--100">
                    <ng-container *ngFor="let consultant of consultantsForm.consultantData.controls; let consultantIndex = index" [formGroupName]="consultantIndex">
                        <div class="u-w--100">
                            <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="30px" class="u-w--100" [id]="'salesConsultantDataAnchor' + consultantIndex">
                                <h1 class="workflow-section--header-main text-nowrap">Consultant data</h1>
                                <ng-container *ngIf="activeSideSection.typeId === workflowSideSections.StartClientPeriod || activeSideSection.typeId === workflowSideSections.ChangeClientPeriod || activeSideSection.typeId === workflowSideSections.ExtendClientPeriod || activeSideSection.typeId === workflowSideSections.ChangeConsultantPeriod || activeSideSection.typeId === workflowSideSections.ExtendConsultantPeriod">
                                    <span fxFlex="auto" fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                        <ng-container  *ngIf="consultant.value?.consultantName?.consultant?.id || consultant.value?.consultantNameOnly">
                                            <ng-container *ngIf="consultant.value?.consultantName?.consultant?.id">
                                                <img class="image-thumbnail-responsive border-rounded-50 u-ml--16 u-mr--16" [src]="consultantProfileUrl(consultant.value?.consultantName?.consultant?.externalId)" />
                                            </ng-container>
                                            <span class="workflow-form--consultants__name">
                                                {{consultant.value?.consultantName?.consultant?.name}}
                                            </span>
                                        </ng-container>
                                        <ng-container *ngIf="consultantsForm.consultantData?.controls?.length && (activeSideSection.typeId === workflowSideSections.StartClientPeriod && (isCompleted === editEnabledForcefuly))">
                                            <button class="form-icon--delete-row u-ml--5" type="button"
                                                mat-icon-button appPreventDoubleClick (throttledClick)="$event.stopPropagation();confirmRemoveConsultant(consultantIndex)">
                                                <mat-icon svgIcon="remove-icon"></mat-icon>
                                            </button>
                                        </ng-container>
                                    </span>

                                    <div fxFlex="25%" fxLayoutAlign="end center">
                                        <ng-container *ngIf="consultant.value?.consultantProjectStartDate">
                                            <span class="workflow-form--consultants__period u-mr--8">
                                                {{consultant.value?.consultantProjectStartDate | momentFormat}} - {{consultant.value?.consultantProjectEndDate | momentFormat}}
                                            </span>
                                        </ng-container>
                                    </div>
                                </ng-container>
                            </div>

                            <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                <div fxLayout="row" fxLayoutAlign="start center" class="u-mb--16">
                                    <span class="workflow-section--number">1</span>
                                    <h2 class="workflow-section--header">Employment type</h2>
                                </div>
                                <div class="workflow-section--content">
                                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-235">
                                            <mat-label>Employment type</mat-label>
                                            <mat-select [disabled]="(activeSideSection.typeId !== workflowSideSections.StartClientPeriod && activeSideSection.typeId !== workflowSideSections.StartConsultantPeriod) || readOnlyMode" required formControlName="employmentType" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                <ng-container *ngFor="let item of employmentTypes; trackBy: trackById">
                                                    <mat-option [value]="item">
                                                        {{ item.name }}
                                                    </mat-option>
                                                </ng-container>
                                            </mat-select>
                                            <mat-error>
                                                <app-validator [control]="consultant.get('employmentType')"></app-validator>
                                            </mat-error>
                                        </mat-form-field>
                                    </div>
                                    <ng-container *ngIf="consultant.value?.employmentType?.id">
                                        <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding client-and-consultant-autocomplete" [fxHide]="consultant.value?.employmentType?.id === 10 || consultant.value?.employmentType?.id === 11" [ngClass]="{'disabled-input': (activeSideSection.typeId !== workflowSideSections.StartClientPeriod && activeSideSection.typeId !== workflowSideSections.StartConsultantPeriod) || readOnlyMode}">
                                                <mat-label>Consultant Name</mat-label>
                                                <input [disabled]="(activeSideSection.typeId !== workflowSideSections.StartClientPeriod && activeSideSection.typeId !== workflowSideSections.StartConsultantPeriod) || readOnlyMode" [required]="consultant.value?.employmentType?.id !== 10 && consultant.value?.employmentType?.id !== 11" type="text" matInput [matAutocomplete]="consultantAutocomplete" name="consutlantNameAutocomplete" formControlName="consultantName" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Consultant name">
                                                <mat-autocomplete #consultantAutocomplete="matAutocomplete" [displayWith]="displayConsultantNameFn"
                                                    (optionSelected)="focusOutMethod()" (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                                    <ng-container *ngFor="let item of filteredConsultants; trackBy: trackById">
                                                        <mat-option [value]="item" [ngClass]="{ 'no-data': item?.id === 'no-data' }" appPreventDoubleClick (throttledClick)="updateConsultantStepAnchors()">
                                                            <div class="multilineDropdown-option--row">
                                                                <ng-container *ngIf="item?.id !== 'no-data'">
                                                                    <img class="image-thumbnail-small border-rounded-50 u-mr--10" [src]="consultantProfileUrl(item.consultant.externalId)" />
                                                                </ng-container>
                                                                <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                                                    <span class="multilineDropdown-option--column-client-name">{{ item.consultant.name }}</span>
                                                                    <ng-container *ngIf="item?.id !== 'no-data'">
                                                                        <span class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                                                            {{item.consultant.companyName ? item.consultant.companyName + ' | ' : ''}} {{item.consultant.city ? item.consultant.city + ' | ' : ''}} #{{item.consultant.id}} / {{item.consultant.legacyId}}
                                                                        </span>
                                                                    </ng-container>
                                                                </div>
                                                            </div>
                                                        </mat-option>
                                                    </ng-container>
                                                </mat-autocomplete>
                                                <mat-error>
                                                    <app-validator [control]="consultant.get('consultantName')"></app-validator>
                                                </mat-error>
                                            </mat-form-field>
                                            <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding filter-select client-and-consultant-autocomplete" [fxHide]="consultant.value?.employmentType?.id !== 10 && consultant.value?.employmentType?.id !== 11" [ngClass]="{'disabled-input': (activeSideSection.typeId !== workflowSideSections.StartClientPeriod && activeSideSection.typeId !== workflowSideSections.StartConsultantPeriod) || readOnlyMode}">
                                                <mat-label>Consultant Name only</mat-label>
                                                <input [disabled]="(activeSideSection.typeId !== workflowSideSections.StartClientPeriod && activeSideSection.typeId !== workflowSideSections.StartConsultantPeriod) || readOnlyMode" [required]="consultant.value?.employmentType?.id === 10 || consultant.value?.employmentType?.id === 11" type="text" matInput formControlName="consultantNameOnly" placeholder="Consultant name only">
                                                <mat-error>
                                                    <app-validator [control]="consultant.get('consultantNameOnly')"></app-validator>
                                                </mat-error>
                                            </mat-form-field>
                                        </div>
                                    </ng-container>
                                    <app-consultant-information [onlyAdditionalInfo]="true" [consultantData]="consultant?.value?.consultantName?.consultant"></app-consultant-information>
                                </div>
                            </div>
                            <ng-container *ngIf="consultant.value?.employmentType?.id  && (consultant.value?.employmentType?.id !== employmentTypesEnum.FeeOnly && consultant.value?.employmentType?.id !== employmentTypesEnum.Recruitment)">

                                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                    <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                        <span class="workflow-section--number">2</span>
                                        <h2 class="workflow-section--header">Consultant contract duration</h2>
                                    </div>
                                    <div class="workflow-section--content">
                                        <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--20">
                                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-235">
                                                <mat-label>Project Duration</mat-label>
                                                <mat-select [disabled]="readOnlyMode" required formControlName="consultantProjectDurationSameAsClient" [disableOptionCentering]="true" (selectionChange)="updateConsultantDates($event, consultantIndex)">
                                                    <mat-option [value]="true">
                                                        Same as client
                                                    </mat-option>
                                                    <mat-option [value]="false">
                                                        Different from client
                                                    </mat-option>
                                                </mat-select>
                                                <mat-error>
                                                    <app-validator [control]="consultant.get('consultantProjectDurationSameAsClient')"></app-validator>
                                                </mat-error>
                                            </mat-form-field>
                                        </div>
                                        <ng-container *ngIf="!consultant.value?.consultantProjectDurationSameAsClient">
                                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100 u-mb--10">
                                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding u-mr--12 form-width-150" [ngClass]="{'disabled-input': readOnlyMode}">
                                                    <mat-label>Start date</mat-label>
                                                    <input [disabled]="readOnlyMode" required autocomplete="off" matInput
                                                            [matDatepicker]="consultantProjectStartDatePicker"
                                                            name="consultantProjectStartDate" formControlName="consultantProjectStartDate"
                                                            (focus)="consultantProjectStartDatePicker.open()"
                                                            appPreventDoubleClick (throttledClick)="consultantProjectStartDatePicker.open()" readonly>
                                                    <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                                                    <mat-datepicker #consultantProjectStartDatePicker></mat-datepicker>
                                                    <mat-error>
                                                        <app-validator [control]="consultant.get('consultantProjectStartDate')"></app-validator>
                                                    </mat-error>
                                                </mat-form-field>

                                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding u-mr--12 form-width-150" [ngClass]="{'disabled-input': readOnlyMode}">
                                                    <mat-label>End date</mat-label>
                                                    <input [disabled]="readOnlyMode" required autocomplete="off" matInput
                                                            [matDatepicker]="consultantProjectEndDatePicker"
                                                            name="consultantProjectEndDate" formControlName="consultantProjectEndDate"
                                                            (focus)="consultantProjectEndDatePicker.open()"
                                                            appPreventDoubleClick (throttledClick)="consultantProjectEndDatePicker.open()" readonly>
                                                    <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                                                    <mat-datepicker #consultantProjectEndDatePicker></mat-datepicker>
                                                    <mat-error>
                                                        <app-validator [control]="consultant.get('consultantProjectEndDate')"></app-validator>
                                                    </mat-error>
                                                </mat-form-field>
                                                <ng-container *ngIf="!readOnlyMode || consultant.get('consultantProjectNoEndDate')?.value">
                                                    <mat-checkbox [disabled]="readOnlyMode" color="accent" formControlName="consultantProjectNoEndDate" name="consultantProjectNoEndDate" class="black-checkbox u-mt--8"
                                                                (change)="disableOrEnableInput(consultantsForm.consultantData.at(consultantIndex).get('consultantProjectNoEndDate')?.value, consultantsForm.consultantData.at(consultantIndex).get('consultantProjectEndDate'))">
                                                        No end date
                                                    </mat-checkbox>
                                                </ng-container>
                                            </div>
                                        </ng-container>
                                    </div>
                                </div>
                                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                    <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                        <span class="workflow-section--number">3</span>
                                        <h2 class="workflow-section--header">Consultant project</h2>
                                    </div>
                                    <div class="workflow-section--content">
                                        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100" [fxHide]="readOnlyMode && !consultantsForm.consultantData.at(consultantIndex).get('consultantIsOnsiteWorkplace')?.value">
                                                <mat-checkbox [disabled]="readOnlyMode" color="accent" [required]="!consultant.value.consultantIsEmagineOfficeWorkplace && !consultant.value.consultantIsRemoteWorkplace" formControlName="consultantIsOnsiteWorkplace" name="consultantIsOnsiteWorkplace" class="black-checkbox u-mr--12 u-mt--8" fxFlex="20%">
                                                    Onsite
                                                </mat-checkbox>
                                                <ng-container *ngIf="consultantsForm.consultantData.at(consultantIndex).get('consultantIsOnsiteWorkplace')?.value">
                                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding u-mr--12 form-width-312" [ngClass]="{'disabled-input': readOnlyMode}">
                                                        <mat-label>Client</mat-label>
                                                        <input [disabled]="readOnlyMode" required type="text" matInput [matAutocomplete]="consultantClientAddressAuto" formControlName="consultantWorkplaceClientAddress" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Search client">
                                                        <mat-autocomplete #consultantClientAddressAuto="matAutocomplete" [displayWith]="displayClientNameFn"
                                                            (optionSelected)="focusOutMethod()" (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                                            <ng-container *ngFor="let client of filteredConsultantClientAddresses; trackBy: trackById">
                                                                <mat-option [value]="client" [ngClass]="{ 'no-data': client.id === 'no-data' }">
                                                                    <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                                                        <span class="multilineDropdown-option--column-client-name">{{ client.clientName }}</span>
                                                                        <ng-container *ngIf="client.id !== 'no-data'">
                                                                            <span class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                                                                #{{client.clientId}} | {{client.city ?? ''}} {{client.countryName ? ', ' + client.countryName : ''}}
                                                                            </span>
                                                                        </ng-container>
                                                                    </div>
                                                                </mat-option>
                                                            </ng-container>
                                                        </mat-autocomplete>
                                                        <mat-error>
                                                            <app-validator [control]="consultant.get('consultantWorkplaceClientAddress')"></app-validator>
                                                        </mat-error>
                                                    </mat-form-field>
                                                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding form-width-150" [fxHide]="!consultant.value?.consultantIsEmagineOfficeWorkplace && !consultant.value?.consultantIsRemoteWorkplace">
                                                        <mat-label>Add value %</mat-label>
                                                        <input [disabled]="readOnlyMode" [required]="consultant.value?.consultantIsEmagineOfficeWorkplace || consultant.value?.consultantIsRemoteWorkplace" autocomplete="off" matInput formControlName="consultantWorkplacePercentageOnSite" type="number" [min]="1" [max]="100">
                                                        <mat-error>
                                                            <app-validator [control]="consultant.get('consultantWorkplacePercentageOnSite')"></app-validator>
                                                        </mat-error>
                                                    </mat-form-field>
                                                </ng-container>
                                            </div>
                                            <ng-container *ngIf="consultant.get('consultantIsOnsiteWorkplace')?.value">
                                                <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100 u-mb--20">
                                                    <div fxFlex="20%" class="u-mr--12">
                                                    </div>
                                                    <div fxLayout="column" fxLayoutAlign="start start">
                                                        <ng-container [ngTemplateOutlet]="clientAdditionalInfo" [ngTemplateOutletContext]="{client: consultant.value.consultantWorkplaceClientAddress}">
                                                        </ng-container>
                                                        <mat-checkbox [disabled]="readOnlyMode" color="accent" (change)="changeConsultantWorkplace($event, consultantIndex)" [checked]="salesClientDataForm.directClientIdValue?.value?.clientId === consultant.value.consultantWorkplaceClientAddress?.clientId" name="consultantIsOnsiteWorkplaceSameAsDirectClient" class="black-checkbox u-mt--5">
                                                            Same as direct client
                                                        </mat-checkbox>
                                                    </div>
                                                </div>
                                            </ng-container>
                                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100" [fxHide]="readOnlyMode && !consultantsForm.consultantData.at(consultantIndex).get('consultantIsEmagineOfficeWorkplace')?.value">
                                                <mat-checkbox [disabled]="readOnlyMode" color="accent" [required]="!consultant.value.consultantIsOnsiteWorkplace && !consultant.value.consultantIsRemoteWorkplace" formControlName="consultantIsEmagineOfficeWorkplace" name="consultantIsEmagineOfficeWorkplace" class="black-checkbox u-mr--12 u-mt--8" fxFlex="20%">
                                                    emagine Office
                                                </mat-checkbox>
                                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-312" [fxHide]="!consultantsForm.consultantData.at(consultantIndex).get('consultantIsEmagineOfficeWorkplace')?.value">
                                                    <mat-label>emagine Office address</mat-label>
                                                    <mat-select [disabled]="readOnlyMode" [required]="consultantsForm.consultantData.at(consultantIndex).get('consultantIsEmagineOfficeWorkplace')?.value" formControlName="consultantWorkplaceEmagineOffice" [disableOptionCentering]="true">
                                                        <ng-container *ngFor="let item of emagineOffices; trackBy: trackById">
                                                            <mat-option [value]="item">
                                                                {{ item.name }}
                                                            </mat-option>
                                                        </ng-container>
                                                    </mat-select>
                                                    <mat-error>
                                                        <app-validator [control]="consultant.get('consultantWorkplaceEmagineOffice')"></app-validator>
                                                    </mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100" [fxHide]="readOnlyMode && !consultantsForm.consultantData.at(consultantIndex).get('consultantIsRemoteWorkplace')?.value">
                                                <mat-checkbox [disabled]="readOnlyMode" color="accent" [required]="!consultant.value.consultantIsOnsiteWorkplace && !consultant.value.consultantIsEmagineOfficeWorkplace" formControlName="consultantIsRemoteWorkplace" name="consultantIsRemoteWorkplace" class="black-checkbox u-mr--12 u-mt--8" fxFlex="20%">
                                                    Remote
                                                </mat-checkbox>
                                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding form-width-312" [fxHide]="!consultantsForm.consultantData.at(consultantIndex).get('consultantIsRemoteWorkplace')?.value" [ngClass]="{'disabled-input': readOnlyMode}">
                                                    <mat-label>Remote country</mat-label>
                                                    <input [disabled]="readOnlyMode" [required]="consultantsForm.consultantData.at(consultantIndex).get('consultantIsRemoteWorkplace')?.value" type="text" matInput [matAutocomplete]="consultantCountryAuto" formControlName="consultantWorkplaceRemote" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Search country">
                                                    <mat-autocomplete #consultantCountryAuto="matAutocomplete" [displayWith]="displayNameFn"
                                                        (optionSelected)="focusOutMethod()" (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                                        <ng-container *ngFor="let option of filteredConsultantCountries; trackBy: trackById">
                                                            <mat-option [value]="option">
                                                                <span class="autocopmlete-option-name">
                                                                    {{option.name}}
                                                                </span>
                                                            </mat-option>
                                                        </ng-container>
                                                    </mat-autocomplete>
                                                    <mat-error>
                                                        <app-validator [control]="consultant.get('consultantWorkplaceRemote')"></app-validator>
                                                    </mat-error>
                                                </mat-form-field>
                                            </div>
                                            <ng-container *ngIf="consultant.get('consultantIsOnsiteWorkplace')?.touched || consultant.get('consultantIsRemoteWorkplace')?.touched || consultant.get('consultantIsEmagineOfficeWorkplace')?.touched">
                                                <ng-container  *ngIf="!consultant.value.consultantIsOnsiteWorkplace && !consultant.value.consultantIsEmagineOfficeWorkplace && !consultant.value.consultantIsRemoteWorkplace">
                                                    <mat-error class="custom-error--message">
                                                        At least one Workplace is required
                                                    </mat-error>
                                                </ng-container>
                                            </ng-container>
                                        </div>
                                        <h3 class="workflow-gray--header u-mb--10 u-mt--20">Expected Workload</h3>
                                        <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100 u-mb--10">
                                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding u-mr--12 form-width-150" [ngClass]="{'disabled-input': readOnlyMode}">
                                                <mat-label>Hours</mat-label>
                                                <input [disabled]="readOnlyMode" required autocomplete="off" matInput formControlName="expectedWorkloadHours" type="number">
                                                <mat-error>
                                                    <app-validator [control]="consultant.get('expectedWorkloadHours')"></app-validator>
                                                </mat-error>
                                            </mat-form-field>
                                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-150">
                                                <mat-label>Period</mat-label>
                                                <mat-select [disabled]="readOnlyMode" required formControlName="expectedWorkloadUnitId" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                    <ng-container *ngFor="let item of expectedWorkloadUnits; trackBy: trackById">
                                                        <mat-option [value]="item">
                                                            {{ item.name }}
                                                        </mat-option>
                                                    </ng-container>
                                                </mat-select>
                                                <mat-error>
                                                    <app-validator [control]="consultant.get('expectedWorkloadUnitId')"></app-validator>
                                                </mat-error>
                                            </mat-form-field>
                                        </div>

                                        <!-- 'Individual cap' Id = 3 -->
                                        <div [fxHide]="salesClientDataForm.capOnTimeReporting?.value?.id !== 3" class="u-w--100">
                                            <h3 class="workflow-gray--header u-mb--10">Cap on Time Reporting</h3>
                                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100 u-mb--20">
                                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-150">
                                                    <mat-label>Cap type</mat-label>
                                                    <mat-select [disabled]="readOnlyMode" required formControlName="consultantCapOnTimeReporting" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                        <ng-container *ngFor="let item of consultantTimeReportingCapList; trackBy: trackById">
                                                            <mat-option [value]="item">
                                                                {{ item.name }}
                                                            </mat-option>
                                                        </ng-container>
                                                    </mat-select>
                                                    <mat-error>
                                                        <app-validator [control]="consultant.get('consultantCapOnTimeReporting')"></app-validator>
                                                    </mat-error>
                                                </mat-form-field>
                                                <ng-container [ngSwitch]="consultant.value?.consultantCapOnTimeReporting.id">
                                                    <ng-container *ngSwitchCase="1">  <!-- 'Cap on units' -->
                                                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding u-mr--12 form-width-150" [ngClass]="{'disabled-input': readOnlyMode}">
                                                            <mat-label>Max value</mat-label>
                                                            <input [disabled]="readOnlyMode" [required]="salesClientDataForm.capOnTimeReporting?.value?.id === 3 && (consultant.value?.consultantCapOnTimeReporting.id === 1 || consultant.value?.consultantCapOnTimeReporting.id === 2)" autocomplete="off" matInput formControlName="consultantTimeReportingCapMaxValue" type="number">
                                                            <mat-error>
                                                                <app-validator [control]="consultant.get('consultantTimeReportingCapMaxValue')"></app-validator>
                                                            </mat-error>
                                                        </mat-form-field>
                                                        <div fxFlex="0 0 calc(16.5% - 8px)" fxLayoutAlign="start center" class="workflow-form--consultants__payment-price-text u-mt--8">
                                                            <ng-container [ngSwitch]="consultant.value.consultantRateUnitType?.id">
                                                                <ng-container *ngSwitchCase="1"> <!-- Per hour -->
                                                                    hours
                                                                </ng-container>
                                                                <ng-container *ngSwitchCase="2"> <!-- Per day -->
                                                                    days
                                                                </ng-container>
                                                                <ng-container *ngSwitchCase="4"> <!-- Per month -->
                                                                    months
                                                                </ng-container>
                                                            </ng-container>
                                                        </div>
                                                    </ng-container>
                                                    <ng-container *ngSwitchCase="2"> <!-- 'Cap on value' -->
                                                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding u-mr--12 form-width-150" [ngClass]="{'disabled-input': readOnlyMode}">
                                                            <mat-label>Max value</mat-label>
                                                            <input [disabled]="readOnlyMode" required autocomplete="off" matInput formControlName="consultantTimeReportingCapMaxValue" type="number">
                                                            <mat-error>
                                                                <app-validator [control]="consultant.get('consultantTimeReportingCapMaxValue')"></app-validator>
                                                            </mat-error>
                                                        </mat-form-field>
                                                        <div fxFlex="0 0 calc(16.5% - 8px)" fxLayoutAlign="start center" class="workflow-form--consultants__payment-price-text u-mt--8">
                                                            {{consultant.value.consultantRateCurrency?.name}}
                                                        </div>
                                                    </ng-container>
                                                    <ng-container *ngSwitchCase="4"> <!-- 'No cap' -->
                                                    </ng-container>
                                                </ng-container>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                    <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                        <span class="workflow-section--number">4</span>
                                        <h2 class="workflow-section--header">Rates and fees</h2>
                                    </div>
                                    <div class="workflow-section--content">
                                        <div class="inline-edit-form u-w--100">
                                            <ng-container *ngIf="consultant.value.specialRates?.length">
                                                <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px" class="workflow-sales-inline--form__header-container u-w--100">
                                                    <span fxFlex="1 0 20%" class="workflow-sales-inline--form__header u-w--100">
                                                        Rate name
                                                    </span>
                                                    <span fxFlex="20%" class="workflow-sales-inline--form__header u-w--100">
                                                        Reporting unit
                                                    </span>
                                                    <ng-container *ngIf="consultant.value?.consultantProdataEntity?.id !== salesClientDataForm.value?.pdcInvoicingEntityId?.id">
                                                        <span fxFlex="25%" class="workflow-sales-inline--form__header u-w--100">
                                                            emagine rate
                                                        </span>
                                                    </ng-container>
                                                    <span fxFlex="25%" class="workflow-sales-inline--form__header u-w--100">
                                                        Consultant rate
                                                    </span>
                                                    <span fxFlex="10%" class="workflow-sales-inline--form__header u-w--100" [fxHide]="readOnlyMode">
                                                    </span>
                                                </div>
                                            </ng-container>
                                            <ng-container formArrayName="specialRates" class="u-w--100">
                                                <ng-container *ngFor="let rate of getConsultantRateControls(consultantIndex); let specialRateIndex = index;" [formArrayName]="specialRateIndex">
                                                    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px" class="workflow-sales-inline--form__row u-w--100">
                                                        <ng-container>
                                                            <span fxFlex="1 0 20%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="rate.value.rateName" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                {{rate.value.rateName ?? '-'}}
                                                            </span>
                                                            <span fxFlex="20%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="rate.value.reportingUnit?.name" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                {{rate.value.reportingUnit?.name ?? '-'}}
                                                            </span>
                                                            <ng-container *ngIf="consultant.value?.consultantProdataEntity?.id !== salesClientDataForm.value?.pdcInvoicingEntityId?.id">
                                                                <ng-container *ngIf="rate.value.editable; else consutlantProDataRateCurrencyDisplay">
                                                                    <div fxFlex="25%" fxLayout="row" fxLayoutAlign="start start">
                                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--10" fxFlex="30%">
                                                                            <input [required]="consultant.value?.consultantProdataEntity?.id !== salesClientDataForm.value?.pdcInvoicingEntityId?.id" matInput type="number" placeholder="Rate" formControlName="prodataToProdataRate">
                                                                        </mat-form-field>
                                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="50%">
                                                                            <mat-select [required]="consultant.value?.consultantProdataEntity?.id !== salesClientDataForm.value?.pdcInvoicingEntityId?.id" formControlName="prodataToProdataRateCurrency" placeholder="Currency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                                <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                                    <mat-option [value]="item">
                                                                                        {{ item.name }}
                                                                                    </mat-option>
                                                                                </ng-container>
                                                                            </mat-select>
                                                                        </mat-form-field>
                                                                    </div>
                                                                </ng-container>
                                                                <ng-template #consutlantProDataRateCurrencyDisplay>
                                                                    <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="rate.value.prodataToProdataRate !== null && rate.value.prodataToProdataRateCurrency?.name ? rate.value.prodataToProdataRate + ' ' + rate.value.prodataToProdataRateCurrency?.name : '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                        {{rate.value.prodataToProdataRate !== null && rate.value.prodataToProdataRateCurrency?.name ? rate.value.prodataToProdataRate + ' ' + rate.value.prodataToProdataRateCurrency?.name : '-'}}
                                                                    </span>
                                                                </ng-template>
                                                            </ng-container>

                                                            <ng-container *ngIf="rate.value.editable; else consutlantRateCurrencyDisplay">
                                                                <div fxFlex="25%" fxLayout="row" fxLayoutAlign="start start">
                                                                    <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--10" fxFlex="30%">
                                                                        <input required matInput type="number" placeholder="Rate" formControlName="consultantRate">
                                                                    </mat-form-field>
                                                                    <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="50%">
                                                                        <mat-select required formControlName="consultantRateCurrency" placeholder="Currency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                            <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                                <mat-option [value]="item">
                                                                                    {{ item.name }}
                                                                                </mat-option>
                                                                            </ng-container>
                                                                        </mat-select>
                                                                    </mat-form-field>
                                                                </div>
                                                            </ng-container>
                                                            <ng-template #consutlantRateCurrencyDisplay>
                                                                <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="rate.value.consultantRate !== null && rate.value.consultantRateCurrency?.name ? rate.value.consultantRate + ' ' + rate.value.consultantRateCurrency?.name : '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                    {{rate.value.consultantRate !== null && rate.value.consultantRateCurrency?.name ? rate.value.consultantRate + ' ' + rate.value.consultantRateCurrency?.name : '-'}}
                                                                </span>
                                                            </ng-template>
                                                            <ng-container *ngIf="rate.value.editable; else consultantRateActionDisplay">
                                                                <div fxFlex="10%" class="u-w--100 text-truncate-ellipsis" fxLayoutAlign="end center" [fxHide]="readOnlyMode">
                                                                    <button mat-icon-button type="button" [disabled]="!rate.valid" appPreventDoubleClick (throttledClick)="editOrSaveConsultantRate(consultantIndex, specialRateIndex, rate.value.editable)" class="rates-and-fees--inline-edit-form--btn__save">
                                                                        <mat-icon svgIcon="rates-save-icon"></mat-icon>
                                                                    </button>
                                                                    <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="cancelEditConsultantRate(consultantIndex, specialRateIndex)" class="rates-and-fees--inline-edit-form--btn__cancel">
                                                                        <mat-icon svgIcon="rates-cancel-icon"></mat-icon>
                                                                    </button>
                                                                </div>
                                                            </ng-container>
                                                            <ng-template #consultantRateActionDisplay>
                                                                <div fxFlex="10%" fxLayoutAlign="end center" class="u-w--100" [fxHide]="readOnlyMode">
                                                                    <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="$event.stopPropagation();" [matMenuTriggerFor]="consutlantRateMenu" class="three-dots-actions-btn">
                                                                        <mat-icon svgIcon="3-dots"></mat-icon>
                                                                    </button>
                                                                    <mat-menu #consutlantRateMenu>
                                                                        <button
                                                                            class="menu-item menu-item--edit"
                                                                            mat-menu-item
                                                                            [disabled]="isConsultantRateEditing"
                                                                            appPreventDoubleClick (throttledClick)="editOrSaveConsultantRate(consultantIndex, specialRateIndex, rate.value.editable)">
                                                                            <mat-icon svgIcon="edit-icon-green"></mat-icon>
                                                                            Edit
                                                                        </button>
                                                                        <button
                                                                            class="menu-item menu-item--cancel"
                                                                            mat-menu-item
                                                                            appPreventDoubleClick (throttledClick)="removeConsutlantRate(consultantIndex, specialRateIndex)">
                                                                            <mat-icon svgIcon="close-icon"></mat-icon>
                                                                            Delete
                                                                        </button>
                                                                    </mat-menu>
                                                                </div>
                                                            </ng-template>
                                                        </ng-container>
                                                    </div>
                                                </ng-container>
                                                <ng-container *ngIf="consultant.value.specialRates?.length === 0 && readOnlyMode">
                                                    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px" class="workflow-sales-inline--form__row u-w--100">
                                                        <span>
                                                            No consultant rates
                                                        </span>
                                                    </div>
                                                </ng-container>
                                            </ng-container>
                                        </div>

                                        <div fxLayout="row" fxLayoutAlign="start start" class="u-mb--10" [fxHide]="readOnlyMode">
                                            <button class="rates-and-fees--btn button-add" mat-flat-button
                                                [matMenuTriggerFor]="consultantSpecialRateMenu"
                                                [disabled]="isConsultantRateEditing"
                                                type="button"
                                                (menuOpened)="consultantsForm.consultantData.at(consultantIndex).get('consultantSpecialRateFilter')!.setValue(''); consultantSpecialRateSelect.open();"
                                                #consultantRateMenuTrigger="matMenuTrigger">
                                                <mat-icon>add</mat-icon>
                                                Add special rate
                                            </button>
                                            <mat-menu #consultantSpecialRateMenu backdropClass="add-rates-button--menu">
                                                <div mat-menu-item appPreventDoubleClick (throttledClick)="$event.stopPropagation()" class="u-pg--0">
                                                    <mat-form-field appearance="fill" class="add-rates-button--dropdown formFieldNoMarginPadding filter-select u-w--100">
                                                        <mat-label>Choose special rate</mat-label>
                                                        <mat-select #consultantSpecialRateSelect formControlName="consultantSpecialRateFilter" [disableOptionCentering]="true">
                                                            <ng-container *ngIf="clientSpecialRateList.length == 0">
                                                                <mat-option (click)="$event.stopPropagation();">
                                                                    No results
                                                                </mat-option>
                                                            </ng-container>
                                                            <ng-container *ngFor="let item of clientSpecialRateList | excludeIds: consultant.value.specialRates : 'clientSpecialRateId'; trackBy: trackById">
                                                                <mat-option [value]="item.id" appPreventDoubleClick (throttledClick)="selectConsultantSpecialRate($event, consultantIndex, item, consultantRateMenuTrigger)">
                                                                    {{ item.internalName }}
                                                                </mat-option>
                                                            </ng-container>
                                                        </mat-select>
                                                    </mat-form-field>
                                                </div>
                                            </mat-menu>
                                        </div>

                                        <div class="inline-edit-form u-w--100">
                                            <ng-container *ngIf="consultant.value.specialFees?.length">
                                                <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px" class="workflow-sales-inline--form__header-container u-w--100">
                                                    <span fxFlex="1 1 20%" class="workflow-sales-inline--form__header u-w--100">
                                                        Fee name
                                                    </span>
                                                    <span fxFlex="20%" class="workflow-sales-inline--form__header u-w--100">
                                                        Frequency
                                                    </span>
                                                    <ng-container *ngIf="consultant.value?.consultantProdataEntity?.id !== salesClientDataForm.value?.pdcInvoicingEntityId?.id">
                                                        <span fxFlex="25%" class="workflow-sales-inline--form__header u-w--100">
                                                            emagine fee
                                                        </span>
                                                    </ng-container>
                                                    <span fxFlex="25%" class="workflow-sales-inline--form__header u-w--100">
                                                        Consultant fee
                                                    </span>
                                                    <span fxFlex="10%" class="workflow-sales-inline--form__header u-w--100" [fxHide]="readOnlyMode">
                                                    </span>
                                                </div>
                                            </ng-container>
                                            <ng-container formArrayName="specialFees" class="u-w--100">
                                                <ng-container *ngFor="let fee of getConsultantFeeControls(consultantIndex); let specialFeeIndex = index;" [formArrayName]="specialFeeIndex">
                                                    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px" class="workflow-sales-inline--form__row u-w--100">
                                                        <ng-container>
                                                            <span fxFlex="1 1 20%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="fee.value.feeName ?? '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                {{fee.value.feeName ?? '-'}}
                                                            </span>
                                                            <span fxFlex="20%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="fee.value.frequency?.name ?? '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                {{fee.value.frequency?.name ?? '-'}}
                                                            </span>
                                                            <ng-container *ngIf="consultant.value?.consultantProdataEntity?.id !== salesClientDataForm.value?.pdcInvoicingEntityId?.id">
                                                                <ng-container *ngIf="fee.value.editable; else proDataFeeCurrencyDisplay">
                                                                    <div fxFlex="25%" fxLayout="row" fxLayoutAlign="start start">
                                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--10" fxFlex="30%">
                                                                            <input [required]="consultant.value?.consultantProdataEntity?.id !== salesClientDataForm.value?.pdcInvoicingEntityId?.id" matInput type="number" placeholder="Rate" formControlName="prodataToProdataRate">
                                                                        </mat-form-field>
                                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="50%">
                                                                            <mat-select [required]="consultant.value?.consultantProdataEntity?.id !== salesClientDataForm.value?.pdcInvoicingEntityId?.id" formControlName="prodataToProdataRateCurrency" placeholder="Currency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                                <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                                    <mat-option [value]="item">
                                                                                        {{ item.name }}
                                                                                    </mat-option>
                                                                                </ng-container>
                                                                            </mat-select>
                                                                        </mat-form-field>
                                                                    </div>
                                                                </ng-container>
                                                                <ng-template #proDataFeeCurrencyDisplay>
                                                                    <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="fee.value.prodataToProdataRate !== null && fee.value.prodataToProdataRateCurrency?.name ? fee.value.prodataToProdataRate + ' ' + fee.value.prodataToProdataRateCurrency?.name : '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                        {{fee.value.prodataToProdataRate !== null && fee.value.prodataToProdataRateCurrency?.name ? fee.value.prodataToProdataRate + ' ' + fee.value.prodataToProdataRateCurrency?.name : '-'}}
                                                                    </span>
                                                                </ng-template>
                                                            </ng-container>

                                                            <ng-container *ngIf="fee.value.editable; else consultantFeeCurrencyDisplay">
                                                                <div fxFlex="25%" fxLayout="row" fxLayoutAlign="start start">
                                                                    <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--10" fxFlex="30%">
                                                                        <input required matInput type="number" placeholder="Rate" formControlName="consultantRate">
                                                                    </mat-form-field>
                                                                    <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="50%">
                                                                        <mat-select required formControlName="consultantRateCurrency" placeholder="Currency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                            <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                                <mat-option [value]="item">
                                                                                    {{ item.name }}
                                                                                </mat-option>
                                                                            </ng-container>
                                                                        </mat-select>
                                                                    </mat-form-field>
                                                                </div>
                                                            </ng-container>
                                                            <ng-template #consultantFeeCurrencyDisplay>
                                                                <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis" [matTooltip]="fee.value.consultantRate !== null && fee.value.consultantRateCurrency?.name ? fee.value.consultantRate + ' ' + fee.value.consultantRateCurrency?.name : '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                    {{fee.value.consultantRate !== null && fee.value.consultantRateCurrency?.name ? fee.value.consultantRate + ' ' + fee.value.consultantRateCurrency?.name : '-'}}
                                                                </span>
                                                            </ng-template>

                                                            <ng-container *ngIf="fee.value.editable; else clientFeeActionDisplay">
                                                                <div fxFlex="10%" class="u-w--100 text-truncate-ellipsis" fxLayoutAlign="end center" [fxHide]="readOnlyMode">
                                                                    <button mat-icon-button type="button" [disabled]="!fee.valid" appPreventDoubleClick (throttledClick)="editOrSaveConsultantFee(consultantIndex, specialFeeIndex, fee.value.editable)" class="rates-and-fees--inline-edit-form--btn__save">
                                                                        <mat-icon svgIcon="rates-save-icon"></mat-icon>
                                                                    </button>
                                                                    <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="cancelEditConsultantFee(consultantIndex, specialFeeIndex)" class="rates-and-fees--inline-edit-form--btn__cancel">
                                                                        <mat-icon svgIcon="rates-cancel-icon"></mat-icon>
                                                                    </button>
                                                                </div>
                                                            </ng-container>
                                                            <ng-template #clientFeeActionDisplay>
                                                                <div fxFlex="10%" fxLayoutAlign="end center" class="u-w--100" [fxHide]="readOnlyMode">
                                                                    <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="$event.stopPropagation();" [matMenuTriggerFor]="consultantFeeMenu" class="three-dots-actions-btn">
                                                                        <mat-icon svgIcon="3-dots"></mat-icon>
                                                                    </button>
                                                                    <mat-menu #consultantFeeMenu>
                                                                        <button
                                                                            class="menu-item menu-item--edit"
                                                                            mat-menu-item
                                                                            appPreventDoubleClick (throttledClick)="editOrSaveConsultantFee(consultantIndex, specialFeeIndex, fee.value.editable)">
                                                                            <mat-icon svgIcon="edit-icon-green"></mat-icon>
                                                                            Edit
                                                                        </button>
                                                                        <button
                                                                            class="menu-item menu-item--cancel"
                                                                            mat-menu-item
                                                                            appPreventDoubleClick (throttledClick)="removeConsutlantFee(consultantIndex, specialFeeIndex)">
                                                                            <mat-icon svgIcon="close-icon"></mat-icon>
                                                                            Delete
                                                                        </button>
                                                                    </mat-menu>
                                                                </div>
                                                            </ng-template>
                                                        </ng-container>
                                                    </div>
                                                </ng-container>
                                                <ng-container *ngIf="consultant.value.specialFees?.length === 0 && readOnlyMode">
                                                    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px" class="workflow-sales-inline--form__row u-w--100">
                                                        <span>
                                                            No consultant fees
                                                        </span>
                                                    </div>
                                                </ng-container>
                                            </ng-container>
                                        </div>

                                        <div fxLayout="row" fxLayoutAlign="start start" class="u-mb--20" [fxHide]="readOnlyMode">
                                            <button class="rates-and-fees--btn button-add" mat-flat-button
                                                [matMenuTriggerFor]="consultantSpecialFeeMenu"
                                                [disabled]="isConsultantFeeEditing"
                                                type="button"
                                                #consultantFeeMenuTrigger="matMenuTrigger"
                                                (menuOpened)="consultantSpecialFeeSelect.open();">
                                                <mat-icon>add</mat-icon>
                                                Add special fees
                                            </button>
                                            <mat-menu #consultantSpecialFeeMenu backdropClass="add-rates-button--menu">
                                                <div mat-menu-item appPreventDoubleClick (throttledClick)="$event.stopPropagation()" class="u-pg--0">
                                                    <mat-form-field appearance="fill" class="add-rates-button--dropdown filter-select u-w--100">
                                                        <mat-label>Choose special fee</mat-label>
                                                        <mat-select #consultantSpecialFeeSelect formControlName="consultantSpecialFeeFilter" [disableOptionCentering]="true">
                                                            <ng-container *ngIf="clientSpecialFeeList.length == 0">
                                                                <mat-option (click)="$event.stopPropagation();">
                                                                    No results
                                                                </mat-option>
                                                            </ng-container>
                                                            <ng-container *ngFor="let item of clientSpecialFeeList | excludeIds: consultant.value.specialFees : 'clientSpecialFeeId'; trackBy: trackById">
                                                                <mat-option [value]="item.id" appPreventDoubleClick (throttledClick)="selectConsultantSpecialFee($event, consultantIndex, item, consultantFeeMenuTrigger)">
                                                                    {{ item.internalName }}
                                                                </mat-option>
                                                            </ng-container>
                                                        </mat-select>
                                                    </mat-form-field>
                                                </div>
                                            </mat-menu>
                                        </div>
                                    </div>
                                </div>

                                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                    <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                        <span class="workflow-section--number">5</span>
                                        <h2 class="workflow-section--header">Consultant payment</h2>
                                    </div>
                                    <div class="workflow-section--content">
                                        <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-312">
                                                <mat-label>emagine payment entity (consultant)</mat-label>
                                                <mat-select [disabled]="readOnlyMode" required formControlName="consultantProdataEntity" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                    <ng-container *ngFor="let item of legalEntities; trackBy: trackById">
                                                        <mat-option [value]="item">
                                                            {{ item.tenantName + ' ' + '(' + item.name + ')' }}
                                                        </mat-option>
                                                    </ng-container>
                                                </mat-select>
                                                <mat-error>
                                                    <app-validator [control]="consultant.get('consultantProdataEntity')"></app-validator>
                                                </mat-error>
                                            </mat-form-field>
                                        </div>

                                        <ng-container *ngIf="consultant.value.consultantProdataEntity?.id">
                                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-150">
                                                    <mat-label>Price</mat-label>
                                                    <mat-select [disabled]="readOnlyMode" required formControlName="consultantPaymentType" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                        <ng-container *ngFor="let item of clientRateTypes; trackBy: trackById">
                                                            <mat-option [value]="item">
                                                                {{ item.name }}
                                                            </mat-option>
                                                        </ng-container>
                                                    </mat-select>
                                                    <mat-error>
                                                        <app-validator [control]="consultant.get('consultantPaymentType')"></app-validator>
                                                    </mat-error>
                                                </mat-form-field>
                                            </div>

                                            <ng-container class="u-w--100" [ngSwitch]="consultant.value.consultantPaymentType?.id">
                                                <ng-container *ngSwitchCase="1"> <!-- 'Time based' -->
                                                    <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding u-mr--12 form-width-150" [ngClass]="{'disabled-input': readOnlyMode}">
                                                            <mat-label>Rate</mat-label>
                                                            <input [disabled]="readOnlyMode" required autocomplete="off" matInput formControlName="consultantRate" type="number">
                                                            <mat-error>
                                                                <app-validator [control]="consultant.get('consultantRate')"></app-validator>
                                                            </mat-error>
                                                        </mat-form-field>
                                                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-150">
                                                            <mat-label>Unit type</mat-label>
                                                            <mat-select [disabled]="readOnlyMode" required formControlName="consultantRateUnitType" [disableOptionCentering]="true" [compareWith]="compareWithFn" (selectionChange)="updateProdataUnitType($event, consultantIndex)">
                                                                <ng-container *ngFor="let item of rateUnitTypes; trackBy: trackById">
                                                                    <mat-option [value]="item">
                                                                        {{ item.name }}
                                                                    </mat-option>
                                                                </ng-container>
                                                            </mat-select>
                                                            <mat-error>
                                                                <app-validator [control]="consultant.get('consultantRateUnitType')"></app-validator>
                                                            </mat-error>
                                                        </mat-form-field>
                                                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-150">
                                                            <mat-label>Currency</mat-label>
                                                            <mat-select [disabled]="readOnlyMode" required formControlName="consultantRateCurrency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                    <mat-option [value]="item">
                                                                        {{ item.name }}
                                                                    </mat-option>
                                                                </ng-container>
                                                            </mat-select>
                                                            <mat-error>
                                                                <app-validator [control]="consultant.get('consultantRateCurrency')"></app-validator>
                                                            </mat-error>
                                                        </mat-form-field>
                                                        <div fxLayoutAlign="start center" class="workflow-form--consultants__payment-price-text">
                                                            <ng-container *ngIf="(salesClientDataForm.clientRateAndInvoicing?.value?.id === consultant.value?.consultantPaymentType?.id) &&
                                                                (salesClientDataForm.clientCurrency?.value?.id === consultant.value?.consultantRateCurrency?.id) &&
                                                                (salesClientDataForm.rateUnitTypeId?.value?.id === consultant.value?.consultantRateUnitType?.id) &&
                                                                (salesClientDataForm.clientPrice?.value && consultant.value?.consultantRate); else calculateMarginNotPossible">
                                                                <span>
                                                                    <ng-container *ngIf="consultant.value?.consultantProdataEntity?.id !== salesClientDataForm.value?.pdcInvoicingEntityId?.id; else consultantMargin">
                                                                        <ng-container *ngIf="consultant?.value?.consultantPDCRate; else calculateMarginNotPossible">
                                                                            Calculated margin
                                                                            {{ (consultant?.value?.consultantPDCRate * 1 -  consultant.value?.consultantRate * 1)/ salesClientDataForm.clientPrice?.value * 1 | percent: '1.2'}}
                                                                        </ng-container>
                                                                    </ng-container>
                                                                    <ng-template #consultantMargin>
                                                                        Calculated margin
                                                                        {{ (salesClientDataForm.clientPrice?.value * 1 -  consultant.value?.consultantRate * 1)/ salesClientDataForm.clientPrice?.value * 1 | percent: '1.2'}}
                                                                    </ng-template>
                                                                </span>
                                                            </ng-container>
                                                            <ng-template #calculateMarginNotPossible>
                                                                Calculate margin is not possible
                                                            </ng-template>
                                                        </div>
                                                    </div>
                                                    <ng-container *ngIf="consultant.value?.consultantProdataEntity?.id !== salesClientDataForm.value?.pdcInvoicingEntityId?.id">
                                                        <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding u-mr--12 form-width-150" [ngClass]="{'disabled-input': readOnlyMode}">
                                                                <mat-label>e-to-e rate</mat-label>
                                                                <input [disabled]="readOnlyMode" required autocomplete="off" matInput formControlName="consultantPDCRate" type="number">
                                                                <mat-error>
                                                                    <app-validator [control]="consultant.get('consultantPDCRate')"></app-validator>
                                                                </mat-error>
                                                            </mat-form-field>
                                                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-150">
                                                                <mat-label>Unit type</mat-label>
                                                                <mat-select [disabled]="readOnlyMode" required formControlName="consultantPDCRateUnitType" [disableOptionCentering]="true" [disabled]="true" [compareWith]="compareWithFn">
                                                                    <ng-container *ngFor="let item of rateUnitTypes; trackBy: trackById">
                                                                        <mat-option [value]="item">
                                                                            {{ item.name }}
                                                                        </mat-option>
                                                                    </ng-container>
                                                                </mat-select>
                                                                <mat-error>
                                                                    <app-validator [control]="consultant.get('consultantPDCRateUnitType')"></app-validator>
                                                                </mat-error>
                                                            </mat-form-field>
                                                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-150">
                                                                <mat-label>Currency</mat-label>
                                                                <mat-select [disabled]="readOnlyMode" required formControlName="consultantPDCRateCurrency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                    <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                        <mat-option [value]="item">
                                                                            {{ item.name }}
                                                                        </mat-option>
                                                                    </ng-container>
                                                                </mat-select>
                                                                <mat-error>
                                                                    <app-validator [control]="consultant.get('consultantPDCRateCurrency')"></app-validator>
                                                                </mat-error>
                                                            </mat-form-field>
                                                            <div fxLayoutAlign="start center" class="workflow-form--consultants__payment-price-text">
                                                                <span *ngIf="(salesClientDataForm.clientRateAndInvoicing?.value?.id === consultant.value?.consultantPaymentType?.id) &&
                                                                        (salesClientDataForm.clientCurrency?.value?.id === consultant.value?.consultantPDCRateCurrency?.id) &&
                                                                        (salesClientDataForm.rateUnitTypeId?.value?.id === consultant.value?.consultantPDCRateUnitType?.id) &&
                                                                        (salesClientDataForm.clientPrice?.value && consultant.value?.consultantPDCRate); else calculatePDCMarginNotPossible">
                                                                            Calculated margin
                                                                            {{ (salesClientDataForm.clientPrice?.value * 1 -  consultant?.value?.consultantPDCRate * 1)/ salesClientDataForm.clientPrice?.value * 1 | percent: '1.2'}}
                                                                </span>
                                                                <ng-template #calculatePDCMarginNotPossible>
                                                                    Calculate margin is not possible
                                                                </ng-template>
                                                            </div>
                                                        </div>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-container *ngSwitchCase="2"> <!-- 'Fixed' -->
                                                    <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding u-mr--12 form-width-150" [ngClass]="{'disabled-input': readOnlyMode}">
                                                            <mat-label>Rate</mat-label>
                                                            <input [disabled]="readOnlyMode" required autocomplete="off" matInput formControlName="consultantRate" type="number">
                                                            <mat-error>
                                                                <app-validator [control]="consultant.get('consultantRate')"></app-validator>
                                                            </mat-error>
                                                        </mat-form-field>
                                                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-150">
                                                            <mat-label>Currency</mat-label>
                                                            <mat-select [disabled]="readOnlyMode" required formControlName="consultantRateCurrency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                    <mat-option [value]="item">
                                                                        {{ item.name }}
                                                                    </mat-option>
                                                                </ng-container>
                                                            </mat-select>
                                                            <mat-error>
                                                                <app-validator [control]="consultant.get('consultantRateCurrency')"></app-validator>
                                                            </mat-error>
                                                        </mat-form-field>
                                                        <div fxLayoutAlign="start center" class="workflow-form--consultants__payment-price-text">
                                                            <ng-container *ngIf="(salesClientDataForm.clientRateAndInvoicing?.value?.id === consultant.value?.consultantPaymentType?.id) &&
                                                                (salesClientDataForm.clientCurrency?.value?.id === consultant.value?.consultantRateCurrency?.id) &&
                                                                (salesClientDataForm.clientPrice?.value && consultant.value?.consultantRate); else calculateFixedMarginNotPossible">
                                                                <span>
                                                                    <ng-container *ngIf="consultant.value?.consultantProdataEntity?.id !== salesClientDataForm.value?.pdcInvoicingEntityId?.id; else consultantFixedMargin">
                                                                        <ng-container *ngIf="consultant?.value?.consultantPDCRate; else calculateFixedMarginNotPossible">
                                                                            Calculated margin
                                                                            {{ (consultant?.value?.consultantPDCRate * 1 -  consultant.value?.consultantRate * 1)/ salesClientDataForm.clientPrice?.value * 1 | percent: '1.2'}}
                                                                        </ng-container>
                                                                    </ng-container>
                                                                    <ng-template #consultantFixedMargin>
                                                                        Calculated margin
                                                                        {{ (salesClientDataForm.clientPrice?.value * 1 -  consultant.value?.consultantRate * 1)/ salesClientDataForm.clientPrice?.value * 1 | percent: '1.2'}}
                                                                    </ng-template>
                                                                </span>
                                                            </ng-container>
                                                            <ng-template #calculateFixedMarginNotPossible>
                                                                Calculate margin is not possible
                                                            </ng-template>
                                                        </div>
                                                    </div>
                                                    <ng-container *ngIf="consultant.value?.consultantProdataEntity?.id && (consultant.value?.consultantProdataEntity?.id !== salesClientDataForm.value?.pdcInvoicingEntityId?.id)">
                                                        <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding u-mr--12 form-width-150" [ngClass]="{'disabled-input': readOnlyMode}">
                                                                <mat-label>e-to-e rate</mat-label>
                                                                <input [disabled]="readOnlyMode" required autocomplete="off" matInput formControlName="consultantPDCRate" type="number">
                                                                <mat-error>
                                                                    <app-validator [control]="consultant.get('consultantPDCRate')"></app-validator>
                                                                </mat-error>
                                                            </mat-form-field>
                                                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-150">
                                                                <mat-label>Currency</mat-label>
                                                                <mat-select [disabled]="readOnlyMode" required formControlName="consultantPDCRateCurrency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                    <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                        <mat-option [value]="item">
                                                                            {{ item.name }}
                                                                        </mat-option>
                                                                    </ng-container>
                                                                </mat-select>
                                                                <mat-error>
                                                                    <app-validator [control]="consultant.get('consultantPDCRateCurrency')"></app-validator>
                                                                </mat-error>
                                                            </mat-form-field>
                                                            <div fxLayoutAlign="start center" class="workflow-form--consultants__payment-price-text">
                                                                <ng-container *ngIf="(salesClientDataForm.clientRateAndInvoicing?.value?.id === consultant.value?.consultantPaymentType?.id) &&
                                                                    (salesClientDataForm.clientCurrency?.value?.id === consultant.value?.consultantPDCRateCurrency?.id) &&
                                                                    (salesClientDataForm.clientPrice?.value && consultant.value?.consultantPDCRate); else calculateFixedPDCMarginNotPossible">
                                                                    <span>
                                                                        Calculated margin
                                                                        {{ (salesClientDataForm.clientPrice?.value * 1 -  consultant?.value?.consultantPDCRate * 1)/ salesClientDataForm.clientPrice?.value * 1 | percent: '1.2'}}
                                                                    </span>
                                                                </ng-container>
                                                                <ng-template #calculateFixedPDCMarginNotPossible>
                                                                    Calculate margin is not possible
                                                                </ng-template>
                                                            </div>
                                                        </div>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-container *ngSwitchDefault>
                                                </ng-container>
                                            </ng-container>
                                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100 u-mb--10" [fxHide]="consultant.value.consultantPaymentType?.id !== 1"> <!-- id: 1 - Time based -->
                                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-312" [ngClass]="{'u-mr--12': consultant.value.consultantInvoicingFrequency?.name === 'Manual date'}" [fxHide]="salesClientDataForm.clientRateAndInvoicing?.value?.id !== 2">
                                                    <mat-label>Invoicing frequency</mat-label>
                                                    <mat-select [disabled]="readOnlyMode" [required]="consultant.value.consultantPaymentType?.id === 1 && salesClientDataForm.clientRateAndInvoicing?.value?.id === 2" formControlName="consultantInvoicingFrequency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                        <ng-container *ngFor="let item of invoiceFrequencies; trackBy: trackById">
                                                            <mat-option [value]="item">
                                                                {{ item.name }}
                                                            </mat-option>
                                                        </ng-container>
                                                    </mat-select>
                                                    <mat-error>
                                                        <app-validator [control]="consultant.get('consultantInvoicingFrequency')"></app-validator>
                                                    </mat-error>
                                                </mat-form-field>
                                                <mat-form-field class="formFieldNoMarginPadding form-width-150" [fxHide]="consultant.value.consultantInvoicingFrequency?.name !== 'Manual date'" appearance="outline" [ngClass]="{'disabled-input': readOnlyMode}">
                                                    <mat-label>Date</mat-label>
                                                    <input [disabled]="readOnlyMode" [required]="consultant.value.consultantInvoicingFrequency?.name === 'Manual date'" autocomplete="off" matInput
                                                            [matDatepicker]="consultantInvoicingDatePicker"
                                                            name="consultantInvoicingManualDateFrequency" formControlName="consultantInvoicingManualDate"
                                                            (focus)="consultantInvoicingDatePicker.open()"
                                                            appPreventDoubleClick (throttledClick)="consultantInvoicingDatePicker.open()" readonly>
                                                    <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                                                    <mat-datepicker #consultantInvoicingDatePicker></mat-datepicker>
                                                    <mat-error>
                                                        <app-validator [control]="consultant.get('consultantInvoicingManualDate')"></app-validator>
                                                    </mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100" [fxHide]="consultant.value.consultantPaymentType?.id !== 2"> <!-- id: 2 - Fixed -->
                                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-312" [ngClass]="{'u-mr--12': consultant.value.consultantInvoicingTime?.name === 'Manual date'}">
                                                    <mat-label>Invoicing time</mat-label>
                                                    <mat-select [disabled]="readOnlyMode" [required]="consultant.value.consultantPaymentType?.id === 2" formControlName="consultantInvoicingTime" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                        <ng-container *ngFor="let item of invoicingTimes; trackBy: trackById">
                                                            <mat-option [value]="item">
                                                                {{ item.name }}
                                                            </mat-option>
                                                        </ng-container>
                                                    </mat-select>
                                                    <mat-error>
                                                        <app-validator [control]="consultant.get('consultantInvoicingTime')"></app-validator>
                                                    </mat-error>
                                                </mat-form-field>
                                                <!-- id: 2 - Manual date -->
                                                <mat-form-field class="formFieldNoMarginPadding form-width-150" appearance="outline" [fxHide]="consultant.value?.consultantInvoicingTime?.name !== 'Manual date'" [ngClass]="{'disabled-input': readOnlyMode}">
                                                    <mat-label>Date</mat-label>
                                                    <input [disabled]="readOnlyMode" [required]="consultant.value?.consultantInvoicingTime?.name === 'Manual date'" autocomplete="off" matInput
                                                            [matDatepicker]="consultantInvoiceDatePicker"
                                                            name="consultantInvoicingManualDate" formControlName="consultantInvoicingManualDate"
                                                            (focus)="consultantInvoiceDatePicker.open()"
                                                            appPreventDoubleClick (throttledClick)="consultantInvoiceDatePicker.open()" readonly>
                                                    <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                                                    <mat-datepicker #consultantInvoiceDatePicker></mat-datepicker>
                                                    <mat-error>
                                                        <app-validator [control]="consultant.get('consultantInvoicingManualDate')"></app-validator>
                                                    </mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100" [fxHide]="(!salesClientDataForm.value?.pdcInvoicingEntityId?.id || !consultant.value?.consultantProdataEntity?.id) || (consultant.value?.consultantProdataEntity?.id === salesClientDataForm.value?.pdcInvoicingEntityId?.id)">
                                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-150">
                                                    <mat-label>emagine invoicing currency</mat-label>
                                                    <mat-select [disabled]="readOnlyMode" [required]="(salesClientDataForm.value?.pdcInvoicingEntityId?.id && consultant.value?.consultantProdataEntity?.id) && (consultant.value?.consultantProdataEntity?.id !== salesClientDataForm.value?.pdcInvoicingEntityId?.id)" formControlName="prodataToProdataInvoiceCurrency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                        <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                            <mat-option [value]="item">
                                                                {{ item.name }}
                                                            </mat-option>
                                                        </ng-container>
                                                    </mat-select>
                                                    <mat-error>
                                                        <app-validator [control]="consultant.get('prodataToProdataInvoiceCurrency')"></app-validator>
                                                    </mat-error>
                                                </mat-form-field>
                                            </div>
                                        </ng-container>
                                        <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                            <mat-form-field appearance="outline" class="form-width-559 formFieldNoMarginPadding textarea-input u-mr--12" [ngClass]="{'disabled-input': readOnlyMode}">
                                                <mat-label>Special Payment Terms</mat-label>
                                                <textarea [disabled]="readOnlyMode" [required]="consultant.value?.employmentType?.id !== employmentTypesEnum.FeeOnly && consultant.value?.employmentType?.id !== employmentTypesEnum.Recruitment" matInput autocomplete="new-password" name="specialPaymentTerms" formControlName="specialPaymentTerms" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                                                </textarea>
                                                <mat-error>
                                                    <app-validator [control]="consultant.get('specialPaymentTerms')"></app-validator>
                                                </mat-error>
                                            </mat-form-field>
                                            <ng-container *ngIf="!readOnlyMode || consultant.get('noSpecialPaymentTerms')?.value">
                                                <mat-checkbox [disabled]="readOnlyMode" color="accent" formControlName="noSpecialPaymentTerms" name="noSpecialPaymentTerms" class="black-checkbox u-mt--8" (change)="disableOrEnableInput(consultant?.value?.noSpecialPaymentTerms, consultant?.get('specialPaymentTerms'))">
                                                    None
                                                </mat-checkbox>
                                            </ng-container>
                                        </div>
                                    </div>
                                </div>

                                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                    <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                        <span class="workflow-section--number">6</span>
                                        <h2 class="workflow-section--header">Consultant contract</h2>
                                    </div>
                                    <div class="workflow-section--content">
                                        <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding textarea-input u-mr--12 form-width-559" [ngClass]="{'disabled-input': readOnlyMode}">
                                                <mat-label>Special Contract Terms</mat-label>
                                                <textarea [disabled]="readOnlyMode" [required]="consultant.value?.employmentType?.id !== employmentTypesEnum.FeeOnly && consultant.value?.employmentType?.id !== employmentTypesEnum.Recruitment" matInput autocomplete="new-password" name="consultantSpecialContractTerms" formControlName="consultantSpecialContractTerms" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                                                </textarea>
                                                <mat-error>
                                                    <app-validator [control]="consultant.get('consultantSpecialContractTerms')"></app-validator>
                                                </mat-error>
                                            </mat-form-field>
                                            <ng-container *ngIf="!readOnlyMode || consultant.get('consultantSpecialContractTermsNone')?.value">
                                                <mat-checkbox [disabled]="readOnlyMode" color="accent" formControlName="consultantSpecialContractTermsNone" name="consultantSpecialContractTermsNone" class="black-checkbox u-mt--8" (change)="disableOrEnableInput(consultant?.value?.consultantSpecialContractTermsNone, consultant?.get('consultantSpecialContractTerms'))">
                                                    None
                                                </mat-checkbox>
                                            </ng-container>
                                        </div>
                                    </div>
                                </div>
                                <ng-container *ngIf="(consultant.value?.consultantProdataEntity?.id && salesClientDataForm.value?.pdcInvoicingEntityId?.id) && (consultant.value?.consultantProdataEntity?.id !== salesClientDataForm.value?.pdcInvoicingEntityId?.id)">
                                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                            <span class="workflow-section--number">7</span>
                                            <h2 class="workflow-section--header">Account manager</h2>
                                        </div>
                                        <div class="workflow-section--content">
                                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                                <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-235" [ngClass]="{'disabled-input': readOnlyMode}">
                                                    <mat-label>Delivery Account manager</mat-label>
                                                    <input [disabled]="readOnlyMode" required #deliveryManagerFilterInput type="text" matInput [matAutocomplete]="deliveryManagerAutocomplete" formControlName="deliveryAccountManager" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Select account manager(s)">
                                                    <mat-autocomplete #deliveryManagerAutocomplete="matAutocomplete" [displayWith]="displayNameFn"
                                                        (optionSelected)="focusOutMethod()" (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                                        <ng-container *ngFor="let manager of filteredAccountManagers; trackBy: trackById">
                                                            <mat-option [value]="manager" [ngClass]="{ 'no-data': manager.id === 'no-data' }">
                                                                <span class="autocopmlete-option-name">{{ manager.name }}</span>
                                                            </mat-option>
                                                        </ng-container>
                                                    </mat-autocomplete>
                                                    <mat-error>
                                                        <app-validator [control]="consultant.get('deliveryAccountManager')"></app-validator>
                                                    </mat-error>
                                                </mat-form-field>
                                                <ng-container *ngIf="!readOnlyMode || consultant.get('deliveryManagerSameAsAccountManager')?.value">
                                                    <mat-checkbox color="accent" formControlName="deliveryManagerSameAsAccountManager" name="deliveryManagerSameAsAccountManager" class="black-checkbox u-mt--8"
                                                        [disabled]="readOnlyMode"
                                                        (change)="setValueAndToggleDisalbeState(consultant?.value?.deliveryManagerSameAsAccountManager, consultant?.get('deliveryAccountManager'), salesMainDataForm.salesAccountManagerIdValue?.value)">
                                                        Same as account manager
                                                    </mat-checkbox>
                                                </ng-container>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </div>
                    </ng-container>
                    <ng-container *ngIf="!readOnlyMode">
                        <ng-container *ngIf="(appEnv.production && consultantsForm.consultantData.controls.length === 0) || (appEnv.dev || appEnv.qa)">
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100" [fxHide]="activeSideSection.typeId !== workflowSideSections.StartClientPeriod || (isCompleted !== editEnabledForcefuly)">
                                <button class="button-add mat-elevation-z0 u-mt--10 u-mb--10"  type="button" mat-flat-button appPreventDoubleClick (throttledClick)="addConsultantForm()">
                                    <mat-icon>add</mat-icon>
                                    Add consultant
                                </button>
                            </div>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>
        </form>
    </ng-container>
</div>
<ng-template #terminationTemplate>
    <form [formGroup]="salesTerminateConsultantForm" class="workflow-form--consultants workflow--termination u-mb--20 u-w--100">
        <div fxLayout="column" fxLayoutAlign="start start" class="workflow-sales--process-data u-w--100">
            <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                <h1 class="workflow-section--header-main">Termination data</h1>
                <div fxLayout="row" fxLayoutAlign="start center" class="u-mb--16">
                    <span class="workflow-section--number">1</span>
                    <h2 class="workflow-section--header">
                        <ng-container *ngIf="activeSideSection.typeId === workflowSideSections.TerminateConsultant">
                            End of Consultant Contract
                        </ng-container>
                        <ng-container *ngIf="activeSideSection.typeId === workflowSideSections.TerminateWorkflow">
                            End of Client Contract
                        </ng-container>
                    </h2>
                </div>
                <div class="workflow-section--content">
                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--10">
                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-235">
                            <mat-label>
                                <ng-container *ngIf="activeSideSection.typeId === workflowSideSections.TerminateConsultant">
                                    End of Consultant Contract
                                </ng-container>
                                <ng-container *ngIf="activeSideSection.typeId === workflowSideSections.TerminateWorkflow">
                                    End of Client Contract
                                </ng-container>
                            </mat-label>
                            <mat-select [disabled]="readOnlyMode" required formControlName="terminationTime" [disableOptionCentering]="true">
                                <ng-container *ngFor="let item of nonStandartTerminationTimes | keyvalue">
                                    <mat-option [value]="+item.key">
                                        {{ item.value }}
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-error>
                                <app-validator [control]="salesTerminateConsultantForm.terminationTime"></app-validator>
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <ng-container *ngIf="salesTerminateConsultantForm?.terminationTime?.value === 2">
                        <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding form-width-150" [ngClass]="{'disabled-input': readOnlyMode}">
                                <mat-label>End date</mat-label>
                                <input [disabled]="readOnlyMode" required autocomplete="off" matInput
                                        [matDatepicker]="endClientContractEndDatePicker"
                                        name="clientContractEndDate" formControlName="endDate"
                                        (focus)="endClientContractEndDatePicker.open()"
                                        appPreventDoubleClick (throttledClick)="endClientContractEndDatePicker.open()" readonly>
                                <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                                <mat-datepicker #endClientContractEndDatePicker></mat-datepicker>
                                <mat-error>
                                    <app-validator [control]="salesTerminateConsultantForm.endDate"></app-validator>
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="salesTerminateConsultantForm?.terminationTime?.value === 2 || salesTerminateConsultantForm?.terminationTime?.value === 3">
                        <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-235">
                                <mat-label>Termination reason</mat-label>
                                <mat-select [disabled]="readOnlyMode" required formControlName="terminationReason" [disableOptionCentering]="true">
                                    <ng-container *ngFor="let item of terminationReasons | keyvalue">
                                        <mat-option [value]="+item.key">
                                            {{ item.value }}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>
                                <mat-error>
                                    <app-validator [control]="salesTerminateConsultantForm.terminationReason"></app-validator>
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </ng-container>

                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100" [fxHide]="salesTerminateConsultantForm?.terminationTime?.value !== 2 && salesTerminateConsultantForm?.terminationTime?.value !== 3">
                        <mat-form-field appearance="outline" class="textarea-input formFieldNoMarginPadding form-width-559" [ngClass]="{'disabled-input': readOnlyMode}">
                            <mat-label>Cause</mat-label>
                            <textarea [disabled]="readOnlyMode" [required]="salesTerminateConsultantForm.terminationTime?.value === 2 || salesTerminateConsultantForm.terminationTime?.value === 3" matInput autocomplete="new-password" name="causeOfTerminationBeforeEndOfContract" formControlName="causeOfNonStandardTerminationTime" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                            </textarea>
                            <mat-error>
                                <app-validator [control]="salesTerminateConsultantForm.causeOfNonStandardTerminationTime"></app-validator>
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--20 u-mt--10">
                        <mat-form-field appearance="outline" class="textarea-input formFieldNoMarginPadding form-width-559" [ngClass]="{'disabled-input': readOnlyMode}">
                            <mat-label>Additional comments</mat-label>
                            <textarea [disabled]="readOnlyMode" [readonly]="readOnlyMode" matInput autocomplete="new-password" name="additionalComments" formControlName="additionalComments" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                            </textarea>
                        </mat-form-field>
                    </div>
                </div>
            </div>
            <ng-container *ngIf="salesTerminateConsultantForm.terminationTime?.value === 1 || salesTerminateConsultantForm.terminationTime?.value === 2">
                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                    <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                        <span class="workflow-section--number">2</span>
                        <h2 class="workflow-section--header">Final evaluation</h2>
                    </div>
                    <div class="workflow-section--content">
                        <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--10 u-mt--10">
                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-235" [ngClass]="{'disabled-input': salesTerminateConsultantForm.noEvaluation?.value || readOnlyMode}">
                                <mat-label>Final Evaluation Reference Person</mat-label>
                                <input [disabled]="readOnlyMode" [readonly]="readOnlyMode" rqeuired #finalEvaluationReferencePersonInput type="text" matInput [matAutocomplete]="finalEvaluationReferencePersonAutocomplete" formControlName="finalEvaluationReferencePerson" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Final Evaluation Reference Person">
                                <mat-autocomplete #finalEvaluationReferencePersonAutocomplete="matAutocomplete" [displayWith]="displayFullNameFn"
                                    (optionSelected)="focusOutMethod()" (opened)="focusInMethod()" (closed)="focusOutMethod()">
                                    <ng-container *ngFor="let contact of filteredFinalEvaluationReferencePersons; trackBy: trackById">
                                        <mat-option [value]="contact" [ngClass]="{ 'no-data': contact.id === 'no-data' }">
                                                <span class="autocopmlete-option-name">{{ contact.firstName + ' ' + contact.lastName }}</span>
                                        </mat-option>
                                    </ng-container>
                                </mat-autocomplete>
                                <mat-error>
                                    <app-validator [control]="salesTerminateConsultantForm.finalEvaluationReferencePerson"></app-validator>
                                </mat-error>
                            </mat-form-field>
                        </div>
                        <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--20">
                            <ng-container *ngIf="!readOnlyMode || salesTerminateConsultantForm.noEvaluation?.value">
                                <mat-checkbox [disabled]="readOnlyMode" color="accent" formControlName="noEvaluation" name="noEvaluation" class="black-checkbox" (change)="disableOrEnableInput(salesTerminateConsultantForm.noEvaluation?.value, salesTerminateConsultantForm.finalEvaluationReferencePerson)">
                                    No evaluation
                                </mat-checkbox>
                            </ng-container>
                        </div>
                        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100 u-mb--10" [fxHide]="!salesTerminateConsultantForm.noEvaluation?.value">
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                <mat-form-field appearance="outline" class="textarea-input formFieldNoMarginPadding form-width-559" [ngClass]="{'disabled-input': readOnlyMode}">
                                    <mat-label>Cause</mat-label>
                                    <textarea [disabled]="readOnlyMode" [required]="salesTerminateConsultantForm.noEvaluation?.value" matInput autocomplete="new-password" name="causeOfNoEvaluation" formControlName="causeOfNoEvaluation" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                                    </textarea>
                                    <mat-error>
                                        <app-validator [control]="salesTerminateConsultantForm.causeOfNoEvaluation"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>
        </div>
    </form>
</ng-template>

<ng-template #clientAdditionalInfo let-client="client">
    <div fxLayout="row wrap" fxLayoutAlign="start center" class="u-w--100">
        <ng-container *ngIf="client?.address || client?.address2 || client?.countryName || client?.city || client?.postCode">
            <span class="workflow-sales--additional-address-hint-label u-mr--5">
                Address:
            </span>
            <span class="workflow-sales--additional-address-hint u-mr--5">
                {{client?.address ? client?.address + ', ' : ''}}
                {{client?.address2 ? client?.address2 + ', ' : ''}}
                {{client?.city ? client?.city + ', ' : ''}}
                {{client?.countryName ? client?.countryName + ', ' : ''}}
                {{client?.postCode ? client?.postCode : ''}}
            </span>
        </ng-container>
        <ng-container *ngIf="client?.clientId">
            <span class="workflow-sales--additional-address-hint-label u-mr--5">
                | Client ID:
            </span>
            <span class="workflow-sales--additional-address-hint">
                {{client?.clientId ? '#' + client?.clientId : ''}}
            </span>
        </ng-container>

        <ng-container *ngIf="client?.clientId">
            <button class="link-to-client-icon u-ml--10" mat-icon-button
                (click)="openInNewTab(client?.clientId)"
                [matTooltip]="'Link to Client profile'" matTooltipClass="white-tooltip">
                <mat-icon svgIcon="link-to-client-icon"></mat-icon>
            </button>
        </ng-container>

        <ng-container *ngIf="client?.clientId">
            <button class="link-to-client-icon" mat-icon-button
                (click)="openInHubspot(client)"
                [disabled]="client.crmClientId === null || client.crmClientId === undefined"
                [matTooltip]="'Link to Hubspot'" matTooltipClass="white-tooltip">
                <mat-icon svgIcon="link-to-client-hubspot-icon"></mat-icon>
            </button>
        </ng-container>
    </div>
</ng-template>
