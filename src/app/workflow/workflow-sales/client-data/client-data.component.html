<form [formGroup]="salesClientDataForm" id="clientData" class="workflow-form workflow-form--client u-w--100"
    id="salesClientDataAnchor">
    <div fxLayout="column" fxLayoutAlign="start start" class="workflow-sales--process-data u-w--100">
        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientRelation">
            <h1 class="workflow-section--header-main">Client data</h1>
            <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                <span class="workflow-section--number">1</span>
                <h2 class="workflow-section--header">Client relation</h2>
            </div>
            <div class="workflow-section--content">
                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                    <mat-button-toggle-group [disabled]="readOnlyMode"
                        [ngClass]="{'mat-form-field-invalid': !salesClientDataForm.differentEndClient?.valid}"
                        class="workflow-toggle-buttons u-mb--10" formControlName="differentEndClient" required>
                        <ng-container *ngIf="(readOnlyMode && !salesClientDataForm.differentEndClient?.value) || !readOnlyMode">
                            <mat-button-toggle [value]="false">
                                Direct client
                            </mat-button-toggle>
                        </ng-container>
                        <ng-container *ngIf="(readOnlyMode && salesClientDataForm.differentEndClient?.value) || !readOnlyMode">
                            <mat-button-toggle [value]="true">
                                Different end-client
                            </mat-button-toggle>
                        </ng-container>
                    </mat-button-toggle-group>
                    <mat-error>
                        <ng-container *ngIf="salesClientDataForm.differentEndClient?.touched">
                            <app-validator [withoutFormField]="true" [control]="salesClientDataForm.differentEndClient"></app-validator>
                        </ng-container>
                    </mat-error>
                </div>
                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                        <mat-form-field appearance="outline"
                            class="formFieldNoMarginPadding form-width-330 autocompleteWithShevron client-address-autocomplete u-mr--12 "
                            [ngClass]="{'disabled-input': readOnlyMode, 'isPanelOpen': directClientAutocomplete.isOpen, 'is-empty': !salesClientDataForm.directClientIdValue.value}">
                            <mat-label>Direct client</mat-label>
                            <input [disabled]="readOnlyMode" required #directClientFilterInput type="text" matInput
                                [matAutocomplete]="directClientAutocomplete" formControlName="directClientIdValue"
                                appPreventDoubleClick (throttledClick)="$event.stopPropagation()"
                                placeholder="Direct client name + address">
                            <ng-container *ngIf="salesClientDataForm.directClientIdValue?.value?.clientId" matPrefix>
                                <ng-container [ngTemplateOutlet]="clientPrefix"
                                    [ngTemplateOutletContext]="{client: salesClientDataForm.directClientIdValue?.value}">
                                </ng-container>
                            </ng-container>
                            <span matSuffix class="shevron"></span>
                            <mat-autocomplete #directClientAutocomplete="matAutocomplete"
                                [displayWith]="displayClientNameFn" (optionSelected)="directClientSelected($event)"
                                (opened)="focusToggleMethod('hidden')" (closed)="focusToggleMethod('auto')">
                                <ng-container *ngFor="let client of filteredDirectClients; trackBy: trackById">
                                    <mat-option [value]="client" [ngClass]="{ 'no-data': client?.clientId === undefined }">
                                        <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                            <span class="multilineDropdown-option--column-client-name">{{
                                                client.clientName }}</span>
                                            <ng-container *ngIf="client?.clientId !== undefined && client?.clientAddresses?.length">
                                                <span
                                                    class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                                    #{{client.clientId}} | {{client.clientAddresses[0]?.city ?? ''}} {{client.clientAddresses[0]?.countryName ?
                                                    ', ' + client.clientAddresses[0]?.countryName : ''}}
                                                </span>
                                            </ng-container>
                                        </div>
                                    </mat-option>
                                </ng-container>
                            </mat-autocomplete>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.directClientIdValue"></app-validator>
                            </mat-error>
                        </mat-form-field>
                        <mat-form-field appearance="outline" [ngClass]="{'is-empty': !salesClientDataForm.directClientAddress.value}"
                            class="formFieldNoMarginPadding filter-select form-width-330 client-address-autocomplete">
                            <mat-label>Client address</mat-label>
                            <mat-select [disabled]="readOnlyMode" formControlName="directClientAddress"
                                [disableOptionCentering]="true" placeholder="Direct client address" [compareWith]="compareWithFn" required>
                                <mat-select-trigger>
                                    <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                        <span class="multilineDropdown-option--column-client-name">
                                            {{salesClientDataForm.directClientAddress?.value?.displayValue }}</span>
                                        <span class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                            {{salesClientDataForm.directClientAddress?.value?.addressType}}
                                        </span>
                                    </div>
                                </mat-select-trigger>
                                <ng-container *ngFor="let item of directClientAddresses; trackBy: trackById">
                                    <mat-option [value]="item">
                                        <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                            <span class="multilineDropdown-option--column-client-name">
                                                {{item.displayValue }}</span>
                                            <span class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                                {{item.addressType}}
                                            </span>
                                        </div>
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.directClientAddress"></app-validator>
                            </mat-error>
                        </mat-form-field>
                    </div>
                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                        <div class="form-width-330 u-mr--12"></div>
                        <div class="form-width-330">
                            <ng-container [ngTemplateOutlet]="clientAdditionalInfo"
                                [ngTemplateOutletContext]="{client: salesClientDataForm.directClientIdValue?.value}">
                            </ng-container>
                        </div>
                    </div>
                </div>
                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100"
                    [fxHide]="!salesClientDataForm.differentEndClient?.value">
                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                        <mat-form-field appearance="outline"
                            class="formFieldNoMarginPadding form-width-330 autocompleteWithShevron client-address-autocomplete u-mr--12"
                            [ngClass]="{'disabled-input': readOnlyMode, 'isPanelOpen': endClientAutocomplete.isOpen, 'is-empty': !salesClientDataForm.endClientIdValue.value}">
                            <mat-label>End client</mat-label>
                            <input [disabled]="readOnlyMode" [required]="salesClientDataForm.differentEndClient?.value"
                                #endClientFilterInput type="text" matInput [matAutocomplete]="endClientAutocomplete"
                                formControlName="endClientIdValue" appPreventDoubleClick
                                (throttledClick)="$event.stopPropagation()" placeholder="End client name + address">
                            <ng-container *ngIf="salesClientDataForm.endClientIdValue?.value?.clientId" matPrefix>
                                <ng-container [ngTemplateOutlet]="clientPrefix"
                                    [ngTemplateOutletContext]="{client: salesClientDataForm.endClientIdValue?.value}">
                                </ng-container>
                            </ng-container>
                            <span matSuffix class="shevron"></span>
                            <mat-autocomplete #endClientAutocomplete="matAutocomplete"
                                [displayWith]="displayClientNameFn" (optionSelected)="clientSelected($event, eClientSelectionType.EndClient)"
                                (opened)="focusToggleMethod('hidden')" (closed)="focusToggleMethod('auto')">
                                <ng-container *ngFor="let client of filteredEndClients; trackBy: trackById">
                                    <mat-option [value]="client" [ngClass]="{ 'no-data': client?.clientId === undefined }">
                                        <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                            <span class="multilineDropdown-option--column-client-name">{{
                                                client.clientName }}</span>
                                            <ng-container *ngIf="client?.clientId !== undefined && client?.clientAddresses?.length">
                                                <span
                                                    class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                                    #{{client.clientId}} | {{client.clientAddresses[0]?.city ?? ''}} {{client.clientAddresses[0]?.countryName ?
                                                    ', ' + client.clientAddresses[0]?.countryName : ''}}
                                                </span>
                                            </ng-container>
                                        </div>
                                    </mat-option>
                                </ng-container>
                            </mat-autocomplete>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.endClientIdValue"></app-validator>
                            </mat-error>
                        </mat-form-field>
                        <mat-form-field appearance="outline" [ngClass]="{'is-empty': !salesClientDataForm.endClientAddress.value}"
                            class="formFieldNoMarginPadding filter-select form-width-330 client-address-autocomplete">
                            <mat-label>Client address</mat-label>
                            <mat-select [disabled]="readOnlyMode" formControlName="endClientAddress"
                            [disableOptionCentering]="true" [compareWith]="compareWithFn" required>
                                <mat-select-trigger>
                                    <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                        <span class="multilineDropdown-option--column-client-name">
                                            {{salesClientDataForm.endClientAddress?.value?.displayValue }}</span>
                                        <span class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                            {{salesClientDataForm.endClientAddress?.value?.addressType}}
                                        </span>
                                    </div>
                                </mat-select-trigger>
                                <ng-container *ngFor="let item of endClientAddresses; trackBy: trackById">
                                    <mat-option [value]="item">
                                        <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                            <span class="multilineDropdown-option--column-client-name">
                                                {{item.displayValue }}</span>
                                            <span class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                                {{item.addressType}}
                                            </span>
                                        </div>
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.endClientAddress"></app-validator>
                            </mat-error>
                        </mat-form-field>
                    </div>
                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                        <div class="form-width-330 u-mr--12"></div>
                        <div class="form-width-330">
                            <ng-container [ngTemplateOutlet]="clientAdditionalInfo"
                                [ngTemplateOutletContext]="{client: salesClientDataForm.endClientIdValue?.value}">
                            </ng-container>
                        </div>
                    </div>
                </div>

                <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                    <mat-form-field appearance="outline"
                        class="formFieldNoMarginPadding filter-select autocompleteWithShevron u-mr--12 form-width-312"
                        [ngClass]="{'disabled-input': readOnlyMode, 'isPanelOpen': projectManagerAutocomplete.isOpen}">
                        <mat-label>Client contact / Project manager</mat-label>
                        <input [disabled]="readOnlyMode" type="text"
                            matInput [matAutocomplete]="projectManagerAutocomplete"
                            formControlName="clientContactProjectManager" appPreventDoubleClick
                            (throttledClick)="$event.stopPropagation()" placeholder="Type something..">
                            <span matSuffix class="shevron"></span>
                        <mat-autocomplete #projectManagerAutocomplete="matAutocomplete"
                            [displayWith]="displayFullNameFn" (optionSelected)="focusToggleMethod('auto')"
                            (opened)="focusToggleMethod('hidden')" (closed)="focusToggleMethod('auto')">
                            <ng-container *ngFor="let contact of filteredProjectManagers; trackBy: trackById">
                                <mat-option [value]="contact" [ngClass]="{ 'no-data': contact?.id === undefined }">
                                    <span class="autocopmlete-option-name">{{ contact.firstName + ' ' +
                                        contact.lastName }}</span>
                                </mat-option>
                            </ng-container>
                        </mat-autocomplete>
                        <mat-error>
                            <app-validator
                                [control]="salesClientDataForm.invoicePaperworkContactIdValue"></app-validator>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>
        </div>
        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientProjectDuration">
            <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                <span class="workflow-section--number">2</span>
                <h2 class="workflow-section--header">Client project duration</h2>
            </div>
            <div class="workflow-section--content">
                <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                    <mat-form-field appearance="outline" class="u-mr--12 formFieldNoMarginPadding form-width-150"
                        [ngClass]="{'disabled-input': readOnlyMode}">
                        <mat-label>Start date</mat-label>
                        <input [disabled]="readOnlyMode" required autocomplete="off" matInput
                            [matDatepicker]="clientContractStartDatePicker" name="clientContractStartDate"
                            formControlName="startDate" (focus)="clientContractStartDatePicker.open()"
                            appPreventDoubleClick (throttledClick)="clientContractStartDatePicker.open()" readonly>
                        <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                        <mat-datepicker #clientContractStartDatePicker></mat-datepicker>
                        <mat-error>
                            <app-validator [control]="salesClientDataForm.startDate"></app-validator>
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="u-mr--12 formFieldNoMarginPadding form-width-150"
                        [ngClass]="{'disabled-input': readOnlyMode}">
                        <mat-label>End date</mat-label>
                        <input [disabled]="readOnlyMode" required autocomplete="off" matInput
                            [matDatepicker]="clientContractEndDatePicker" name="clientContractEndDate"
                            formControlName="endDate" (focus)="clientContractEndDatePicker.open()"
                            appPreventDoubleClick (throttledClick)="clientContractEndDatePicker.open()" readonly>
                        <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                        <mat-datepicker #clientContractEndDatePicker></mat-datepicker>
                        <mat-error>
                            <app-validator [control]="salesClientDataForm.endDate"></app-validator>
                        </mat-error>
                    </mat-form-field>
                    <ng-container *ngIf="!readOnlyMode || salesClientDataForm.noEndDate?.value">
                        <mat-checkbox [disabled]="readOnlyMode" color="accent" formControlName="noEndDate"
                            name="clientContractNoEndDate" class="black-checkbox"
                            (change)="disableOrEnableInput(salesClientDataForm.noEndDate?.value, salesClientDataForm.endDate)">
                            No end date
                        </mat-checkbox>
                    </ng-container>
                </div>
                <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                    <mat-form-field appearance="outline"
                        class="formFieldNoMarginPadding filter-select u-mr--12 form-width-150">
                        <mat-label>Option to extend</mat-label>
                        <mat-select [disabled]="readOnlyMode" formControlName="noClientExtensionOption"
                            [disableOptionCentering]="true" required>
                            <mat-option [value]="false">
                                Option to extend
                            </mat-option>
                            <mat-option [value]="true">
                                No option
                            </mat-option>
                        </mat-select>
                        <mat-error>
                            <app-validator [control]="salesClientDataForm.noClientExtensionOption"></app-validator>
                        </mat-error>
                    </mat-form-field>
                    <ng-container *ngIf="!salesClientDataForm.noClientExtensionOption?.value">
                        <mat-form-field appearance="outline"
                            class="filter-select formFieldNoMarginPadding u-mr--12 form-width-150">
                            <mat-label> Duration</mat-label>
                            <mat-select [disabled]="readOnlyMode"
                                [required]="!salesClientDataForm.noClientExtensionOption?.value"
                                formControlName="clientExtensionDurationId" [disableOptionCentering]="true">
                                <ng-container *ngFor="let item of clientExtensionDurations; trackBy: trackById">
                                    <mat-option [value]="item.id">
                                        {{ item.name }}
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.clientExtensionDurationId"></app-validator>
                            </mat-error>
                        </mat-form-field>
                        <mat-form-field appearance="outline"
                            class="filter-select formFieldNoMarginPadding u-mr--12 form-width-150">
                            <mat-label> Deadline</mat-label>
                            <mat-select [disabled]="readOnlyMode"
                                [required]="!salesClientDataForm.noClientExtensionOption?.value"
                                formControlName="clientExtensionDeadlineId" [disableOptionCentering]="true">
                                <ng-container *ngFor="let item of clientExtensionDeadlines; trackBy: trackById">
                                    <mat-option [value]="item.id">
                                        {{ item.name }}
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.clientExtensionDeadlineId"></app-validator>
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field class="formFieldNoMarginPadding form-width-150" appearance="outline"
                            [fxHide]="salesClientDataForm.clientExtensionDeadlineId?.value?.name !== 'Manual date'"
                            [ngClass]="{'disabled-input': readOnlyMode}">
                            <mat-label>Specific date</mat-label>
                            <input [disabled]="readOnlyMode"
                                [required]="salesClientDataForm.clientExtensionDeadlineId?.value?.name === 'Manual date'"
                                autocomplete="off" matInput [matDatepicker]="clientExtensionEndDatePicker"
                                name="clientExtensionEndDate" formControlName="clientExtensionSpecificDate"
                                (focus)="clientExtensionEndDatePicker.open()" appPreventDoubleClick
                                (throttledClick)="clientExtensionEndDatePicker.open()" readonly>
                            <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                            <mat-datepicker #clientExtensionEndDatePicker></mat-datepicker>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.clientExtensionSpecificDate"></app-validator>
                            </mat-error>
                        </mat-form-field>
                    </ng-container>
                </div>
            </div>
        </div>

        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientInvoicing">
            <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                <span class="workflow-section--number">3</span>
                <h2 class="workflow-section--header">Client invoicing</h2>
            </div>
            <div class="workflow-section--content">
                <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-312">
                        <mat-label>emagine entity</mat-label>
                        <mat-select [disabled]="readOnlyMode" required formControlName="pdcInvoicingEntityId"
                            [disableOptionCentering]="true">
                            <ng-container *ngFor="let item of legalEntities; trackBy: trackById">
                                <mat-option [value]="item.id">
                                    {{ item.tenantName + ' ' + '(' + item.name + ')' }}
                                </mat-option>
                            </ng-container>
                        </mat-select>
                        <mat-error>
                            <app-validator [control]="salesClientDataForm.pdcInvoicingEntityId"></app-validator>
                        </mat-error>
                    </mat-form-field>
                </div>
                <ng-container *ngIf="salesClientDataForm.value?.pdcInvoicingEntityId">
                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100 u-mb--15">
                        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                <mat-form-field appearance="outline"
                                    class="formFieldNoMarginPadding form-width-330 autocompleteWithShevron client-address-autocomplete u-mr--12"
                                    [ngClass]="{'disabled-input': readOnlyMode, 'isPanelOpen': clientInvoicingRecipientAutocomplete.isOpen, 'is-empty': !salesClientDataForm.clientInvoicingRecipientIdValue.value}">
                                    <mat-label>Client invoicing recipient</mat-label>
                                    <input [disabled]="readOnlyMode" #clientInvoicingRecipientInput type="text" matInput
                                        [matAutocomplete]="clientInvoicingRecipientAutocomplete"
                                        formControlName="clientInvoicingRecipientIdValue" appPreventDoubleClick
                                        (throttledClick)="$event.stopPropagation()"
                                        placeholder="Client invoicing recipient">
                                        <ng-container *ngIf="salesClientDataForm.clientInvoicingRecipientIdValue?.value?.clientId" matPrefix>
                                            <ng-container [ngTemplateOutlet]="clientPrefix"
                                                [ngTemplateOutletContext]="{client: salesClientDataForm.clientInvoicingRecipientIdValue?.value}">
                                            </ng-container>
                                        </ng-container>
                                        <span matSuffix class="shevron"></span>
                                    <mat-autocomplete #clientInvoicingRecipientAutocomplete="matAutocomplete"
                                        [displayWith]="displayClientNameFn" (optionSelected)="clientSelected($event, eClientSelectionType.InvoicingRecipient)"
                                        (opened)="focusToggleMethod('hidden')" (closed)="focusToggleMethod('auto')">
                                        <ng-container
                                            *ngFor="let client of filteredClientInvoicingRecipients; trackBy: trackById">
                                            <mat-option [value]="client" [ngClass]="{ 'no-data': client?.clientId === undefined }">
                                                <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                                    <span class="multilineDropdown-option--column-client-name">{{
                                                        client.clientName }}</span>
                                                    <ng-container *ngIf="client?.clientId !== undefined && client?.clientAddresses?.length">
                                                        <span
                                                            class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                                            #{{client.clientId}} | {{client.clientAddresses[0]?.city ?? ''}}
                                                            {{client.clientAddresses[0]?.countryName ? ', ' + client.clientAddresses[0]?.countryName : ''}}
                                                        </span>
                                                    </ng-container>
                                                </div>
                                            </mat-option>
                                        </ng-container>
                                    </mat-autocomplete>
                                    <mat-error>
                                        <app-validator
                                            [control]="salesClientDataForm.clientInvoicingRecipientIdValue"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                                <mat-form-field appearance="outline" [ngClass]="{'is-empty': !salesClientDataForm.clientInvoicingRecipientAddress.value}"
                                    class="formFieldNoMarginPadding filter-select form-width-330 client-address-autocomplete">
                                    <mat-label>Client address</mat-label>
                                    <mat-select [disabled]="readOnlyMode" formControlName="clientInvoicingRecipientAddress"
                                        [disableOptionCentering]="true" [compareWith]="compareWithFn" required>
                                        <mat-select-trigger>
                                            <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                                <span class="multilineDropdown-option--column-client-name">
                                                    {{salesClientDataForm.clientInvoicingRecipientAddress?.value?.displayValue }}</span>
                                                <span class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                                    {{salesClientDataForm.clientInvoicingRecipientAddress?.value?.addressType}}
                                                </span>
                                            </div>
                                        </mat-select-trigger>
                                        <ng-container *ngFor="let item of invoicingRecipientsAddresses; trackBy: trackById">
                                            <mat-option [value]="item">
                                                <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                                    <span class="multilineDropdown-option--column-client-name">
                                                        {{item.displayValue }}</span>
                                                    <span class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                                        {{item.addressType}}
                                                    </span>
                                                </div>
                                            </mat-option>
                                        </ng-container>
                                    </mat-select>
                                    <mat-error>
                                        <app-validator [control]="salesClientDataForm.clientInvoicingRecipientAddress"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                            <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                <div class="form-width-330 u-mr--12">
                                    <ng-container
                                        *ngIf="!readOnlyMode || salesClientDataForm.clientInvoicingRecipientSameAsDirectClient?.value">
                                        <mat-checkbox [disabled]="readOnlyMode" color="accent"
                                            formControlName="clientInvoicingRecipientSameAsDirectClient"
                                            name="clientInvoicingRecipientSameAsDirectClient" class="black-checkbox"
                                            (change)="setValueAndToggleDisalbeState(salesClientDataForm.clientInvoicingRecipientSameAsDirectClient?.value, salesClientDataForm.clientInvoicingRecipientIdValue, salesClientDataForm.directClientIdValue?.value)">
                                            Same as direct client
                                        </mat-checkbox>
                                    </ng-container>
                                </div>
                                <div class="form-width-330">
                                    <ng-container [ngTemplateOutlet]="clientAdditionalInfo"
                                        [ngTemplateOutletContext]="{client: salesClientDataForm.clientInvoicingRecipientIdValue?.value}">
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                        <mat-form-field appearance="outline"
                            class="formFieldNoMarginPadding filter-select u-mr--12 form-width-150">
                            <mat-label>Price type</mat-label>
                            <mat-select [disabled]="readOnlyMode" required formControlName="clientRateAndInvoicing"
                                [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                <ng-container *ngFor="let item of clientRateTypes; trackBy: trackById">
                                    <mat-option [value]="item">
                                        {{ item.name }}
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.clientRateAndInvoicing"></app-validator>
                            </mat-error>
                        </mat-form-field>
                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding u-mr--12 form-width-150"
                            [ngClass]="{'disabled-input': readOnlyMode}">
                            <mat-label>Rate</mat-label>
                            <input [disabled]="readOnlyMode" required autocomplete="off" matInput
                                formControlName="normalRate" type="number">
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.normalRate"></app-validator>
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline"
                            class="formFieldNoMarginPadding filter-select u-mr--12 form-width-150"
                            [fxHide]="salesClientDataForm.clientRateAndInvoicing?.value?.id !== 1">
                            <mat-label>Unit type</mat-label>
                            <mat-select [disabled]="readOnlyMode"
                                [required]="salesClientDataForm.clientRateAndInvoicing?.value?.id === 1"
                                formControlName="rateUnitTypeId" [disableOptionCentering]="true"
                                [compareWith]="compareWithFn">
                                <ng-container *ngFor="let item of rateUnitTypes; trackBy: trackById">
                                    <mat-option [value]="item.id">
                                        {{ item.name }}
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.rateUnitTypeId"></app-validator>
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline"
                            class="formFieldNoMarginPadding filter-select form-width-150">
                            <mat-label>Currency</mat-label>
                            <mat-select [disabled]="readOnlyMode" required formControlName="clientCurrency"
                                [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                    <mat-option [value]="item">
                                        {{ item.name }}
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.clientCurrency"></app-validator>
                            </mat-error>
                        </mat-form-field>
                    </div>
                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                        <mat-form-field appearance="outline"
                            class="filter-select formFieldNoMarginPadding u-mr--12 form-width-150">
                            <mat-label>Invoicing currency</mat-label>
                            <mat-select [disabled]="readOnlyMode" required formControlName="invoiceCurrencyId"
                                [disableOptionCentering]="true">
                                <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                    <mat-option [value]="item.id">
                                        {{ item.name }}
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.invoiceCurrencyId"></app-validator>
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline"
                            class="formFieldNoMarginPadding filter-select form-width-312"
                            [ngClass]="{'u-mr--12': salesClientDataForm.clientInvoiceFrequency?.value?.name === 'Manual date'}"
                            [fxHide]="salesClientDataForm.clientRateAndInvoicing?.value?.id !== 1">
                            <mat-label>Invoicing frequency</mat-label>
                            <mat-select [disabled]="readOnlyMode"
                                [required]="salesClientDataForm.clientRateAndInvoicing?.value?.id === 1"
                                formControlName="clientInvoiceFrequency" [disableOptionCentering]="true"
                                [compareWith]="compareWithFn">
                                <ng-container *ngFor="let item of invoiceFrequencies; trackBy: trackById">
                                    <mat-option [value]="item">
                                        {{ item.name }}
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.clientInvoiceFrequency"></app-validator>
                            </mat-error>
                        </mat-form-field>
                        <mat-form-field class="formFieldNoMarginPadding form-width-150"
                            [fxHide]="salesClientDataForm.clientInvoiceFrequency?.value?.name !== 'Manual date'"
                            appearance="outline" [ngClass]="{'disabled-input': readOnlyMode}">
                            <mat-label>Date</mat-label>
                            <input [disabled]="readOnlyMode"
                                [required]="salesClientDataForm.clientInvoiceFrequency?.value?.name === 'Manual date'"
                                autocomplete="off" matInput [matDatepicker]="clientInvoicingDatePicker"
                                name="clientInvoicingDate" formControlName="manualDate"
                                (focus)="clientInvoicingDatePicker.open()" appPreventDoubleClick
                                (throttledClick)="clientInvoicingDatePicker.open()" readonly>
                            <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                            <mat-datepicker #clientInvoicingDatePicker></mat-datepicker>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.manualDate"></app-validator>
                            </mat-error>
                        </mat-form-field>
                        <mat-form-field appearance="outline"
                            class="formFieldNoMarginPadding filter-select form-width-312"
                            [ngClass]="{'u-mr--12': salesClientDataForm.clientInvoiceTime?.value?.name === 'Manual date' && salesClientDataForm.clientRateAndInvoicing?.value?.id === 2}"
                            [fxHide]="salesClientDataForm.clientRateAndInvoicing?.value?.id !== 2">
                            <mat-label>Invoicing time</mat-label>
                            <mat-select [disabled]="readOnlyMode"
                                [required]="salesClientDataForm.clientRateAndInvoicing?.value?.id === 2"
                                formControlName="clientInvoiceTime" [disableOptionCentering]="true"
                                [compareWith]="compareWithFn">
                                <ng-container *ngFor="let item of invoicingTimes; trackBy: trackById">
                                    <mat-option [value]="item">
                                        {{ item.name }}
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.clientInvoiceTime"></app-validator>
                            </mat-error>
                        </mat-form-field>
                        <!-- id: 2 - manual date -->
                        <mat-form-field class="formFieldNoMarginPadding form-width-150"
                            [fxHide]="salesClientDataForm.clientRateAndInvoicing?.value?.id !== 2 || salesClientDataForm.clientInvoiceTime?.value?.name !== 'Manual date'"
                            appearance="outline" [ngClass]="{'disabled-input': readOnlyMode}">
                            <mat-label>Date</mat-label>
                            <input [disabled]="readOnlyMode"
                                [required]="salesClientDataForm.clientInvoiceTime?.value?.id === 2" autocomplete="off"
                                matInput [matDatepicker]="clientInvoicingDateDatePicker" name="clientInvoicingDate"
                                formControlName="manualDate" (focus)="clientInvoicingDateDatePicker.open()"
                                appPreventDoubleClick (throttledClick)="clientInvoicingDateDatePicker.open()" readonly>
                            <mat-icon class="calendar-icon" matSuffix svgIcon="calendar"></mat-icon>
                            <mat-datepicker #clientInvoicingDateDatePicker></mat-datepicker>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.manualDate"></app-validator>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </ng-container>
            </div>
        </div>

        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesFrameAgreement">
            <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                <span class="workflow-section--number">4</span>
                <h2 class="workflow-section--header">Frame agreement</h2>
            </div>
            <div class="workflow-section--content">
                <ng-container *ngIf="isContractModuleEnabled; else noFrameAgreementsTemplate">
                    <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-450">
                            <mat-label>Frame agreement</mat-label>
                            <mat-select [disabled]="readOnlyMode" formControlName="frameAgreementId"
                                [disableOptionCentering]="true">
                                <ng-container *ngFor="let item of frameAgreements; trackBy: trackById">
                                    <mat-option [value]="item.agreementId">
                                        <div class="multilineDropdown-option--row">
                                            <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                                <span class="multilineDropdown-option--column-client-name">{{ item.agreementName }}</span>
                                                <span class="multilineDropdown-option--column-client-info text-truncate-ellipsis light-grey-color">
                                                    {{item.countryName}}
                                                    {{item.countryName ? 'â€¢' : '' + item.startDate | momentFormat}}
                                                    {{item.startDate !== null && item.startDate !== undefined ? '-' : '' + item.endDate | momentFormat}}
                                                </span>
                                            </div>
                                        </div>
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-error>
                                <app-validator [control]="salesClientDataForm.frameAgreementId"></app-validator>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </ng-container>
                <ng-template #noFrameAgreementsTemplate>
                    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px"
                        class="emptyStateRow">
                        <span class="light-grey-color text-600">
                            Coming soon - with the contracts module..
                        </span>
                    </div>
                </ng-template>
            </div>
        </div>

        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientInvoicingNumber">
            <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                <span class="workflow-section--number">5</span>
                <h2 class="workflow-section--header">Invoicing number</h2>
            </div>
            <div class="workflow-section--content">
                <ng-container *ngIf="salesClientDataForm.value?.pdcInvoicingEntityId">
                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding form-width-312"
                            [ngClass]="{'disabled-input': readOnlyMode}">
                            <mat-label>Invoicing Reference Number</mat-label>
                            <input [disabled]="readOnlyMode" autocomplete="off" matInput
                                formControlName="invoicingReferenceNumber" type="text">
                        </mat-form-field>
                    </div>

                    <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                        <mat-form-field appearance="outline"
                            class="formFieldNoMarginPadding filter-select autocompleteWithShevron u-mr--12 form-width-312"
                            [ngClass]="{'disabled-input': readOnlyMode, 'isPanelOpen': invoicingReferencePersonAutocomplete.isOpen}">
                            <mat-label>Invoice / Paperwork Contact Person</mat-label>
                            <input [disabled]="readOnlyMode" required #invoicingReferencePersonInput type="text"
                                matInput [matAutocomplete]="invoicingReferencePersonAutocomplete"
                                formControlName="invoicePaperworkContactIdValue" appPreventDoubleClick
                                (throttledClick)="$event.stopPropagation()" placeholder="Invoice / Paperwork Contact">
                                <span matSuffix class="shevron"></span>
                            <mat-autocomplete #invoicingReferencePersonAutocomplete="matAutocomplete"
                                [displayWith]="displayFullNameFn" (optionSelected)="focusToggleMethod('auto')"
                                (opened)="focusToggleMethod('hidden')" (closed)="focusToggleMethod('auto')">
                                <ng-container *ngFor="let contact of filteredReferencePersons; trackBy: trackById">
                                    <mat-option [value]="contact" [ngClass]="{ 'no-data': contact?.id === undefined }">
                                        <span class="autocopmlete-option-name">{{ contact.firstName + ' ' +
                                            contact.lastName }}</span>
                                    </mat-option>
                                </ng-container>
                            </mat-autocomplete>
                            <mat-error>
                                <app-validator
                                    [control]="salesClientDataForm.invoicePaperworkContactIdValue"></app-validator>
                            </mat-error>
                        </mat-form-field>
                        <ng-container *ngIf="!readOnlyMode || salesClientDataForm.invoicingReferencePersonDontShowOnInvoice?.value">
                            <mat-checkbox [disabled]="readOnlyMode" color="accent" formControlName="invoicingReferencePersonDontShowOnInvoice"
                                name="invoicingReferencePersonDontShowOnInvoice" class="black-checkbox">
                                Don't show on invoice
                            </mat-checkbox>
                        </ng-container>
                    </div>
                </ng-container>
            </div>
        </div>

        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientInvoicingNumber">
            <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                <span class="workflow-section--number">5</span>
                <h2 class="workflow-section--header">Client purchase order + cap</h2>
            </div>
            <div class="workflow-section--content">
                <purchase-orders #purchaseOrders [readOnlyMode]="readOnlyMode" [periodId]="periodId" [directClientId]="salesClientDataForm.directClientIdValue.value?.clientId"></purchase-orders>
                <!-- <div class="inline-edit-form u-w--100">
                    <ng-container *ngIf="salesClientDataForm.purchaseOrders?.controls?.length">
                        <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px"
                            class="workflow-sales-inline--form__header-container u-w--100">
                            <span fxFlex class="workflow-sales-inline--form__header u-w--100">
                                Invoicing Ref Nr (PO)
                            </span>
                            <span fxFlex="100px" class="workflow-sales-inline--form__header u-w--100">
                                Receive date
                            </span>
                            <span fxFlex="150px" class="workflow-sales-inline--form__header u-w--100">
                                Cap type
                            </span>
                            <span fxFlex="120px" class="workflow-sales-inline--form__header u-w--100">
                                Used
                            </span>
                            <span fxFlex="120px" class="workflow-sales-inline--form__header u-w--100">
                                Max value
                            </span>
                            <span fxFlex="150px" class="workflow-sales-inline--form__header u-w--100">
                                Units
                            </span>
                            <span fxFlex="80px" class="workflow-sales-inline--form__header u-w--100"
                                [fxHide]="readOnlyMode">
                            </span>
                        </div>
                    </ng-container>
                    <ng-container formArrayName="purchaseOrders" class="u-w--100">
                        <ng-container *ngFor="let order of salesClientDataForm.purchaseOrders.controls; trackBy: trackByItem; index as i"
                            [formArrayName]="i">
                            <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px"
                                class="workflow-sales-inline--form__row u-w--100">
                                <ng-container>
                                    <span fxFlex fxLayoutAlign="start center" class="u-w--100 text-truncate-ellipsis"
                                        [ngClass]="{'medium-grey-color': order.value.numberMissingButRequired}"
                                        [matTooltip]="order.value.numberMissingButRequired ? 'Missing, but required' : (order.value.number ?? '-')" matTooltipClass="white-tooltip"
                                        appShowIfTruncated>
                                        {{order.value.numberMissingButRequired ? 'Missing, but required' : (order.value.number ?? '-') }}
                                        <ng-container *ngIf="order.value.workflowsIdsReferencingThisPo?.length">
                                            <mat-icon class="shared-icon u-ml--10 cursor-pointer" svgIcon="shared-icon" [matTooltip]="'PO shared with another WF'" matTooltipClass="white-tooltip"></mat-icon>
                                        </ng-container>
                                    </span>
                                    <span fxFlex="100px" class="u-w--100 text-truncate-ellipsis"
                                        [matTooltip]="order.value.receiveDate !== null && order.value.receiveDate !== undefined ? (order.value.receiveDate | momentFormat) : '-'" matTooltipClass="white-tooltip"
                                        appShowIfTruncated>
                                        {{ order.value.receiveDate !== null && order.value.receiveDate !== undefined ? (order.value.receiveDate | momentFormat) : '-'}}
                                    </span>
                                    <span fxFlex="150px" class="u-w--100 text-truncate-ellipsis"
                                        [matTooltip]="capTypes[order.value.capForInvoicing?.type]"
                                        matTooltipClass="white-tooltip" appShowIfTruncated>
                                        {{capTypes[order.value.capForInvoicing?.type]}}
                                    </span>
                                    <span fxFlex="120px" class="u-w--100 text-truncate-ellipsis"
                                        [matTooltip]="order.value.capForInvoicing?.amountUsed ?? '-'"
                                        matTooltipClass="white-tooltip" appShowIfTruncated>
                                        {{order.value.capForInvoicing?.amountUsed ?? '-'}}
                                    </span>
                                    <span fxFlex="120px" class="u-w--100 text-truncate-ellipsis"
                                        [matTooltip]="order.value.capForInvoicing?.maxAmount ?? '-'"
                                        matTooltipClass="white-tooltip" appShowIfTruncated>
                                        {{order.value.capForInvoicing?.maxAmount ?? '-'}}
                                    </span>
                                    <ng-container [ngSwitch]="order.value.capForInvoicing?.type">
                                        <ng-container *ngSwitchCase="ePoCapType.CapOnUnits">
                                            <span fxFlex="150px" class="u-w--100 text-truncate-ellipsis"
                                                [matTooltip]="eValueUnitType[order.value.capForInvoicing?.valueUnitTypeId]"
                                                matTooltipClass="white-tooltip" appShowIfTruncated>
                                                {{eValueUnitType[order.value.capForInvoicing?.valueUnitTypeId]}}
                                            </span>
                                        </ng-container>
                                        <ng-container *ngSwitchCase="ePoCapType.CapOnValue">
                                            <span fxFlex="150px" class="u-w--100 text-truncate-ellipsis"
                                                [matTooltip]="order.value.capForInvoicing?.currency?.name"
                                                matTooltipClass="white-tooltip" appShowIfTruncated>
                                                {{order.value.capForInvoicing?.currency?.name}}
                                            </span>
                                        </ng-container>
                                        <ng-container *ngSwitchCase="ePoCapType.NoCap">
                                            <span fxFlex="150px" class="u-w--100 text-truncate-ellipsis">-</span>
                                        </ng-container>
                                    </ng-container>

                                    <div fxFlex="80px" fxLayoutAlign="end center" class="u-w--100"
                                        [fxHide]="readOnlyMode">
                                        <button mat-icon-button type="button" appPreventDoubleClick
                                            (throttledClick)="$event.stopPropagation();"
                                            [matMenuTriggerFor]="poMenu" class="three-dots-actions-btn">
                                            <mat-icon svgIcon="3-dots"></mat-icon>
                                        </button>
                                        <mat-menu #poMenu>
                                            <button class="menu-item green-color"
                                                mat-menu-item appPreventDoubleClick
                                                (throttledClick)="createOrEditPurchaseOrder(order.value, i)">
                                                <mat-icon svgIcon="edit-icon-green"></mat-icon>
                                                Edit
                                            </button>
                                            <button class="menu-item menu-item--cancel" mat-menu-item
                                                appPreventDoubleClick (throttledClick)="removePurchaseOrder(i)">
                                                <mat-icon svgIcon="close-icon"></mat-icon>
                                                Delete
                                            </button>
                                        </mat-menu>
                                    </div>
                                </ng-container>
                            </div>
                        </ng-container>
                        <ng-container *ngIf="salesClientDataForm.purchaseOrders.controls?.length === 0 && readOnlyMode">
                            <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px"
                                class="workflow-sales-inline--form__row u-w--100 border-unset">
                                <span class="light-grey-color text-600">
                                    No purchase orders
                                </span>
                            </div>
                        </ng-container>
                    </ng-container>
                </div>
                <ng-container *ngIf="!readOnlyMode">
                    <button class="button-add u-mt--8 u-mb--10" mat-flat-button type="button" appPreventDoubleClick
                        (throttledClick)="createOrEditPurchaseOrder()">
                        <mat-icon>add</mat-icon>
                        Add PO
                    </button>
                </ng-container> -->

                <h3 class="workflow-gray--header u-mb--10 u-mt--20">Cap on Time Reporting</h3>
                <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-230">
                        <mat-label>Shared cap on time reporting</mat-label>
                        <mat-select [disabled]="readOnlyMode" required formControlName="clientTimeReportingCapId"
                            (selectionChange)="capSelectionChange($event)"
                            [disableOptionCentering]="true">
                            <ng-container *ngFor="let item of clientTimeReportingCap; trackBy: trackById">
                                <mat-option [value]="item.id">
                                    {{ item.name }}
                                </mat-option>
                            </ng-container>
                        </mat-select>
                        <mat-error>
                            <app-validator [control]="salesClientDataForm.clientTimeReportingCapId"></app-validator>
                        </mat-error>
                    </mat-form-field>
                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                        <ng-container *ngIf="salesClientDataForm.clientTimeReportingCapId?.value !== eTimeReportingCaps.IndividualCap && salesClientDataForm.clientTimeReportingCapId?.value !== eTimeReportingCaps.NoCap">
                            <ng-container formArrayName="timeReportingCaps" class="u-w--100">
                                <ng-container *ngFor="let cap of salesClientDataForm.timeReportingCaps.controls; trackBy: trackByItem; index as i"
                                    [formArrayName]="i">
                                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding u-mr--12 form-width-110"
                                            [ngClass]="{'disabled-input': readOnlyMode}">
                                            <mat-label>Max value</mat-label>
                                            <input [disabled]="readOnlyMode"
                                                required
                                                autocomplete="off" matInput formControlName="timeReportingCapMaxValue" type="number">
                                            <mat-error>
                                                <app-validator [control]="cap.get('timeReportingCapMaxValue')"></app-validator>
                                            </mat-error>
                                        </mat-form-field>
                                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select u-mr--12 form-width-100">
                                            <mat-label>Unit</mat-label>
                                            <mat-select [disabled]="readOnlyMode" required formControlName="valueUnitId"
                                                [disableOptionCentering]="true">
                                                <ng-container *ngFor="let item of valueUnitTypes; trackBy: trackById">
                                                    <mat-option [value]="item.id">
                                                        {{ item.name }}
                                                    </mat-option>
                                                </ng-container>
                                            </mat-select>
                                            <mat-error>
                                                <app-validator [control]="cap.get('valueUnitId')"></app-validator>
                                            </mat-error>
                                        </mat-form-field>
                                        <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select form-width-150">
                                            <mat-label>Period</mat-label>
                                            <mat-select [disabled]="readOnlyMode" required formControlName="periodUnitId"
                                                [disableOptionCentering]="true">
                                                <ng-container *ngFor="let item of periodUnitTypes; trackBy: trackById">
                                                    <mat-option [value]="item.id">
                                                        {{ item.name }}
                                                    </mat-option>
                                                </ng-container>
                                            </mat-select>
                                            <mat-error>
                                                <app-validator [control]="cap.get('periodUnitId')"></app-validator>
                                            </mat-error>
                                        </mat-form-field>
                                        <ng-container *ngIf="!readOnlyMode">
                                            <button mat-icon-button type="button" appPreventDoubleClick
                                                (throttledClick)="removeTimeReportingCap(i)"
                                                class="small-icon-button u-mt--5">
                                                <mat-icon svgIcon="dialog-close-icon"></mat-icon>
                                            </button>
                                        </ng-container>
                                    </div>
                                </ng-container>
                            </ng-container>
                            <ng-container *ngIf="!readOnlyMode">
                                <button class="button-add u-mt--8 u-mb--10" mat-flat-button type="button" appPreventDoubleClick
                                    (throttledClick)="addTimeReportingCap()">
                                    <mat-icon>add</mat-icon>
                                    Add Cap value
                                </button>
                            </ng-container>
                        </ng-container>
                    </div>
                </div>
            </div>
        </div>

        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientRatesFees">
            <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                <span class="workflow-section--number">6</span>
                <h2 class="workflow-section--header">Client rates and fees</h2>
            </div>
            <div class="workflow-section--content">
                <div class="inline-edit-form u-w--100">
                    <ng-container *ngIf="salesClientDataForm.clientRates?.controls?.length">
                        <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px"
                            class="workflow-sales-inline--form__header-container u-w--100">
                            <span fxFlex="1 0 35%" class="workflow-sales-inline--form__header u-w--100">
                                Rate name
                            </span>
                            <span fxFlex="30%" class="workflow-sales-inline--form__header u-w--100">
                                Reporting unit
                            </span>
                            <span fxFlex="25%" class="workflow-sales-inline--form__header u-w--100">
                                Client rate
                            </span>
                            <span fxFlex="10%" class="workflow-sales-inline--form__header u-w--100"
                                [fxHide]="readOnlyMode">
                            </span>
                        </div>
                    </ng-container>
                    <ng-container formArrayName="clientRates" class="u-w--100">
                        <ng-container *ngFor="let rate of salesClientDataForm.clientRates.controls; trackBy: trackByItem; index as i"
                            [formArrayName]="i">
                            <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px"
                                class="workflow-sales-inline--form__row u-w--100">
                                <ng-container>
                                    <span fxFlex="1 0 35%" class="u-w--100 text-truncate-ellipsis"
                                        [matTooltip]="rate.value.rateName" matTooltipClass="white-tooltip"
                                        appShowIfTruncated>
                                        {{rate.value.rateName ?? '-'}}
                                    </span>
                                    <span fxFlex="30%" class="u-w--100 text-truncate-ellipsis"
                                        [matTooltip]="rate.value.reportingUnit?.name" matTooltipClass="white-tooltip"
                                        appShowIfTruncated>
                                        {{rate.value.reportingUnit?.name ?? '-'}}
                                    </span>

                                    <ng-container *ngIf="rate.value.editable; else clientRateCurrencyDisplay">
                                        <div fxFlex="25%" fxLayout="row" fxLayoutAlign="start start">
                                            <mat-form-field appearance="fill"
                                                class="u-w--100 formFieldNoMarginPadding filter-select u-mr--10"
                                                fxFlex="30%">
                                                <input required matInput type="number" placeholder="Rate"
                                                    formControlName="clientRate">
                                            </mat-form-field>
                                            <mat-form-field appearance="fill"
                                                class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="50%">
                                                <mat-select required formControlName="clientRateCurrency"
                                                    placeholder="Currency" [disableOptionCentering]="true"
                                                    [compareWith]="compareWithFn">
                                                    <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                        <mat-option [value]="item">
                                                            {{ item.name }}
                                                        </mat-option>
                                                    </ng-container>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>
                                    </ng-container>
                                    <ng-template #clientRateCurrencyDisplay>
                                        <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis"
                                            [matTooltip]="rate.value.clientRate + ' ' + rate.value.clientRateCurrency?.name"
                                            matTooltipClass="white-tooltip" appShowIfTruncated>
                                            {{rate.value.clientRate || rate.value.clientRateCurrency?.name ?
                                            rate.value.clientRate + ' ' + rate.value.clientRateCurrency?.name :
                                            '-'}}
                                        </span>
                                    </ng-template>
                                    <ng-container *ngIf="rate.value.editable; else clientRateActionDisplay">
                                        <div fxFlex="10%" class="u-w--100 text-truncate-ellipsis"
                                            fxLayoutAlign="end center" [fxHide]="readOnlyMode">
                                            <button mat-icon-button type="button" [disabled]="!rate.valid"
                                                appPreventDoubleClick
                                                (throttledClick)="editOrSaveSpecialRate(rate.value.editable, i)"
                                                class="rates-and-fees--inline-edit-form--btn__save">
                                                <mat-icon svgIcon="rates-save-icon"></mat-icon>
                                            </button>
                                            <button mat-icon-button type="button" appPreventDoubleClick
                                                (throttledClick)="cancelEditClientRate(i)"
                                                class="rates-and-fees--inline-edit-form--btn__cancel">
                                                <mat-icon svgIcon="rates-cancel-icon"></mat-icon>
                                            </button>
                                        </div>
                                    </ng-container>
                                    <ng-template #clientRateActionDisplay>
                                        <div fxFlex="10%" fxLayoutAlign="end center" class="u-w--100"
                                            [fxHide]="readOnlyMode">
                                            <button mat-icon-button type="button" appPreventDoubleClick
                                                (throttledClick)="$event.stopPropagation();"
                                                [matMenuTriggerFor]="clientRateMenu" class="three-dots-actions-btn">
                                                <mat-icon svgIcon="3-dots"></mat-icon>
                                            </button>
                                            <mat-menu #clientRateMenu>
                                                <button class="menu-item green-color"
                                                    mat-menu-item [disabled]="isClientRateEditing" appPreventDoubleClick
                                                    (throttledClick)="editOrSaveSpecialRate(rate.value.editable, i)">
                                                    <mat-icon svgIcon="edit-icon-green"></mat-icon>
                                                    Edit
                                                </button>
                                                <button class="menu-item menu-item--cancel" mat-menu-item
                                                    appPreventDoubleClick (throttledClick)="removeClientRate(i)">
                                                    <mat-icon svgIcon="close-icon"></mat-icon>
                                                    Delete
                                                </button>
                                            </mat-menu>
                                        </div>
                                    </ng-template>
                                </ng-container>
                            </div>
                        </ng-container>
                        <ng-container *ngIf="salesClientDataForm.clientRates.controls?.length === 0 && readOnlyMode">
                            <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px"
                                class="workflow-sales-inline--form__row u-w--100 border-unset">
                                <span class="light-grey-color text-600">
                                    No client rates
                                </span>
                            </div>
                        </ng-container>
                    </ng-container>
                </div>
                <div fxLayout="row" fxLayoutAlign="start start" class="u-mb--10" [fxHide]="readOnlyMode">
                    <button class="rates-and-fees--btn button-add" mat-flat-button type="button"
                        (menuOpened)="clientSpecialRateSelect.open();" [matMenuTriggerFor]="clientSpecialRateMenu"
                        #clientRateMenuTrigger="matMenuTrigger" [disabled]="isClientRateEditing">
                        <mat-icon>add</mat-icon>
                        Add special rates
                    </button>
                    <mat-menu #clientSpecialRateMenu backdropClass="add-rates-button--menu">
                        <div mat-menu-item appPreventDoubleClick (throttledClick)="$event.stopPropagation()"
                            class="u-pg--0">
                            <mat-form-field appearance="fill" class="add-rates-button--dropdown filter-select u-w--100">
                                <mat-label>Choose special rate</mat-label>
                                <mat-select #clientSpecialRateSelect [formControl]="clientSpecialRateFilter"
                                    [disableOptionCentering]="true">
                                    <ng-container *ngFor="let item of clientSpecialRateList | excludeIds: salesClientDataForm!.clientRates?.value : 'clientSpecialRateId'; trackBy: trackById">
                                        <mat-option [disabled]="item.id === null" [value]="item.id" appPreventDoubleClick (throttledClick)="item.id !== null ? selectClientSpecialRate($event, item, clientRateMenuTrigger) : ''">
                                            {{ item.internalName }}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </mat-menu>
                </div>
                <div class="inline-edit-form u-w--100">
                    <ng-container *ngIf="salesClientDataForm.clientFees?.controls?.length">
                        <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px"
                            class="workflow-sales-inline--form__header-container u-pt--10 u-w--100">
                            <span fxFlex="1 0 35%" class="workflow-sales-inline--form__header u-w--100">
                                Fee name
                            </span>
                            <span fxFlex="30%" class="workflow-sales-inline--form__header u-w--100">
                                Frequency
                            </span>
                            <span fxFlex="25%" class="workflow-sales-inline--form__header u-w--100">
                                Client fee
                            </span>
                            <span fxFlex="10%" class="workflow-sales-inline--form__header u-w--100"
                                [fxHide]="readOnlyMode">
                            </span>
                        </div>
                    </ng-container>
                    <ng-container formArrayName="clientFees" class="u-w--100">
                        <ng-container *ngFor="let fee of salesClientDataForm.clientFees.controls; trackBy: trackByItem; index as i"
                            [formArrayName]="i">
                            <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px"
                                class="workflow-sales-inline--form__row u-w--100">
                                <ng-container>
                                    <span fxFlex="1 0 35%" class="u-w--100 text-truncate-ellipsis"
                                        [matTooltip]="fee.value.feeName ?? '-'" matTooltipClass="white-tooltip"
                                        appShowIfTruncated>
                                        {{fee.value.feeName ?? '-'}}
                                    </span>
                                    <span fxFlex="30%" class="u-w--100 text-truncate-ellipsis"
                                        [matTooltip]="fee.value.feeFrequency?.name ?? '-'"
                                        matTooltipClass="white-tooltip" appShowIfTruncated>
                                        {{fee.value.feeFrequency?.name ?? '-'}}
                                    </span>

                                    <ng-container *ngIf="fee.value.editable; else clientFeeCurrencyDisplay">
                                        <div fxFlex="25%" fxLayout="row" fxLayoutAlign="start start">
                                            <mat-form-field appearance="fill"
                                                class="u-w--100 formFieldNoMarginPadding filter-select u-mr--10"
                                                fxFlex="30%">
                                                <input required matInput type="number" placeholder="Rate"
                                                    formControlName="clientRate">
                                            </mat-form-field>
                                            <mat-form-field appearance="fill"
                                                class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="50%">
                                                <mat-select required formControlName="clientRateCurrency"
                                                    placeholder="Currency" [disableOptionCentering]="true"
                                                    [compareWith]="compareWithFn">
                                                    <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                        <mat-option [value]="item">
                                                            {{ item.name }}
                                                        </mat-option>
                                                    </ng-container>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>
                                    </ng-container>
                                    <ng-template #clientFeeCurrencyDisplay>
                                        <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis"
                                            [matTooltip]="fee.value.clientRate + ' ' + fee.value.clientRateCurrency?.name"
                                            matTooltipClass="white-tooltip" appShowIfTruncated>
                                            {{fee.value.clientRate || fee.value.clientRateCurrency?.name ?
                                            fee.value.clientRate + ' ' + fee.value.clientRateCurrency?.name : '-'}}
                                        </span>
                                    </ng-template>

                                    <ng-container *ngIf="fee.value.editable; else clientFeeActionDisplay">
                                        <div fxFlex="10%" class="u-w--100 text-truncate-ellipsis"
                                            fxLayoutAlign="end center" [fxHide]="readOnlyMode">
                                            <button mat-icon-button type="button" [disabled]="!fee.valid"
                                                appPreventDoubleClick
                                                (throttledClick)="editOrSaveClientFee(fee.value.editable, i)"
                                                class="rates-and-fees--inline-edit-form--btn__save">
                                                <mat-icon svgIcon="rates-save-icon"></mat-icon>
                                            </button>
                                            <button mat-icon-button type="button" appPreventDoubleClick
                                                (throttledClick)="cancelEditClientFee(i)"
                                                class="rates-and-fees--inline-edit-form--btn__cancel">
                                                <mat-icon svgIcon="rates-cancel-icon"></mat-icon>
                                            </button>
                                        </div>
                                    </ng-container>
                                    <ng-template #clientFeeActionDisplay>
                                        <div fxFlex="10%" fxLayoutAlign="end center" class="u-w--100"
                                            [fxHide]="readOnlyMode">
                                            <button mat-icon-button type="button" appPreventDoubleClick
                                                (throttledClick)="$event.stopPropagation();"
                                                [matMenuTriggerFor]="clientFeeMenu" class="three-dots-actions-btn">
                                                <mat-icon svgIcon="3-dots"></mat-icon>
                                            </button>
                                            <mat-menu #clientFeeMenu>
                                                <button class="menu-item green-color" mat-menu-item
                                                    [disabled]="isClientFeeEditing" appPreventDoubleClick
                                                    (throttledClick)="editOrSaveClientFee(fee.value.editable, i)">
                                                    <mat-icon svgIcon="edit-icon-green"></mat-icon>
                                                    Edit
                                                </button>
                                                <button class="menu-item menu-item--cancel" mat-menu-item
                                                    appPreventDoubleClick (throttledClick)="removeClientFee(i)">
                                                    <mat-icon svgIcon="close-icon"></mat-icon>
                                                    Delete
                                                </button>
                                            </mat-menu>
                                        </div>
                                    </ng-template>
                                </ng-container>
                            </div>
                        </ng-container>
                        <ng-container *ngIf="salesClientDataForm.clientFees.controls?.length === 0 && readOnlyMode">
                            <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px"
                                class="workflow-sales-inline--form__row u-w--100 border-unset u-mt--15">
                                <span class="light-grey-color text-600">
                                    No client fees
                                </span>
                            </div>
                        </ng-container>
                    </ng-container>
                </div>
                <div fxLayout="row" fxLayoutAlign="start start" [fxHide]="readOnlyMode">
                    <button class="rates-and-fees--btn button-add" mat-flat-button type="button"
                        [disabled]="isClientFeeEditing" [matMenuTriggerFor]="clientSpecialFeeMenu"
                        (menuOpened)="clientSpecialFeeFilter.setValue(''); clientSpecialFeeSelect.open()"
                        #clientFeeMenuTrigger="matMenuTrigger">
                        <mat-icon>add</mat-icon>
                        Add special fees
                    </button>
                    <mat-menu #clientSpecialFeeMenu backdropClass="add-rates-button--menu">
                        <div mat-menu-item appPreventDoubleClick (throttledClick)="$event.stopPropagation()"
                            class="u-pg--0">
                            <mat-form-field appearance="fill" class="add-rates-button--dropdown filter-select u-w--100">
                                <mat-label>Choose special fee</mat-label>
                                <mat-select #clientSpecialFeeSelect [formControl]="clientSpecialFeeFilter"
                                    [disableOptionCentering]="true">
                                    <ng-container *ngFor="let item of clientSpecialFeeList | excludeIds: salesClientDataForm!.clientFees?.value : 'clientSpecialFeeId'; trackBy: trackById">
                                        <mat-option [disabled]="item.id === null" [value]="item.id" appPreventDoubleClick (throttledClick)="item.id !== null ? selectClientSpecialFee($event, item, clientFeeMenuTrigger) : ''">
                                            {{ item.internalName }}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </mat-menu>
                </div>
            </div>
        </div>
        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientEvaluation">
            <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                <span class="workflow-section--number">7</span>
                <h2 class="workflow-section--header">Client evaluation</h2>
            </div>
            <div class="workflow-section--content">
                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                    <mat-button-toggle-group [disabled]="readOnlyMode"
                        [ngClass]="{'mat-form-field-invalid': !salesClientDataForm.evaluationsDisabled?.valid}"
                        class="workflow-toggle-buttons u-mb--10" formControlName="evaluationsDisabled" required>
                        <ng-container *ngIf="(readOnlyMode && !salesClientDataForm.evaluationsDisabled?.value) || !readOnlyMode">
                            <mat-button-toggle [value]="false">
                                Enable
                            </mat-button-toggle>
                        </ng-container>
                        <ng-container *ngIf="(readOnlyMode && salesClientDataForm.evaluationsDisabled?.value) || !readOnlyMode">
                            <mat-button-toggle [value]="true">
                                Disable
                            </mat-button-toggle>
                        </ng-container>
                    </mat-button-toggle-group>
                    <mat-error>
                        <ng-container *ngIf="salesClientDataForm.evaluationsDisabled?.touched">
                            <app-validator [withoutFormField]="true" [control]="salesClientDataForm.evaluationsDisabled"></app-validator>
                        </ng-container>
                    </mat-error>
                </div>
                <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding filter-select autocompleteWithShevron form-width-300"
                        [fxHide]="salesClientDataForm.value?.evaluationsDisabled"
                        [ngClass]="{'disabled-input': readOnlyMode, 'isPanelOpen': evaluationReferencePersonAutocomplete.isOpen}">
                        <mat-label>Evaluation Reference Person</mat-label>
                        <input [disabled]="readOnlyMode" [required]="!salesClientDataForm.value?.evaluationsDisabled"
                            type="text" matInput [matAutocomplete]="evaluationReferencePersonAutocomplete"
                            name="evaluationsReferencePerson" formControlName="evaluationsReferencePersonIdValue"
                            appPreventDoubleClick (throttledClick)="$event.stopPropagation()"
                            placeholder="Final Evaluation Reference Person">
                            <span matSuffix class="shevron"></span>
                        <mat-autocomplete #evaluationReferencePersonAutocomplete="matAutocomplete"
                            [displayWith]="displayFullNameFn" (optionSelected)="focusToggleMethod('auto')"
                            (opened)="focusToggleMethod('hidden')" (closed)="focusToggleMethod('auto')">
                            <ng-container
                                *ngFor="let contact of filteredEvaluationReferencePersons; trackBy: trackById">
                                <mat-option [value]="contact" [ngClass]="{ 'no-data': contact?.id === undefined }">
                                    <span class="autocopmlete-option-name">{{ contact.firstName + ' ' + contact.lastName
                                        }}</span>
                                </mat-option>
                            </ng-container>
                        </mat-autocomplete>
                        <mat-error>
                            <app-validator
                                [control]="salesClientDataForm.evaluationsReferencePersonIdValue"></app-validator>
                        </mat-error>
                    </mat-form-field>

                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100"
                        [fxHide]="!salesClientDataForm.value?.evaluationsDisabled">
                        <mat-form-field appearance="outline"
                            class="formFieldNoMarginPadding textarea-input form-width-564"
                            [ngClass]="{'disabled-input': readOnlyMode}">
                            <mat-label>Disable Evaluations Reason</mat-label>
                            <textarea [disabled]="readOnlyMode"
                                [required]="salesClientDataForm.value?.evaluationsDisabled" matInput
                                autocomplete="new-password" name="evaluationsDisabledReason"
                                formControlName="evaluationsDisabledReason" [cdkTextareaAutosize]="true"
                                [cdkAutosizeMinRows]="2">
                            </textarea>
                            <mat-error>
                                <app-validator
                                    [control]="salesClientDataForm.evaluationsDisabledReason"></app-validator>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
            </div>
        </div>
        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100" id="salesClientContract">
            <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                <span class="workflow-section--number">8</span>
                <h2 class="workflow-section--header">Client contract</h2>
            </div>
            <div class="workflow-section--content">
                <div fxLayout="row" fxLayoutAlign="start start" fxLayoutGap="10px" class="u-w--100 u-mb--20">
                    <mat-form-field appearance="outline" class="formFieldNoMarginPadding textarea-input form-width-564"
                        [ngClass]="{'disabled-input': readOnlyMode}">
                        <mat-label>Special Contract Terms</mat-label>
                        <textarea [disabled]="readOnlyMode" required matInput autocomplete="new-password"
                            name="specialContractTerms" formControlName="specialContractTerms"
                            [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                        </textarea>
                        <mat-error>
                            <app-validator [control]="salesClientDataForm.specialContractTerms"></app-validator>
                        </mat-error>
                    </mat-form-field>
                    <ng-container *ngIf="!readOnlyMode || salesClientDataForm.noSpecialContractTerms?.value">
                        <mat-checkbox [disabled]="readOnlyMode" color="accent" formControlName="noSpecialContractTerms"
                            name="noSpecialContractTerms" class="black-checkbox u-mt--5"
                            (change)="disableOrEnableInput(salesClientDataForm.noSpecialContractTerms?.value, salesClientDataForm.specialContractTerms)">
                            None
                        </mat-checkbox>
                    </ng-container>
                </div>
                <h3 class="workflow-gray--header u-mb--10">Contract Signers</h3>
                <div formArrayName="contractSigners" class="u-w--100">
                    <ng-container *ngFor="let signer of contractSigners.controls; trackBy: trackByItem; let i = index" [formGroupName]="i">
                        <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                            <mat-form-field appearance="outline"
                                class="u-w--100 formFieldNoMarginPadding filter-select autocompleteWithShevron u-mr--16" fxFlex="33%"
                                [ngClass]="{'disabled-input': readOnlyMode, 'isPanelOpen': contactSignerAutocomplete.isOpen}">
                                <mat-label>Name</mat-label>
                                <input [disabled]="readOnlyMode" required type="text" matInput
                                    [matAutocomplete]="contactSignerAutocomplete" formControlName="clientContact"
                                    appPreventDoubleClick (throttledClick)="$event.stopPropagation()"
                                    placeholder="Name">
                                    <span matSuffix class="shevron"></span>
                                <mat-autocomplete #contactSignerAutocomplete="matAutocomplete"
                                    [displayWith]="displayFullNameFn" (optionSelected)="focusToggleMethod('auto')"
                                    (opened)="focusToggleMethod('hidden')" (closed)="focusToggleMethod('auto')">
                                    <ng-container *ngFor="let contact of filteredContractSigners; trackBy: trackById">
                                        <mat-option [value]="contact"
                                            [ngClass]="{ 'no-data': contact?.id === undefined }">
                                            <span class="autocopmlete-option-name">{{ contact.firstName + ' ' +
                                                contact.lastName }}</span>
                                        </mat-option>
                                    </ng-container>
                                </mat-autocomplete>
                                <mat-error>
                                    <app-validator
                                        [control]="contractSigners.at(i).get('clientContact')"></app-validator>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline"
                                class="u-w--100 formFieldNoMarginPadding filter-select u-mr--16" fxFlex="33%">
                                <mat-label>Client Role</mat-label>
                                <mat-select [disabled]="readOnlyMode" required formControlName="signerRoleId"
                                    [disableOptionCentering]="true">
                                    <ng-container *ngFor="let item of signerRoles; trackBy: trackById">
                                        <mat-option [value]="item.id">
                                            {{ item.name }}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>
                                <mat-error>
                                    <app-validator [control]="contractSigners.at(i).get('signerRoleId')"></app-validator>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline"
                                class="u-w--100 formFieldNoMarginPadding filter-select u-mr--16" fxFlex="20%">
                                <mat-label>Sequence</mat-label>
                                <mat-select [disabled]="readOnlyMode" required formControlName="clientSequence"
                                    [disableOptionCentering]="true">
                                    <ng-container *ngFor="let item of [1,2,3,4,5,6,7]">
                                        <mat-option [value]="item">
                                            {{ item }}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>
                                <mat-error>
                                    <app-validator
                                        [control]="contractSigners.at(i).get('clientSequence')"></app-validator>
                                </mat-error>
                            </mat-form-field>
                            <ng-container *ngIf="!readOnlyMode">
                                <button class="form-icon--delete-row" type="button" mat-icon-button
                                    appPreventDoubleClick (throttledClick)="removeSigner(i)"><mat-icon
                                        svgIcon="remove-icon"></mat-icon></button>
                            </ng-container>
                        </div>
                    </ng-container>
                    <ng-container *ngIf="contractSigners.controls?.length === 0 && readOnlyMode">
                        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px"
                            class="workflow-sales-inline--form__row u-w--100 border-unset">
                            <span class="light-grey-color text-600">
                                No contract signers
                            </span>
                        </div>
                    </ng-container>
                    <ng-container *ngIf="!readOnlyMode">
                        <button class="button-add" mat-flat-button type="button" appPreventDoubleClick
                            (throttledClick)="addSignerToForm()">
                            <mat-icon>add</mat-icon>
                            Add Signer
                        </button>
                    </ng-container>
                </div>
            </div>
        </div>
    </div>
    <button #submitFormBtn class="display-none" type="submit">Hidden button to set form submitted</button>
</form>

<ng-template #clientAdditionalInfo let-client="client">
    <div fxLayout="row wrap" fxLayoutAlign="end center" class="u-w--100">
        <ng-container *ngIf="client?.clientId">
            <button class="link-to-client-icon green-color u-mr--8" mat-flat-button (click)="openClientInNewTab(client?.clientId)"
                [matTooltip]="'Link to Client profile'" matTooltipClass="white-tooltip">
                <mat-icon svgIcon="link-to-client-icon"></mat-icon>
                Client profile
            </button>
        </ng-container>

        <ng-container *ngIf="client?.clientId">
            <button class="link-to-client-icon orange-color" mat-flat-button (click)="openInHubspot(client)"
                [disabled]="client.crmClientId === null || client.crmClientId === undefined"
                [matTooltip]="'Link to Hubspot'" matTooltipClass="white-tooltip">
                <mat-icon svgIcon="link-to-client-hubspot-icon"></mat-icon>
                Hubspot
            </button>
        </ng-container>
    </div>
</ng-template>

<ng-template #clientPrefix let-client="client">
    <ng-container *ngIf="client?.clientId !== undefined && client?.clientAddresses?.length">
        <span
            class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
            #{{client?.clientId}} | {{client?.clientAddresses[0]?.city ?? ''}} {{client?.clientAddresses[0]?.countryName ?
            ', ' + client?.clientAddresses[0]?.countryName : ''}}
        </span>
    </ng-container>
</ng-template>
