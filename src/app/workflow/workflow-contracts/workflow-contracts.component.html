<div class="workflow-contracts">
    <ng-container *ngIf="canToggleEditMode">
        <button class="absolute-edit-toggle" mat-icon-button appPreventDoubleClick (throttledClick)="toggleEditMode(true)"><mat-icon svgIcon="edit-icon"></mat-icon></button>
    </ng-container>
    <ng-container [ngSwitch]="true">
        <ng-container
            *ngSwitchCase="activeSideSection.typeId === workflowSideSections.TerminateWorkflow || activeSideSection.typeId === workflowSideSections.TerminateConsultant">
            <div class="workflow--termination">
                <h2 class="workflow-section--header u-mb--20">Finish contract in PM</h2>
                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                    <ng-container *ngIf="readOnlyMode; else contractLinesDoneManuallyInOldPMInput">
                        <h2 class="workflow-section--header u-mt--20">Sync</h2>
                        <span class="workflow-darkblue--text">
                            <ng-container *ngTemplateOutlet="syncStatus"></ng-container>
                        </span>
                        <ng-container *ngIf="statusAfterSync">
                            <div fxLayout="row" fxLayoutAlign="start center" class="u-mb--10" [ngClass]="{'mat-form-field-invalid': validationTriggered && syncNotPossible}">
                                <mat-icon class="u-mr--5" [ngClass]="{'icon-cancel': syncNotPossible}" [svgIcon]="syncNotPossible ? 'cancel-fill' : 'completed-icon'"></mat-icon>
                                <span class="workflow-darkblue--text">
                                    {{syncMessage}}
                                </span>
                            </div>
                        </ng-container>
                    </ng-container>
                    <ng-template #contractLinesDoneManuallyInOldPMInput>
                        <button class="button-accept u-mb--10" mat-flat-button appPreventDoubleClick
                            (throttledClick)="processSyncToLegacySystem()">
                            Sync to legacy system
                        </button>
                    </ng-template>
                    <ng-container *ngIf="statusAfterSync">
                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mb--10">
                            <mat-icon class="u-mr--5" [ngClass]="{'icon-cancel': syncNotPossible}" [svgIcon]="syncNotPossible ? 'cancel-fill' : 'completed-icon'"></mat-icon>
                            <span class="sync-hint-text">
                                {{syncMessage}}
                            </span>
                        </div>
                    </ng-container>
                </div>

                <ng-container *ngIf="contractsSyncDataForm.showManualOption?.value">
                    <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--20">
                        <ng-container *ngIf="readOnlyMode; else contractLinesDoneManuallyInOldPMInput">
                            <ng-container *ngIf="!contractsSyncDataForm.contractLinesDoneManuallyInOldPm?.value">
                                <mat-icon class="termination-cancel-icon u-mr--5" [svgIcon]="'cancel-fill'"
                                    [ngClass]="{'icon-cancel': !contractsSyncDataForm.contractLinesDoneManuallyInOldPm?.value}"></mat-icon>
                            </ng-container>
                            <ng-container *ngIf="contractsSyncDataForm.contractLinesDoneManuallyInOldPm?.value">
                                <mat-icon class="termination-complete-icon u-mr--5" [svgIcon]="'completed-icon'" height="22px" width="22px"></mat-icon>
                            </ng-container>
                            <span class="workflow-step-readonly--blue-text">
                                Contract lines done manually in old PM
                            </span>
                        </ng-container>
                        <ng-template #contractLinesDoneManuallyInOldPMInput>
                            <form [formGroup]="contractsSyncDataForm">
                                <mat-checkbox color="accent" name="contractLinesDoneManuallyInOldPM" formControlName="contractLinesDoneManuallyInOldPm" class="black-checkbox u-mt--10">
                                    Contract lines done manually in old PM
                                </mat-checkbox>
                            </form>
                        </ng-template>
                    </div>
                </ng-container>
                <form fxLayout="column" fxLayoutAlign="start start" [formGroup]="contractsTerminationConsultantForm" class="workflow-form u-w--100" id="consultantData">
                    <ng-container formArrayName="consultantTerminationContractData">
                        <ng-container *ngFor="let consultant of contractsTerminationConsultantForm.consultantTerminationContractData.controls; index as i; last as last" [formGroupName]="i">
                            <div class="workflow-contracts--block-consultants u-mt--20" [ngClass]="{'last-block': last}" [id]="'consultantDataAnchor' + i">
                                <app-consultant-information [consultantData]="consultant?.value?.consultantData"></app-consultant-information>
                                <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                    <ng-container *ngIf="!readOnlyMode || consultant.get('removedConsultantFromAnyManualChecklists')?.value">
                                        <mat-checkbox [disabled]="readOnlyMode" color="accent" name="removedConsultantFromAnyManualChecklists" formControlName="removedConsultantFromAnyManualChecklists" class="black-checkbox u-mr--10">
                                            Removed Consultant from any manual checklists
                                        </mat-checkbox>
                                    </ng-container>
                                </div>

                                <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                    <ng-container *ngIf="!readOnlyMode || consultant.get('deletedAnySensitiveDocumentsForGDPR')?.value">
                                        <mat-checkbox [disabled]="readOnlyMode" color="accent" name="deletedAnySensitiveDocumentsForGDPR" formControlName="deletedAnySensitiveDocumentsForGDPR" class="black-checkbox u-mr--10">
                                            Deleted any sensitive documents (GDPR)
                                        </mat-checkbox>
                                    </ng-container>
                                </div>
                            </div>
                        </ng-container>
                    </ng-container>
                </form>
            </div>
        </ng-container>
        <ng-container *ngSwitchDefault>
            <form [formGroup]="contractsMainForm" id="mainDataAnchor"
                class="workflow-form workflow-form--main u-w--100">
                <div fxLayout="column" fxLayoutAlign="start start" class="workflow-contracts--process-data u-w--100">
                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                        <h1 class="workflow-section--header-main">Main data</h1>
                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                            <span class="workflow-section--number">1</span>
                            <h2 class="workflow-section--header">Project</h2>
                        </div>
                        <div class="workflow-section--content">
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--10 u-mt--10">
                                <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--12" fxFlex="35%">
                                    <mat-label>Project Type (Legacy)</mat-label>
                                    <mat-select [disabled]="true" formControlName="projectType" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                        <ng-container *ngFor="let item of projectTypes; trackBy: trackById">
                                            <mat-option [value]="item">
                                                {{ item.name }}
                                            </mat-option>
                                        </ng-container>
                                    </mat-select>
                                    <mat-error>
                                        <app-validator [control]="contractsMainForm.projectType"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                                <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--12" fxFlex="22%">
                                    <mat-label>Sales Type</mat-label>
                                    <mat-select [disabled]="true" formControlName="salesType" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                        <ng-container *ngFor="let item of saleTypes; trackBy: trackById">
                                            <mat-option [value]="item">
                                                {{ item.name }}
                                            </mat-option>
                                        </ng-container>
                                    </mat-select>
                                    <mat-error>
                                        <app-validator [control]="contractsMainForm.salesType"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                                <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="22%">
                                    <mat-label>Delivery Type</mat-label>
                                    <mat-select [disabled]="true" formControlName="deliveryType" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                        <ng-container *ngFor="let item of deliveryTypes; trackBy: trackById">
                                            <ng-container *ngIf="(item.id === deliveryTypesEnum.ManagedService && contractsMainForm.salesType?.value?.id === salesTypesEnum.ManagedService) || (item.id !== deliveryTypesEnum.ManagedService && contractsMainForm.salesType?.value?.id !== salesTypesEnum.ManagedService)">
                                                <mat-option [value]="item">
                                                    {{ item.name }}
                                                </mat-option>
                                            </ng-container>
                                        </ng-container>
                                    </mat-select>
                                    <mat-error>
                                        <app-validator [control]="contractsMainForm.deliveryType"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--10">
                                <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--12" fxFlex="35%">
                                    <mat-label>Project Category</mat-label>
                                    <mat-select [disabled]="true" formControlName="projectCategory" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                        <ng-container *ngFor="let item of projectCategories; trackBy: trackById">
                                            <mat-option [value]="item">
                                                {{ item.name }}
                                            </mat-option>
                                        </ng-container>
                                    </mat-select>
                                    <mat-error>
                                        <app-validator [control]="contractsMainForm.projectCategory"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                                <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="22%">
                                    <mat-label>Margin</mat-label>
                                    <mat-select [disabled]="true" formControlName="margin" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                        <mat-option class="mat-select-clear-option">
                                            Clear
                                        </mat-option>
                                        <ng-container *ngFor="let item of margins; trackBy: trackById">
                                            <mat-option [value]="item">
                                                {{ item.name }}
                                            </mat-option>
                                        </ng-container>
                                    </mat-select>
                                    <mat-error>
                                        <app-validator [control]="contractsMainForm.margin"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--20">
                                <mat-form-field appearance="outline" class="u-w--100 textarea-input formFieldNoMarginPadding" fxFlex="0 0 calc(79% + 24px)" [ngClass]="{'disabled-input': readOnlyMode}">
                                    <mat-label>Project Name</mat-label>
                                    <textarea [disabled]="readOnlyMode" matInput autocomplete="new-password" name="projectName" formControlName="projectName" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                                    </textarea>
                                    <mat-error>
                                        <app-validator [control]="contractsMainForm.projectName"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--20">
                                <mat-form-field appearance="outline" class="u-w--100 textarea-input formFieldNoMarginPadding" fxFlex="0 0 calc(79% + 24px)" [ngClass]="{'disabled-input': readOnlyMode}">
                                    <mat-label>Project Description</mat-label>
                                    <textarea [disabled]="readOnlyMode" matInput autocomplete="new-password" name="projectDescription" formControlName="projectDescription" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                                    </textarea>
                                    <mat-error>
                                        <app-validator [control]="contractsMainForm.projectDescription"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                            <span class="workflow-section--number">2</span>
                            <h2 class="workflow-section--header">Additional data</h2>
                        </div>
                        <div class="workflow-section--content">
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="22%">
                                    <mat-label>Discounts</mat-label>
                                    <mat-select [disabled]="true" formControlName="discounts" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                        <mat-option class="mat-select-clear-option">
                                            Clear
                                        </mat-option>
                                        <ng-container *ngFor="let item of discounts; trackBy: trackById">
                                            <mat-option [value]="item">
                                                {{ item.name }}
                                            </mat-option>
                                        </ng-container>
                                    </mat-select>
                                    <mat-error>
                                        <app-validator [control]="contractsMainForm.discounts"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                <mat-form-field appearance="outline" class="u-w--100 textarea-input formFieldNoMarginPadding disabled-input u-mr--12" fxFlex="0 0 calc(79% + 24px)">
                                    <mat-label>Remarks</mat-label>
                                    <textarea [disabled]="true" matInput autocomplete="new-password" name="remarks" formControlName="remarks" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                                    </textarea>
                                    <mat-error>
                                        <app-validator [control]="contractsMainForm.remarks"></app-validator>
                                    </mat-error>
                                </mat-form-field>
                                <ng-container *ngIf="contractsMainForm.noRemarks?.value">
                                    <mat-checkbox [disabled]="true" color="accent" formControlName="noRemarks" name="noRemarks" class="black-checkbox u-mt--8" (change)="disableOrEnableInput(contractsMainForm.noRemarks?.value, contractsMainForm.remarks)">
                                        None
                                    </mat-checkbox>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <!-- hidden on AddConsultant, ChangeConsultant, Extend Consultant -->
            <ng-container *ngIf="activeSideSection.typeId === workflowSideSections.StartClientPeriod || activeSideSection.typeId === workflowSideSections.ExtendClientPeriod || activeSideSection.typeId === workflowSideSections.ChangeClientPeriod">
                <form fxLayout="column" fxLayoutAlign="start start" id="clientDataAnchor" [formGroup]="contractClientForm" class="workflow-form workflow-form--sales u-w--100">
                    <div fxLayout="column" fxLayoutAlign="start start" class="workflow-contracts--process-data u-w--100">
                        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                            <h1 class="workflow-section--header-main">Client data</h1>
                            <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                <span class="workflow-section--number">1</span>
                                <h2 class="workflow-section--header">Invoicing</h2>
                            </div>
                            <div class="workflow-section--content">
                                <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                    <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="0 0 calc(44% + 12px)">
                                        <mat-label>Shared cap on time reporting</mat-label>
                                        <mat-select [disabled]="true" formControlName="clientTimeReportingCapId" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                            <ng-container *ngFor="let item of clientTimeReportingCap; trackBy: trackById">
                                                <mat-option [value]="item">
                                                    {{ item.name }}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error>
                                            <app-validator [control]="contractClientForm.clientTimeReportingCapId"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                                <ng-container *ngIf="contractClientForm.clientTimeReportingCapId?.value?.id !== clientTimeReportingCaps.IndividualCap && contractClientForm.clientTimeReportingCapId?.value?.id !== clientTimeReportingCaps.NoCap">
                                    <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                        <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding u-mr--12" fxFlex="22%" [ngClass]="{'disabled-input': readOnlyMode}">
                                            <mat-label>Max value</mat-label>
                                            <input [disabled]="readOnlyMode"  autocomplete="off" matInput formControlName="clientTimeReportingCapMaxValue" type="number">
                                            <mat-error>
                                                <app-validator [control]="contractClientForm.clientTimeReportingCapMaxValue"></app-validator>
                                            </mat-error>
                                        </mat-form-field>
                                        <ng-container *ngIf="contractClientForm.clientTimeReportingCapId?.value?.id !== clientTimeReportingCaps.NoCap">
                                            <span class="workflow-darkblue--text">
                                                <ng-container [ngSwitch]="contractClientForm.clientTimeReportingCapId?.value?.id">
                                                    <ng-container *ngSwitchCase="1"> <!-- Cap on units -->
                                                        <ng-container [ngSwitch]="contractClientForm.rateUnitType?.value?.id">
                                                            <ng-container *ngSwitchCase="1">  <!-- Per hour -->
                                                                hours
                                                            </ng-container>
                                                            <ng-container *ngSwitchCase="2">  <!-- Per day -->
                                                                days
                                                            </ng-container>
                                                            <ng-container *ngSwitchCase="4">  <!-- Per month -->
                                                                months
                                                            </ng-container>
                                                        </ng-container>
                                                    </ng-container>
                                                    <ng-container *ngSwitchCase="2">  <!-- Cap on value -->
                                                        {{contractClientForm.currency?.value?.name ? contractClientForm.currency?.value?.name : '-'}}
                                                    </ng-container>
                                                </ng-container>
                                            </span>
                                        </ng-container>
                                    </div>
                                </ng-container>
                            </div>
                        </div>
                        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                            <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                <span class="workflow-section--number">2</span>
                                <h2 class="workflow-section--header">Client contract</h2>
                            </div>
                            <div class="workflow-section--content">
                                <h3 class="workflow-gray--header">Special Contract Terms</h3>
                                <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                    <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding textarea-input u-mr--12" fxFlex="0 0 calc(79% + 24px)" [ngClass]="{'disabled-input': readOnlyMode}">
                                        <mat-label>Special Contract Terms</mat-label>
                                        <textarea [disabled]="readOnlyMode" required matInput autocomplete="new-password" name="specialContractTerms" formControlName="specialContractTerms" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                                        </textarea>
                                        <mat-error>
                                            <app-validator [control]="contractClientForm.specialContractTerms"></app-validator>
                                        </mat-error>
                                    </mat-form-field>
                                    <ng-container *ngIf="!readOnlyMode || contractClientForm.noSpecialContractTerms?.value">
                                        <mat-checkbox [disabled]="readOnlyMode" color="accent" formControlName="noSpecialContractTerms" name="noSpecialContractTerms" class="black-checkbox u-mt--8" (change)="disableOrEnableInput(contractClientForm.noSpecialContractTerms?.value, contractClientForm.specialContractTerms)">
                                            None
                                        </mat-checkbox>
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                            <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                <span class="workflow-section--number">3</span>
                                <h2 class="workflow-section--header">Client rates and fees</h2>
                            </div>
                            <div class="workflow-section--content">
                                <div class="inline-edit-form u-w--100" [ngClass]="{'u-mb--20': contractClientForm.clientRates.controls.length}">
                                    <ng-container *ngIf="contractClientForm.clientRates?.controls?.length">
                                        <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px" class="u-w--100 u-pl--16 u-pr--16 u-pb--10">
                                            <span fxFlex="35%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                Rate name
                                            </span>
                                            <span fxFlex="30%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                Reporting unit
                                            </span>
                                            <span fxFlex="25%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                Client rate
                                            </span>
                                            <ng-container *ngIf="!readOnlyMode">
                                                <span fxFlex="10%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                </span>
                                            </ng-container>
                                        </div>
                                    </ng-container>
                                    <ng-container formArrayName="clientRates" class="u-w--100">
                                        <ng-container *ngFor="let rate of contractClientForm.clientRates.controls; index as i" [formArrayName]="i">
                                            <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px" class="workflow-contracts--list u-w--100 u-pl--16 u-pr--16">
                                                <span fxFlex="35%" class="workflow-contracts--list-item u-w--100 text-truncate-ellipsis" [matTooltip]="contractClientForm.clientRates.at(i).get('rateName')?.value" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                    {{rate.value.rateName}}
                                                </span>
                                                <span fxFlex="30%" class="workflow-contracts--list-item u-w--100 text-truncate-ellipsis" [matTooltip]="contractClientForm.clientRates.at(i).get('reportingUnit')?.value?.name" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                    {{rate.value.reportingUnit?.name}}
                                                </span>
                                                <ng-container *ngIf="rate.value.editable; else clientRatesDisplay">
                                                    <div fxFlex="25%" fxLayout="row" fxLayoutAlign="start start">
                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--10" fxFlex="30%">
                                                            <input required matInput type="number" placeholder="Rate" formControlName="clientRateValue">
                                                        </mat-form-field>
                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="50%">
                                                            <mat-select required formControlName="clientRateCurrency" placeholder="Currency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                    <mat-option [value]="item">
                                                                        {{ item.name }}
                                                                    </mat-option>
                                                                </ng-container>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>
                                                </ng-container>
                                                <ng-template #clientRatesDisplay>
                                                    <span fxFlex="25%" class="workflow-contracts--list-item u-w--100 text-truncate-ellipsis" [matTooltip]="rate.value.clientRateValue !== null && rate.value.clientRateCurrency?.name ? rate.value.clientRateValue + ' ' + rate.value.clientRateCurrency?.name : '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                        {{rate.value.clientRateValue !== null && rate.value.clientRateCurrency?.name ? rate.value.clientRateValue + ' ' + rate.value.clientRateCurrency?.name : '-'}}
                                                    </span>
                                                </ng-template>
                                                <ng-container *ngIf="rate.value.editable && !readOnlyMode; else clientRatesActions">
                                                    <div fxFlex="10%" class="u-w--100 text-truncate-ellipsis" fxLayoutAlign="end center">
                                                        <button mat-icon-button type="button" [disabled]="!rate.valid" appPreventDoubleClick (throttledClick)="editOrSaveSpecialRate(rate.value.editable, i)" class="rates-and-fees--inline-edit-form--btn__save">
                                                            <mat-icon svgIcon="rates-save-icon"></mat-icon>
                                                        </button>
                                                        <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="cancelEditClientRate(i)" class="rates-and-fees--inline-edit-form--btn__cancel">
                                                            <mat-icon svgIcon="rates-cancel-icon"></mat-icon>
                                                        </button>
                                                    </div>
                                                </ng-container>
                                                <ng-template #clientRatesActions>
                                                    <ng-container *ngIf="!readOnlyMode">
                                                        <div fxFlex="10%" fxLayoutAlign="end center" class="u-w--100">
                                                            <button mat-icon-button appPreventDoubleClick (throttledClick)="$event.stopPropagation();" [matMenuTriggerFor]="clientRateMenu" class="three-dots-actions-btn">
                                                                <mat-icon svgIcon="3-dots"></mat-icon>
                                                            </button>
                                                            <mat-menu #clientRateMenu>
                                                                <button
                                                                    class="menu-item green-color"
                                                                    mat-menu-item
                                                                    [disabled]="isConsultantRateEditing"
                                                                    appPreventDoubleClick (throttledClick)="editOrSaveSpecialRate(rate.value.editable, i)">
                                                                    <mat-icon svgIcon="edit-icon-green"></mat-icon>
                                                                    Edit
                                                                </button>
                                                                <button
                                                                    class="menu-item menu-item--cancel"
                                                                    mat-menu-item
                                                                    appPreventDoubleClick (throttledClick)="removeClientRate(i)">
                                                                    <mat-icon svgIcon="close-icon"></mat-icon>
                                                                    Delete
                                                                </button>
                                                            </mat-menu>
                                                        </div>
                                                    </ng-container>
                                                </ng-template>
                                            </div>
                                        </ng-container>
                                    </ng-container>
                                </div>
                                <ng-container *ngIf="!readOnlyMode">
                                    <div fxLayout="row" fxLayoutAlign="start start" class="u-mb--10">
                                        <button
                                            [ngClass]="contractClientForm!.clientRates!.controls!.length > 0 ? 'button-add' : 'button-outlined'"
                                            class="rates-and-fees--btn"
                                            mat-flat-button
                                            [matMenuTriggerFor]="clientSpecialRateMenu"
                                            [disabled]="isConsultantRateEditing"
                                            #clientRateMenuTrigger="matMenuTrigger"
                                            (menuOpened)="clientSpecialRateFilter!.setValue(''); clientSpecialRateSelect.open();">
                                            <ng-container *ngIf="contractClientForm.clientRates?.controls?.length">
                                                <mat-icon>add</mat-icon>
                                            </ng-container>
                                            Add special rates
                                        </button>
                                        <mat-menu #clientSpecialRateMenu backdropClass="add-rates-button--menu">
                                            <div mat-menu-item appPreventDoubleClick (throttledClick)="$event.stopPropagation()" class="u-pg--0">
                                                <mat-form-field appearance="fill" class="add-rates-button--dropdown filter-select u-w--100">
                                                    <mat-label>Choose special rate</mat-label>
                                                    <mat-select #clientSpecialRateSelect [formControl]="clientSpecialRateFilter" [disableOptionCentering]="true">
                                                        <ng-container *ngIf="clientSpecialRateList?.length == 0">
                                                            <mat-option (click)="$event.stopPropagation();">
                                                                No results
                                                            </mat-option>
                                                        </ng-container>
                                                        <ng-container *ngFor="let item of clientSpecialRateList | excludeIds: contractClientForm!.clientRates?.value : 'clientSpecialRateId'; trackBy: trackById">
                                                            <mat-option [value]="item.id" appPreventDoubleClick (throttledClick)="selectClientRate($event, item, clientRateMenuTrigger)">
                                                                {{ item.internalName }}
                                                            </mat-option>
                                                        </ng-container>
                                                    </mat-select>
                                                </mat-form-field>
                                            </div>
                                        </mat-menu>
                                    </div>
                                </ng-container>

                                <div class="inline-edit-form u-w--100" [ngClass]="{'u-mb--20': contractClientForm.clientFees.controls.length}">
                                    <ng-container *ngIf="contractClientForm.clientFees?.controls?.length">
                                        <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px" class="u-w--100 u-pl--16 u-pr--16 u-pb--10">
                                            <span fxFlex="35%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                Fee name
                                            </span>
                                            <span fxFlex="30%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                Frequency
                                            </span>
                                            <span fxFlex="25%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                Client fee
                                            </span>
                                            <ng-container *ngIf="!readOnlyMode">
                                                <span fxFlex="10%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                </span>
                                            </ng-container>
                                        </div>
                                    </ng-container>
                                    <ng-container formArrayName="clientFees" class="u-w--100">
                                        <ng-container *ngFor="let fee of contractClientForm.clientFees.controls; index as i" [formArrayName]="i">
                                            <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px" class="workflow-contracts--list u-w--100 u-pl--16 u-pr--16">
                                                <span fxFlex="35%" class="workflow-contracts--list-item u-w--100 text-truncate-ellipsis" [matTooltip]="contractClientForm.clientFees.at(i).get('feeName')?.value ?? '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                    {{fee.value.feeName ?? '-'}}
                                                </span>
                                                <span fxFlex="30%" class="workflow-contracts--list-item u-w--100 text-truncate-ellipsis" [matTooltip]="contractClientForm.clientFees.at(i).get('feeFrequency')?.value?.name ?? '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                    {{fee.value.feeFrequency?.name ?? '-'}}
                                                </span>
                                                <ng-container *ngIf="fee.value.editable; else clientFeeRateDisplay">
                                                    <div fxFlex="25%" fxLayout="row" fxLayoutAlign="start start">
                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--10" fxFlex="30%">
                                                            <input required matInput type="number" placeholder="Rate" formControlName="clientRateValue">
                                                        </mat-form-field>
                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="50%">
                                                            <mat-select required formControlName="clientRateCurrency" placeholder="Currency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                    <mat-option [value]="item">
                                                                        {{ item.name }}
                                                                    </mat-option>
                                                                </ng-container>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>
                                                </ng-container>
                                                <ng-template #clientFeeRateDisplay>
                                                    <span fxFlex="25%" class="workflow-contracts--list-item u-w--100 text-truncate-ellipsis" [matTooltip]="fee.value.clientRateValue !== null && fee.value.clientRateCurrency?.name ? fee.value.clientRateValue + ' ' + fee.value.clientRateCurrency?.name : '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                        {{fee.value.clientRateValue !== null && fee.value.clientRateCurrency?.name ? fee.value.clientRateValue + ' ' + fee.value.clientRateCurrency?.name : '-'}}
                                                    </span>
                                                </ng-template>

                                                <ng-container *ngIf="fee.value.editable && !readOnlyMode; else clientFeeActions">
                                                    <div fxFlex="10%" class="u-w--100 text-truncate-ellipsis" fxLayoutAlign="end center">
                                                        <button mat-icon-button type="button" [disabled]="!fee.valid" appPreventDoubleClick (throttledClick)="editOrSaveClientFee(fee.value.editable, i)" class="rates-and-fees--inline-edit-form--btn__save">
                                                            <mat-icon svgIcon="rates-save-icon"></mat-icon>
                                                        </button>
                                                        <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="cancelEditClientFee(i)" class="rates-and-fees--inline-edit-form--btn__cancel">
                                                            <mat-icon svgIcon="rates-cancel-icon"></mat-icon>
                                                        </button>
                                                    </div>
                                                </ng-container>
                                                <ng-template #clientFeeActions>
                                                    <ng-container *ngIf="!readOnlyMode">
                                                        <div fxFlex="10%" fxLayoutAlign="end center" class="u-w--100">
                                                            <ng-container *ngIf="fee.value.editable">
                                                                <button mat-icon-button
                                                                        [disabled]="false"
                                                                        appPreventDoubleClick (throttledClick)="editOrSaveClientFee(fee.value.editable, i)">
                                                                        <mat-icon>save</mat-icon>
                                                                </button>
                                                            </ng-container>
                                                            <button mat-icon-button appPreventDoubleClick (throttledClick)="$event.stopPropagation();" [matMenuTriggerFor]="clientFeeMenu" class="three-dots-actions-btn">
                                                                <mat-icon svgIcon="3-dots"></mat-icon>
                                                            </button>
                                                            <mat-menu #clientFeeMenu>
                                                                <ng-container *ngIf="!fee.value.editable">
                                                                    <button
                                                                        class="menu-item green-color"
                                                                        mat-menu-item
                                                                        [disabled]="isClientFeeEditing"
                                                                        appPreventDoubleClick (throttledClick)="editOrSaveClientFee(fee.value.editable, i)">
                                                                        <mat-icon svgIcon="edit-icon-green"></mat-icon>
                                                                        Edit
                                                                    </button>
                                                                </ng-container>
                                                                <button
                                                                    class="menu-item menu-item--cancel"
                                                                    mat-menu-item
                                                                    appPreventDoubleClick (throttledClick)="removeClientFee(i)">
                                                                    <mat-icon svgIcon="close-icon"></mat-icon>
                                                                    Delete
                                                                </button>
                                                            </mat-menu>
                                                        </div>
                                                    </ng-container>
                                                </ng-template>
                                            </div>
                                        </ng-container>
                                    </ng-container>
                                </div>
                                <ng-container *ngIf="!readOnlyMode">
                                    <div fxLayout="row" fxLayoutAlign="start start">
                                        <button
                                            [ngClass]="contractClientForm!.clientFees!.controls!.length > 0 ? 'button-add' : 'button-outlined'"
                                            class="rates-and-fees--btn"
                                            mat-flat-button
                                            [matMenuTriggerFor]="clientSpecialFeeMenu"
                                            [disabled]="isConsultantFeeEditing"
                                            #clientFeeMenuTrigger="matMenuTrigger"
                                            (menuOpened)="clientSpecialFeeFilter!.setValue(''); clientSpecialFeeSelect.open();">
                                            <ng-container *ngIf="contractClientForm.clientFees?.controls?.length">
                                                <mat-icon>add</mat-icon>
                                            </ng-container>
                                            Add special fees
                                        </button>
                                        <mat-menu #clientSpecialFeeMenu backdropClass="add-rates-button--menu">
                                            <div mat-menu-item appPreventDoubleClick (throttledClick)="$event.stopPropagation()" class="u-pg--0">
                                                <mat-form-field appearance="fill" class="add-rates-button--dropdown filter-select u-w--100">
                                                    <mat-label>Choose special fee</mat-label>
                                                    <mat-select #clientSpecialFeeSelect [formControl]="clientSpecialFeeFilter" [disableOptionCentering]="true">
                                                        <ng-container *ngIf="clientSpecialFeeList?.length == 0">
                                                            <mat-option (click)="$event.stopPropagation();">
                                                                No results
                                                            </mat-option>
                                                        </ng-container>
                                                        <ng-container *ngFor="let item of clientSpecialFeeList | excludeIds: contractClientForm!.clientFees?.value : 'clientSpecialFeeId'; trackBy: trackById">
                                                            <mat-option [value]="item.id" appPreventDoubleClick (throttledClick)="selectClientFee($event, item, clientFeeMenuTrigger)">
                                                                {{ item.internalName }}
                                                            </mat-option>
                                                        </ng-container>
                                                    </mat-select>
                                                </mat-form-field>
                                            </div>
                                        </mat-menu>
                                    </div>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </form>
            </ng-container>

            <form [formGroup]="contractsConsultantsDataForm" class="u-w--100">
                <ng-container formArrayName="consultants">
                    <ng-container *ngFor="let consultant of contractsConsultantsDataForm.consultants.controls; let consultantIndex = index" [formGroupName]="consultantIndex">
                        <div class="workflow-form--consultants u-w--100" [id]="'consultantDataAnchor' + consultantIndex">
                            <div fxLayout="column" fxLayoutAlign="start start" class="workflow-contracts--process-data u-w--100">
                                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                    <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100">
                                        <h1 class="workflow-section--header-main">Consultant data</h1>
                                        <ng-container *ngIf="consultant.value?.consultant?.id || consultant.value?.consultantNameOnly">
                                            <ng-container *ngIf="consultant.value?.consultant?.id">
                                                <img class="image-thumbnail-responsive border-rounded-50 u-ml--16 u-mr--16" [src]="consultantPhotoUrl + consultant.value?.consultant?.externalId + '.jpg'" loading="lazy" appImageFallback />
                                            </ng-container>
                                            <span class="workflow-form--consultants__name">
                                                {{consultant.value?.consultant?.name}}
                                            </span>
                                        </ng-container>
                                    </div>
                                    <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                        <span class="workflow-section--number">1</span>
                                        <h2 class="workflow-section--header">Employment type</h2>
                                    </div>
                                    <div class="workflow-section--content">
                                        <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--20">
                                            <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="33%">
                                                <mat-label>Employment type</mat-label>
                                                <mat-select [disabled]="true" required formControlName="consultantType" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                    <ng-container *ngFor="let item of employmentTypes; trackBy: trackById">
                                                        <mat-option [value]="item">
                                                            {{ item.name }}
                                                        </mat-option>
                                                    </ng-container>
                                                </mat-select>
                                                <mat-error>
                                                    <app-validator [control]="consultant.get('consultantType')"></app-validator>
                                                </mat-error>
                                            </mat-form-field>
                                        </div>
                                        <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                            <mat-form-field appearance="outline" class="formFieldNoMarginPadding client-and-consultant-autocomplete disabled-input" [fxHide]="consultant.value?.consultantType?.id === 10 || consultant.value?.consultantType?.id === 11">
                                                <mat-label>Consultant Name</mat-label>
                                                <input [disabled]="true" type="text" matInput name="consutlantNameAutocomplete" formControlName="consultant" [matAutocomplete]="consultantAutocomplete" appPreventDoubleClick (throttledClick)="$event.stopPropagation()" placeholder="Consultant name" >
                                                <mat-autocomplete #consultantAutocomplete="matAutocomplete" [displayWith]="displayConsultantNameFn">
                                                    <ng-container *ngFor="let item of filteredConsultants; trackBy: trackById">
                                                        <mat-option [value]="item" [ngClass]="{ 'no-data': item.id === undefined }" appPreventDoubleClick (throttledClick)="updateConsultantStepAnchors()">
                                                            <div class="multilineDropdown-option--row">
                                                                <ng-container *ngIf="item.id !== undefined">
                                                                    <img class="image-thumbnail-small border-rounded-50 u-mr--10" [src]="consultantPhotoUrl + item.externalId! + '.jpg'" loading="lazy" appImageFallback />
                                                                </ng-container>
                                                                <div class="multilineDropdown-option--column text-truncate-ellipsis">
                                                                    <span class="multilineDropdown-option--column-client-name">{{ item.name }}</span>
                                                                    <ng-container *ngIf="item.id !== undefined">
                                                                        <span class="multilineDropdown-option--column-client-info text-truncate-ellipsis">
                                                                            {{item.companyName ? item.companyName + ' | ' : ''}} {{item.city ? item.city + ' | ' : ''}} #{{item.id}} / {{item.legacyId}}
                                                                        </span>
                                                                    </ng-container>
                                                                </div>
                                                            </div>
                                                        </mat-option>
                                                    </ng-container>
                                                </mat-autocomplete>
                                                <mat-error>
                                                    <app-validator [control]="consultant.get('consultant')"></app-validator>
                                                </mat-error>
                                            </mat-form-field>
                                            <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding filter-select disabled-input" fxFlex="33%" [fxHide]="consultant.value?.consultantType?.id !== 10 && consultant.value?.consultantType?.id !== 11">
                                                <mat-label>Consultant Name only</mat-label>
                                                <input [disabled]="true" type="text" matInput formControlName="nameOnly" placeholder="Consultant name only">
                                                <mat-error>
                                                    <app-validator [control]="consultant.get('nameOnly')"></app-validator>
                                                </mat-error>
                                            </mat-form-field>
                                        </div>
                                        <app-consultant-information [onlyAdditionalInfo]="true" [consultantData]="consultant?.value?.consultant"></app-consultant-information>
                                    </div>
                                </div>

                                <!-- Only visible when employment type is selected and it is not 'Fee only' - id: 10 nd not 'Recruitment' - id:11 -->
                                <ng-container *ngIf="consultant.value.consultantType?.id !== 10 && consultant.value.consultantType?.id !== 11">
                                    <ng-container *ngIf="contractClientForm.clientTimeReportingCapId?.value?.id === clientTimeReportingCaps.IndividualCap">
                                        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                            <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                                <span class="workflow-section--number">2</span>
                                                <h2 class="workflow-section--header">Invoicing</h2>
                                            </div>
                                            <div class="workflow-section--content">
                                                <div fxLayout="row" fxLayoutAlign="start center" class="u-w--100 u-mb--20">
                                                    <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--12" fxFlex="22%">
                                                        <mat-label>Cap type</mat-label>
                                                        <mat-select [disabled]="true" formControlName="consultantCapOnTimeReporting" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                            <ng-container *ngFor="let item of consultantTimeReportingCapList; trackBy: trackById">
                                                                <mat-option [value]="item">
                                                                    {{ item.name }}
                                                                </mat-option>
                                                            </ng-container>
                                                        </mat-select>
                                                        <mat-error>
                                                            <app-validator [control]="consultant.get('consultantCapOnTimeReporting')"></app-validator>
                                                        </mat-error>
                                                    </mat-form-field>
                                                    <ng-container *ngIf="consultant?.value?.consultantCapOnTimeReporting?.id !== 4">
                                                        <span class="workflow-darkblue--text">
                                                            <ng-container [ngSwitch]="consultant.value.consultantCapOnTimeReporting?.id">
                                                                <ng-container *ngSwitchCase="1"> <!-- Cap on units -->
                                                                    <ng-container [ngSwitch]="consultant.value.consultantRateUnitType?.id">
                                                                        <ng-container *ngSwitchCase="1"> <!-- Per hour -->
                                                                            hours
                                                                        </ng-container>
                                                                        <ng-container *ngSwitchCase="2"> <!-- Per day -->
                                                                            days
                                                                        </ng-container>
                                                                        <ng-container *ngSwitchCase="4"> <!-- Per month -->
                                                                            months
                                                                        </ng-container>
                                                                    </ng-container>
                                                                </ng-container>
                                                                <ng-container *ngSwitchCase="2"> <!-- Cap on value -->
                                                                    {{consultant.value.consultantRateCurrency?.name}}
                                                                </ng-container>
                                                            </ng-container>
                                                        </span>
                                                    </ng-container>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>
                                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                            <span class="workflow-section--number">
                                                {{contractClientForm.clientTimeReportingCapId?.value?.id === clientTimeReportingCaps.IndividualCap ? '3' : '2'}}
                                            </span>
                                            <h2 class="workflow-section--header">Consultant contract terms</h2>
                                        </div>
                                        <div class="workflow-section--content">
                                            <h3 class="workflow-gray--header">Special Contract Terms</h3>
                                            <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100">
                                                <mat-form-field appearance="outline" class="u-w--100 formFieldNoMarginPadding textarea-input u-mr--12" fxFlex="0 0 calc(79% + 24px)" [ngClass]="{'disabled-input': readOnlyMode}">
                                                    <mat-label>Special Contract Terms</mat-label>
                                                    <textarea [disabled]="true" required matInput autocomplete="new-password" name="specialContractTerms" formControlName="specialContractTerms" [cdkTextareaAutosize]="true" [cdkAutosizeMinRows]="2">
                                                    </textarea>
                                                    <mat-error>
                                                        <app-validator [control]="consultant.get('specialContractTerms')"></app-validator>
                                                    </mat-error>
                                                </mat-form-field>
                                                <ng-container *ngIf="!readOnlyMode || consultant.get('noSpecialContractTerms')?.value">
                                                    <mat-checkbox
                                                        [disabled]="readOnlyMode"
                                                        color="accent"
                                                        formControlName="noSpecialContractTerms"
                                                        name="noSpecialContractTerms"
                                                        class="black-checkbox u-mt--10"
                                                        (change)="disableOrEnableInput(contractsConsultantsDataForm.consultants.at(consultantIndex).get('noSpecialContractTerms')?.value, contractsConsultantsDataForm.consultants.at(consultantIndex).get('specialContractTerms'))">
                                                        None
                                                    </mat-checkbox>
                                                </ng-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                            <span class="workflow-section--number">
                                                {{contractClientForm.clientTimeReportingCapId?.value?.id === clientTimeReportingCaps.IndividualCap ? '4' : '3'}}
                                            </span>
                                            <h2 class="workflow-section--header">Consultant rates and fees</h2>
                                        </div>
                                        <div class="workflow-section--content">
                                            <ng-container *ngIf="readOnlyMode; else specialRatesInput">
                                                <div class="inline-edit-form u-w--100 u-mb--10">
                                                    <ng-container *ngIf="consultant.value.specialRates?.length">
                                                        <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px" class="u-w--100 u-pl--16 u-pr--16 u-pb--10">
                                                            <span fxFlex="1 0 20%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                Rate name
                                                            </span>
                                                            <span fxFlex="20%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                Reporting unit
                                                            </span>
                                                            <ng-container *ngIf="consultant.value?.pdcPaymentEntityId !== contractClientForm.value?.pdcInvoicingEntityId">
                                                                <span fxFlex="25%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                    emagine rate
                                                                </span>
                                                            </ng-container>
                                                            <span fxFlex="25%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                Consultant rate
                                                            </span>
                                                        </div>
                                                    </ng-container>
                                                    <ng-container class="u-w--100 u-pl--16 u-pr--16">
                                                        <ng-container *ngFor="let rate of getConsultantSpecialRateControls(consultantIndex); let specialRateIndex = index">
                                                            <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px" class="workflow-contracts--list u-w--100 u-pl--16 u-pr--16">
                                                                <ng-container *ngIf="!rate.value.editable">
                                                                    <span fxFlex="1 0 20%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="rate.value.rateName" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                        {{rate.value.rateName}}
                                                                    </span>
                                                                    <span fxFlex="20%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="rate.value.reportingUnit?.name" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                        {{rate.value.reportingUnit?.name}}
                                                                    </span>
                                                                    <ng-container *ngIf="consultant.value?.pdcPaymentEntityId !== contractClientForm.value?.pdcInvoicingEntityId">
                                                                        <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item"
                                                                              [matTooltip]="rate.value.proDataRateValue !== null && rate.value.proDataRateCurrency?.name ? rate.value.proDataRateValue + ' ' + rate.value.proDataRateCurrency?.name : '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                            {{rate.value.proDataRateValue !== null && rate.value.proDataRateCurrency?.name ? rate.value.proDataRateValue + ' ' + rate.value.proDataRateCurrency?.name : '-'}}
                                                                        </span>
                                                                    </ng-container>
                                                                    <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="rate.value.consultantRateValue !== null && rate.value.consultantRateCurrency?.name ? rate.value.consultantRateValue + ' ' + rate.value.consultantRateCurrency?.name : '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                        {{rate.value.consultantRateValue !== null && rate.value.consultantRateCurrency?.name ? rate.value.consultantRateValue + ' ' + rate.value.consultantRateCurrency?.name : '-'}}
                                                                    </span>
                                                                </ng-container>
                                                            </div>
                                                        </ng-container>
                                                    </ng-container>
                                                </div>
                                            </ng-container>
                                            <ng-template #specialRatesInput>
                                                <div class="inline-edit-form u-w--100">
                                                    <ng-container *ngIf="consultant.value.specialRates?.length">
                                                        <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px" class="u-w--100 u-pl--16 u-pr--16 u-pb--10">
                                                            <span fxFlex="1 0 20%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                Rate name
                                                            </span>
                                                            <span fxFlex="20%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                Reporting unit
                                                            </span>
                                                            <ng-container *ngIf="consultant.value?.pdcPaymentEntityId !== contractClientForm.value?.pdcInvoicingEntityId">
                                                                <span fxFlex="25%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                    emagine rate
                                                                </span>
                                                            </ng-container>
                                                            <span fxFlex="25%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                Consultant rate
                                                            </span>
                                                            <span fxFlex="10%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">

                                                            </span>
                                                        </div>
                                                    </ng-container>
                                                    <ng-container formArrayName="specialRates" class="u-w--100 u-pl--16 u-pr--16">
                                                        <ng-container *ngFor="let rate of getConsultantSpecialRateControls(consultantIndex); let specialRateIndex = index" [formGroupName]="specialRateIndex">
                                                            <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px" class="workflow-contracts--list u-w--100 u-pl--16 u-pr--16">
                                                                <span fxFlex="1 0 20%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="rate.value.rateName" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                    {{rate.value.rateName}}
                                                                </span>
                                                                <span fxFlex="20%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="rate.value.reportingUnit?.name" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                    {{rate.value.reportingUnit?.name}}
                                                                </span>
                                                                <ng-container *ngIf="consultant.value?.pdcPaymentEntityId !== contractClientForm.value?.pdcInvoicingEntityId">
                                                                    <ng-container *ngIf="rate.value.editable; else consutlantProDataRateCurrencyDisplay">
                                                                        <div fxFlex="25%" fxLayout="row" fxLayoutAlign="start start">
                                                                            <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--10" fxFlex="30%">
                                                                                <input [required]="consultant.value?.pdcPaymentEntityId !== contractClientForm.value?.pdcInvoicingEntityId" matInput type="number" placeholder="Rate" formControlName="proDataRateValue">
                                                                            </mat-form-field>
                                                                            <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="50%">
                                                                                <mat-select [required]="consultant.value?.pdcPaymentEntityId !== contractClientForm.value?.pdcInvoicingEntityId" formControlName="proDataRateCurrency" placeholder="Currency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                                    <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                                        <mat-option [value]="item">
                                                                                            {{ item.name }}
                                                                                        </mat-option>
                                                                                    </ng-container>
                                                                                </mat-select>
                                                                            </mat-form-field>
                                                                        </div>
                                                                    </ng-container>
                                                                    <ng-template #consutlantProDataRateCurrencyDisplay>
                                                                        <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="rate.value.proDataRateValue !== null && rate.value.proDataRateCurrency?.name ? rate.value.proDataRateValue + ' ' + rate.value.proDataRateCurrency?.name : '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                            {{rate.value.proDataRateValue !== null && rate.value.proDataRateCurrency?.name ? rate.value.proDataRateValue + ' ' + rate.value.proDataRateCurrency?.name : '-'}}
                                                                        </span>
                                                                    </ng-template>
                                                                </ng-container>

                                                                <ng-container *ngIf="rate.value.editable; else consutlantRateCurrencyDisplay">
                                                                    <div fxFlex="25%" fxLayout="row" fxLayoutAlign="start start">
                                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--10" fxFlex="30%">
                                                                            <input required matInput type="number" placeholder="Rate" formControlName="consultantRateValue">
                                                                        </mat-form-field>
                                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="50%">
                                                                            <mat-select required formControlName="consultantRateCurrency" placeholder="Currency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                                <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                                    <mat-option [value]="item">
                                                                                        {{ item.name }}
                                                                                    </mat-option>
                                                                                </ng-container>
                                                                            </mat-select>
                                                                        </mat-form-field>
                                                                    </div>
                                                                </ng-container>

                                                                <ng-template #consutlantRateCurrencyDisplay>
                                                                    <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="rate.value.consultantRateValue !== null && rate.value.consultantRateCurrency?.name ? rate.value.consultantRateValue + ' ' + rate.value.consultantRateCurrency?.name : '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                        {{rate.value.consultantRateValue !== null && rate.value.consultantRateCurrency?.name ? rate.value.consultantRateValue + ' ' + rate.value.consultantRateCurrency?.name : '-'}}
                                                                    </span>
                                                                </ng-template>
                                                                <ng-container *ngIf="rate.value.editable; else consultantRateACtions">
                                                                    <div fxFlex="10%" class="u-w--100 text-truncate-ellipsis flex-items-center">
                                                                        <button mat-icon-button type="button" [disabled]="!rate.valid" appPreventDoubleClick (throttledClick)="editOrSaveConsultantSpecialRate(rate?.value.editable, consultantIndex, specialRateIndex)" class="rates-and-fees--inline-edit-form--btn__save">
                                                                            <mat-icon svgIcon="rates-save-icon"></mat-icon>
                                                                        </button>
                                                                        <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="cancelEditConsultantRate(consultantIndex, specialRateIndex)" class="rates-and-fees--inline-edit-form--btn__cancel">
                                                                            <mat-icon svgIcon="rates-cancel-icon"></mat-icon>
                                                                        </button>
                                                                    </div>
                                                                </ng-container>
                                                                <ng-template #consultantRateACtions>
                                                                    <div fxFlex="10%" fxLayoutAlign="center center" class="u-w--100 workflow-contracts--list-item">
                                                                        <button mat-icon-button appPreventDoubleClick (throttledClick)="$event.stopPropagation();" [matMenuTriggerFor]="clientRateMenu" class="three-dots-actions-btn">
                                                                            <mat-icon svgIcon="3-dots"></mat-icon>
                                                                        </button>
                                                                        <mat-menu #clientRateMenu>
                                                                            <button
                                                                                class="menu-item green-color"
                                                                                mat-menu-item
                                                                                [disabled]="isConsultantRateEditing"
                                                                                appPreventDoubleClick (throttledClick)="editOrSaveConsultantSpecialRate(rate.value.editable, consultantIndex, specialRateIndex)">
                                                                                <mat-icon svgIcon="edit-icon-green"></mat-icon>
                                                                                Edit
                                                                            </button>
                                                                            <button
                                                                                class="menu-item menu-item--cancel"
                                                                                mat-menu-item
                                                                                appPreventDoubleClick (throttledClick)="removeConsultantDataSpecialRate(consultantIndex, specialRateIndex)">
                                                                                <mat-icon svgIcon="close-icon"></mat-icon>
                                                                                Delete
                                                                            </button>
                                                                        </mat-menu>
                                                                    </div>
                                                                </ng-template>
                                                            </div>
                                                        </ng-container>
                                                    </ng-container>
                                                </div>
                                                <div fxLayout="row" fxLayoutAlign="start start" class="u-mb--10">
                                                    <button
                                                        [ngClass]="consultant.value.specialRates?.length > 0 ? 'button-add' : 'button-outlined'"
                                                        class="rates-and-fees--btn"
                                                        mat-flat-button
                                                        [matMenuTriggerFor]="consultantSpecialRateMenu"
                                                        [disabled]="isConsultantRateEditing"
                                                        (menuOpened)="contractsConsultantsDataForm.consultants.at(consultantIndex).get('consultantSpecialRateFilter')!.setValue(''); consultantSpecialRateSelect.open();"
                                                        #consultantRateMenuTrigger="matMenuTrigger">
                                                        <ng-container *ngIf="consultant.value.specialRates?.length">
                                                            <mat-icon>add</mat-icon>
                                                        </ng-container>
                                                        Add special rate
                                                    </button>
                                                    <mat-menu #consultantSpecialRateMenu backdropClass="add-rates-button--menu">
                                                        <div mat-menu-item appPreventDoubleClick (throttledClick)="$event.stopPropagation()" class="u-pg--0">
                                                            <mat-form-field appearance="fill" class="add-rates-button--dropdown filter-select u-w--100">
                                                                <mat-label>Choose special rate</mat-label>
                                                                <mat-select #consultantSpecialRateSelect formControlName="consultantSpecialRateFilter" [disableOptionCentering]="true">
                                                                    <ng-container *ngIf="clientSpecialRateList?.length == 0">
                                                                        <mat-option (click)="$event.stopPropagation();">
                                                                            No results
                                                                        </mat-option>
                                                                    </ng-container>
                                                                    <ng-container *ngFor="let item of clientSpecialRateList | excludeIds: consultant.value.specialRates : 'clientSpecialRateId'; trackBy: trackById">
                                                                        <mat-option [value]="item.id" appPreventDoubleClick (throttledClick)="selectConsultantSpecialRate($event, consultantIndex, item, consultantRateMenuTrigger)">
                                                                            {{ item.internalName }}
                                                                        </mat-option>
                                                                    </ng-container>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </div>
                                                    </mat-menu>
                                                </div>
                                            </ng-template>

                                            <ng-container *ngIf="readOnlyMode; else clientFeesInput">
                                                <div class="inline-edit-form u-w--100 u-mb--20">
                                                    <ng-container *ngIf="consultant.value.clientFees?.length">
                                                        <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px" class="u-w--100 u-pl--16 u-pr--16 u-pb--10">
                                                            <span fxFlex="1 0 20%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                Fee name
                                                            </span>
                                                            <span fxFlex="20%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                Frequency
                                                            </span>
                                                            <ng-container *ngIf="consultant.value?.pdcPaymentEntityId !== contractClientForm.value?.pdcInvoicingEntityId">
                                                                <span fxFlex="25%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                    emagine fee
                                                                </span>
                                                            </ng-container>
                                                            <span fxFlex="25%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                Consultant fee
                                                            </span>
                                                        </div>
                                                    </ng-container>
                                                    <ng-container class="u-w--100">
                                                        <ng-container *ngFor="let fee of getConsultantClientFeesControls(consultantIndex); let clientFeeIndex = index">
                                                            <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px"
                                                                class="workflow-contracts--list u-w--100 u-pl--16 u-pr--16">
                                                                <span fxFlex="1 0 20%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item"
                                                                    [matTooltip]="fee.value.feeName ?? '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                    {{fee.value.feeName ?? '-'}}
                                                                </span>
                                                                <span fxFlex="20%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item"
                                                                    [matTooltip]="fee.value.feeFrequency?.name ?? '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                    {{fee.value.feeFrequency?.name ?? '-'}}
                                                                </span>
                                                                <ng-container *ngIf="consultant.value?.pdcPaymentEntityId !== contractClientForm.value?.pdcInvoicingEntityId">
                                                                    <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item"
                                                                        [matTooltip]="fee.value.proDataRateValue !== null && fee.value.proDataRateCurrency?.name ? fee.value.proDataRateValue + ' ' + fee.value.proDataRateCurrency?.name : '-'"
                                                                        matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                        {{fee.value.proDataRateValue !== null && fee.value.proDataRateCurrency?.name ? fee.value.proDataRateValue +
                                                                        ' ' +
                                                                        fee.value.proDataRateCurrency?.name : '-'}}
                                                                    </span>
                                                                </ng-container>
                                                                <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item"
                                                                    [matTooltip]="fee.value.consultantRateValue !== null && fee.value.consultantRateCurrency?.name ? fee.value.consultantRateValue + ' ' + fee.value.consultantRateCurrency?.name : '-'"
                                                                    matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                    {{fee.value.consultantRateValue !== null && fee.value.consultantRateCurrency?.name ?
                                                                    fee.value.consultantRateValue + ' ' + fee.value.consultantRateCurrency?.name : '-'}}
                                                                </span>
                                                            </div>
                                                        </ng-container>
                                                    </ng-container>
                                                </div>
                                            </ng-container>
                                            <ng-template #clientFeesInput>
                                                <div class="inline-edit-form u-w--100">
                                                    <ng-container *ngIf="consultant.value.clientFees?.length">
                                                        <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px" class="u-w--100 u-pl--16 u-pr--16 u-pb--10">
                                                            <span fxFlex="1 0 20%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                Fee name
                                                            </span>
                                                            <span fxFlex="20%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                Frequency
                                                            </span>
                                                            <ng-container *ngIf="consultant.value?.pdcPaymentEntityId !== contractClientForm.value?.pdcInvoicingEntityId">
                                                                <span fxFlex="25%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                    emagine fee
                                                                </span>
                                                            </ng-container>
                                                            <span fxFlex="25%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                                Consultant fee
                                                            </span>
                                                            <span fxFlex="10%" class="workflow-contracts--list-header text-truncate-ellipsis u-w--100">
                                                            </span>
                                                        </div>
                                                    </ng-container>
                                                    <ng-container formArrayName="clientFees" class="u-w--100">
                                                        <ng-container *ngFor="let fee of getConsultantClientFeesControls(consultantIndex); let clientFeeIndex = index" [formGroupName]="clientFeeIndex">
                                                            <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px" class="workflow-contracts--list u-w--100 u-pl--16 u-pr--16">
                                                                <span fxFlex="1 0 20%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="fee.value.feeName ?? '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                    {{fee.value.feeName ?? '-'}}
                                                                </span>
                                                                <span fxFlex="20%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="fee.value.feeFrequency?.name ?? '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                    {{fee.value.feeFrequency?.name ?? '-'}}
                                                                </span>
                                                                <ng-container *ngIf="consultant.value?.pdcPaymentEntityId !== contractClientForm.value?.pdcInvoicingEntityId">
                                                                    <ng-container *ngIf="fee.value.editable; else consultantFeeProDataRateDisplay">
                                                                        <div fxFlex="25%" fxLayout="row" fxLayoutAlign="start start">
                                                                            <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--10" fxFlex="30%">
                                                                                <input [required]="consultant.value?.pdcPaymentEntityId !== contractClientForm.value?.pdcInvoicingEntityId" matInput type="number" placeholder="Rate" formControlName="proDataRateValue">
                                                                            </mat-form-field>
                                                                            <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="50%">
                                                                                <mat-select [required]="consultant.value?.pdcPaymentEntityId !== contractClientForm.value?.pdcInvoicingEntityId" formControlName="proDataRateCurrency" placeholder="Currency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                                    <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                                        <mat-option [value]="item">
                                                                                            {{ item.name }}
                                                                                        </mat-option>
                                                                                    </ng-container>
                                                                                </mat-select>
                                                                            </mat-form-field>
                                                                        </div>
                                                                    </ng-container>
                                                                    <ng-template #consultantFeeProDataRateDisplay>
                                                                        <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="fee.value.proDataRateValue !== null && fee.value.proDataRateCurrency?.name ? fee.value.proDataRateValue + ' ' + fee.value.proDataRateCurrency?.name : '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                            {{fee.value.proDataRateValue !== null && fee.value.proDataRateCurrency?.name ? fee.value.proDataRateValue + ' ' + fee.value.proDataRateCurrency?.name : '-'}}
                                                                        </span>
                                                                    </ng-template>
                                                                </ng-container>
                                                                <ng-container *ngIf="fee.value.editable; else consultantFeeRateDisplay">
                                                                    <div fxFlex="25%" fxLayout="row" fxLayoutAlign="start start">
                                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select u-mr--10" fxFlex="30%">
                                                                            <input required matInput type="number" placeholder="Rate" formControlName="consultantRateValue">
                                                                        </mat-form-field>
                                                                        <mat-form-field appearance="fill" class="u-w--100 formFieldNoMarginPadding filter-select" fxFlex="50%">
                                                                            <mat-select required formControlName="consultantRateCurrency" placeholder="Currency" [disableOptionCentering]="true" [compareWith]="compareWithFn">
                                                                                <ng-container *ngFor="let item of currencies; trackBy: trackById">
                                                                                    <mat-option [value]="item">
                                                                                        {{ item.name }}
                                                                                    </mat-option>
                                                                                </ng-container>
                                                                            </mat-select>
                                                                        </mat-form-field>
                                                                    </div>
                                                                </ng-container>
                                                                <ng-template #consultantFeeRateDisplay>
                                                                    <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="fee.value.consultantRateValue !== null && fee.value.consultantRateCurrency?.name ? fee.value.consultantRateValue + ' ' + fee.value.consultantRateCurrency?.name : '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                        {{fee.value.consultantRateValue !== null && fee.value.consultantRateCurrency?.name ? fee.value.consultantRateValue + ' ' + fee.value.consultantRateCurrency?.name : '-'}}
                                                                    </span>
                                                                </ng-template>

                                                                <ng-container *ngIf="fee.value.editable; else consultantFeeActions">
                                                                    <div fxFlex="10%" class="u-w--100 text-truncate-ellipsis flex-items-center">
                                                                        <button mat-icon-button type="button" [disabled]="!fee.valid" appPreventDoubleClick (throttledClick)="editOrSaveConsultantSpecialFee(fee.value.editable, consultantIndex, clientFeeIndex)" class="rates-and-fees--inline-edit-form--btn__save">
                                                                            <mat-icon svgIcon="rates-save-icon"></mat-icon>
                                                                        </button>
                                                                        <button mat-icon-button type="button" appPreventDoubleClick (throttledClick)="cancelEditConsultantFee(consultantIndex, clientFeeIndex)" class="rates-and-fees--inline-edit-form--btn__cancel">
                                                                            <mat-icon svgIcon="rates-cancel-icon"></mat-icon>
                                                                        </button>
                                                                    </div>
                                                                </ng-container>
                                                                <ng-template #consultantFeeActions>
                                                                    <div fxFlex="10%" fxLayoutAlign="center center" class="u-w--100 workflow-contracts--list-item">
                                                                        <button mat-icon-button appPreventDoubleClick (throttledClick)="$event.stopPropagation();" [matMenuTriggerFor]="clientFeeMenu" class="three-dots-actions-btn">
                                                                            <mat-icon svgIcon="3-dots"></mat-icon>
                                                                        </button>
                                                                        <mat-menu #clientFeeMenu>
                                                                            <button
                                                                                class="menu-item green-color"
                                                                                mat-menu-item
                                                                                [disabled]="isConsultantFeeEditing"
                                                                                appPreventDoubleClick (throttledClick)="editOrSaveConsultantSpecialFee(fee.value.editable, consultantIndex, clientFeeIndex)">
                                                                                <mat-icon svgIcon="edit-icon-green"></mat-icon>
                                                                                Edit
                                                                            </button>
                                                                            <button
                                                                                class="menu-item menu-item--cancel"
                                                                                mat-menu-item
                                                                                appPreventDoubleClick (throttledClick)="removeConsultantDataClientFees(consultantIndex, clientFeeIndex)">
                                                                                <mat-icon svgIcon="close-icon"></mat-icon>
                                                                                Delete
                                                                            </button>
                                                                        </mat-menu>
                                                                    </div>
                                                                </ng-template>
                                                            </div>
                                                        </ng-container>
                                                    </ng-container>
                                                </div>
                                                <div fxLayout="row" fxLayoutAlign="start start" class="u-mb--10">
                                                    <button
                                                        [ngClass]="consultant.value.clientFees?.length > 0 ? 'button-add' : 'button-outlined'"
                                                        class="rates-and-fees--btn"
                                                        mat-flat-button
                                                        [matMenuTriggerFor]="consultantSpecialFeeMenu"
                                                        [disabled]="isConsultantFeeEditing"
                                                        #consultantFeeMenuTrigger="matMenuTrigger"
                                                        (menuOpened)="contractsConsultantsDataForm.consultants.at(consultantIndex).get('consultantSpecialFeeFilter')!.setValue(''); consultantSpecialFeeSelect.open();">
                                                        <ng-container *ngIf="consultant.value.clientFees?.length">
                                                            <mat-icon>add</mat-icon>
                                                        </ng-container>
                                                        Add special fees
                                                    </button>
                                                    <mat-menu #consultantSpecialFeeMenu backdropClass="add-rates-button--menu">
                                                        <div mat-menu-item appPreventDoubleClick (throttledClick)="$event.stopPropagation()" class="u-pg--0">
                                                            <mat-form-field appearance="fill" class="add-rates-button--dropdown filter-select u-w--100">
                                                                <mat-label>Choose special fee</mat-label>
                                                                <mat-select #consultantSpecialFeeSelect formControlName="consultantSpecialFeeFilter" [disableOptionCentering]="true">
                                                                    <ng-container *ngIf="clientSpecialFeeList?.length == 0">
                                                                        <mat-option (click)="$event.stopPropagation();">
                                                                            No results
                                                                        </mat-option>
                                                                    </ng-container>
                                                                    <ng-container *ngFor="let item of clientSpecialFeeList | excludeIds: consultant.value.clientFees : 'clientSpecialFeeId'; trackBy: trackById">
                                                                        <mat-option [value]="item.id" appPreventDoubleClick (throttledClick)="selectConsultantSpecialFee($event, consultantIndex, item, consultantFeeMenuTrigger)">
                                                                            {{ item.internalName }}
                                                                        </mat-option>
                                                                    </ng-container>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </div>
                                                    </mat-menu>
                                                </div>
                                            </ng-template>
                                        </div>
                                    </div>
                                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                            <span class="workflow-section--number">
                                                {{contractClientForm.clientTimeReportingCapId?.value?.id === clientTimeReportingCaps.IndividualCap ? '4' : '3'}}
                                            </span>
                                            <h2 class="workflow-section--header">Project lines</h2>
                                        </div>
                                        <div class="workflow-section--content">
                                            <div class="inline-edit-form u-w--100" [ngClass]="{'u-mb--10': readOnlyMode}">
                                                <ng-container *ngIf="consultant.value.projectLines?.length">
                                                    <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="10px" class="u-w--100 u-pl--50 u-pr--16 u-pb--10">
                                                        <span fxFlex="5%" class="workflow-contracts--list-header text-truncate-ellipsis">
                                                            Id
                                                        </span>
                                                        <span fxFlex="25%" class="workflow-contracts--list-header text-truncate-ellipsis">
                                                            Project name
                                                        </span>
                                                        <span fxFlex="25%" class="workflow-contracts--list-header text-truncate-ellipsis">
                                                            Assignment ID/PO No
                                                        </span>
                                                        <span fxFlex="10%" class="workflow-contracts--list-header text-truncate-ellipsis">
                                                            Start date
                                                        </span>
                                                        <span fxFlex="10%" class="workflow-contracts--list-header text-truncate-ellipsis">
                                                            End date
                                                        </span>
                                                        <span fxFlex="1 0 15%" class="workflow-contracts--list-header text-truncate-ellipsis">
                                                            Optional Invoicing Info
                                                        </span>
                                                        <span fxFlex="5%" class="workflow-contracts--list-header text-truncate-ellipsis">
                                                            Fees
                                                        </span>
                                                        <ng-container *ngIf="!readOnlyMode">
                                                            <span fxFlex="5%"></span>
                                                        </ng-container>
                                                    </div>
                                                </ng-container>
                                                <ng-container class="u-w--100" formArrayName="projectLines">
                                                    <mat-accordion [multi]="true" class="project-line--expansion mat-elevation-z0" togglePosition="before">
                                                        <ng-container *ngFor="let projectLine of getConsultantProjectLinesControls(consultantIndex); let projectLinesIndex = index" [formGroupName]="projectLinesIndex">
                                                            <mat-expansion-panel class="mat-elevation-z0">
                                                                <mat-expansion-panel-header>
                                                                    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px"
                                                                        class="u-w--100">
                                                                        <span fxFlex="5%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="projectLine.value.id ?? '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                            {{projectLine.value.id ?? '-'}}
                                                                        </span>
                                                                        <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="projectLine.value.projectName ?? '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                            {{projectLine.value.projectName && projectLine.value.projectName !== '' ? projectLine.value.projectName : '-'}}
                                                                        </span>
                                                                        <span fxFlex="25%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="projectLine.value.invoicingReferenceNumber ?? '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                            {{projectLine.value.invoicingReferenceNumber && projectLine.value.invoicingReferenceNumber !== '' ? projectLine.value.invoicingReferenceNumber : '-'}}
                                                                        </span>
                                                                        <span fxFlex="10%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="projectLine.value.startDate ? (projectLine.value.startDate | momentFormat) : '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                            {{projectLine.value.startDate ? (projectLine.value.startDate | momentFormat) : '-'}}
                                                                        </span>
                                                                        <span fxFlex="10%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="projectLine.value.endDate ? (projectLine.value.endDate | momentFormat) : '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                            {{projectLine.value.endDate ? (projectLine.value.endDate | momentFormat) : '-'}}
                                                                        </span>
                                                                        <span fxFlex="1 0 15%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item" [matTooltip]="projectLine.value.optionalInvoicingInfo ?? '-'" matTooltipClass="white-tooltip" appShowIfTruncated>
                                                                            {{projectLine.value.optionalInvoicingInfo && projectLine.value.optionalInvoicingInfo !== '' ? projectLine.value.optionalInvoicingInfo : '-'}}
                                                                        </span>
                                                                        <span fxFlex="5%" class="u-w--100 text-truncate-ellipsis workflow-contracts--list-item">
                                                                            <ng-container *ngIf="projectLine.value.isLineForFees; else noFeesBilledTemplate">
                                                                                <div fxLayout="row" fxLayoutAlign="start center" [matTooltip]="projectLine.value.isLineForFees ? 'Fees billed with this Project line' : '-'" matTooltipClass="white-tooltip">
                                                                                    <mat-icon svgIcon="check-circle-fill"></mat-icon>
                                                                                </div>
                                                                            </ng-container>
                                                                            <ng-template #noFeesBilledTemplate>
                                                                                -
                                                                            </ng-template>
                                                                        </span>
                                                                        <ng-container *ngIf="!readOnlyMode">
                                                                            <div fxFlex="5%" fxLayoutAlign="end center" class="u-w--100 workflow-contracts--list-item">
                                                                                <button mat-icon-button appPreventDoubleClick (throttledClick)="$event.stopPropagation();" #projectLinesMenuTrigger="matMenuTrigger" [matMenuTriggerFor]="consultantProjectLineMenu" class="three-dots-actions-btn">
                                                                                    <mat-icon svgIcon="3-dots"></mat-icon>
                                                                                </button>
                                                                                <mat-menu #consultantProjectLineMenu>
                                                                                    <button
                                                                                        class="menu-item green-color"
                                                                                        mat-menu-item
                                                                                        (click)="duplicateProjectLine(consultantIndex, projectLinesIndex)">
                                                                                        <mat-icon svgIcon="duplicate-icon-green"></mat-icon>
                                                                                        Duplicate
                                                                                    </button>
                                                                                    <button
                                                                                        class="menu-item green-color"
                                                                                        mat-menu-item
                                                                                        (click)="createOrEditProjectLine(consultantIndex, projectLinesMenuTrigger, projectLinesIndex)">
                                                                                        <mat-icon svgIcon="edit-icon-green"></mat-icon>
                                                                                        Edit
                                                                                    </button>
                                                                                    <ng-container *ngIf="!projectLine.value.wasSynced">
                                                                                        <button
                                                                                            class="menu-item menu-item--cancel"
                                                                                            mat-menu-item
                                                                                            (click)="removeConsultantDataProjectLines(consultantIndex, projectLinesIndex)">
                                                                                            <mat-icon svgIcon="close-icon"></mat-icon>
                                                                                            Delete
                                                                                        </button>
                                                                                    </ng-container>
                                                                                    <ng-container *ngIf="projectLine.value.wasSynced">
                                                                                        <div class="menu-item" mat-menu-item (click)="$event.stopPropagation(); toggleMarkProjectLineForDeletion(projectLine.value.markedForLegacyDeletion, consultantIndex, projectLinesIndex)">
                                                                                            <mat-checkbox color="accent" class="black-checkbox" id="markedForLegacyDeletion" name="markedForLegacyDeletion"
                                                                                                formControlName="markedForLegacyDeletion" (click)="$event.stopPropagation();">
                                                                                                Mark for deletion in legacy
                                                                                            </mat-checkbox>
                                                                                        </div>
                                                                                    </ng-container>
                                                                                </mat-menu>
                                                                            </div>
                                                                        </ng-container>
                                                                    </div>
                                                                </mat-expansion-panel-header>
                                                                <div fxLayout="row" class="project-line--expansion-additional">
                                                                    <span fxFlex="15%" class="project-line--expansion-additional__header">Project name</span>
                                                                    <span class="project-line--expansion-additional__content">
                                                                        {{projectLine.value.projectName && projectLine.value.projectName !== '' ? projectLine.value.projectName : '-'}}
                                                                    </span>
                                                                </div>
                                                                <div fxLayout="row"  class="project-line--expansion-additional">
                                                                    <span fxFlex="15%" class="project-line--expansion-additional__header">Invoicing ref person</span>
                                                                    <span class="project-line--expansion-additional__content">
                                                                        <ng-container *ngIf="projectLine.value.invoicingReferencePerson?.id && projectLine.value.invoicingReferencePerson !== ''; else invoicingReferencePersonFreeText">
                                                                            {{projectLine.value.invoicingReferencePerson?.firstName ? (projectLine.value.invoicingReferencePerson?.firstName + ' ' + projectLine.value.invoicingReferencePerson?.lastName) : '-'}}
                                                                        </ng-container>
                                                                        <ng-template #invoicingReferencePersonFreeText>
                                                                            {{projectLine.value.invoicingReferencePerson && projectLine.value.invoicingReferencePerson !== '' ? projectLine.value.invoicingReferencePerson : '-'}}
                                                                        </ng-template>
                                                                    </span>
                                                                </div>
                                                                <div fxLayout="row" class="project-line--expansion-additional">
                                                                    <span fxFlex="15%" class="project-line--expansion-additional__header">Debitor number</span>
                                                                    <span class="project-line--expansion-additional__content">
                                                                        {{projectLine.value.debtorNumber && projectLine.value.debtorNumber !== '' ? projectLine.value.debtorNumber : '-'}}
                                                                    </span>
                                                                </div>
                                                                <div fxLayout="row" class="project-line--expansion-additional">
                                                                    <span fxFlex="15%" class="project-line--expansion-additional__header">Invoice recipient</span>
                                                                    <div fxLayout="column" class="project-line--expansion-additional__content">
                                                                        <ng-container *ngIf="projectLine.value.invoiceRecipient !== null && projectLine.value.invoiceRecipient !== ''; else noInvoiceRecipientTemplate">
                                                                            <span class="text-bold">{{projectLine.value.invoiceRecipient?.clientName}}</span>
                                                                            <span>
                                                                                {{projectLine.value.invoiceRecipient?.countryName ? projectLine.value.invoiceRecipient?.countryName + '| ' : ''}}
                                                                                {{projectLine.value.invoiceRecipient?.city ? projectLine.value.invoiceRecipient?.city + ' | ' : ''}}
                                                                                {{projectLine.value.invoiceRecipient?.address ? projectLine.value.invoiceRecipient?.address + ' | ' : ''}}
                                                                                {{projectLine.value.invoiceRecipient?.address2 ? projectLine.value.invoiceRecipient?.address2 + ' | ' : ''}}
                                                                                {{projectLine.value.invoiceRecipient?.postCode}}
                                                                            </span>
                                                                        </ng-container>
                                                                    </div>
                                                                    <ng-template #noInvoiceRecipientTemplate>
                                                                        -
                                                                    </ng-template>
                                                                </div>
                                                                <div fxLayout="row" class="project-line--expansion-additional">
                                                                    <span fxFlex="15%" class="project-line--expansion-additional__header">Insurance</span>
                                                                    <span class="project-line--expansion-additional__content">
                                                                        {{projectLine.value.consultantInsuranceOptionId ? consultantInsuranceOptions[projectLine.value.consultantInsuranceOptionId] : '-'}}
                                                                    </span>
                                                                </div>
                                                                <div fxLayout="row" class="project-line--expansion-additional">
                                                                    <span fxFlex="15%" class="project-line--expansion-additional__header">Fees</span>
                                                                    <span class="project-line--expansion-additional__content">
                                                                        <ng-container *ngIf="projectLine.value.isLineForFees; else noFeesBilledTemplate">
                                                                            <div fxLayout="row" fxLayoutAlign="start center">
                                                                                <mat-icon svgIcon="check-circle-fill" class="project-line--expansion-additional--fees-icon u-mr--10"></mat-icon> Billed with this Project line
                                                                            </div>
                                                                        </ng-container>
                                                                        <ng-template #noFeesBilledTemplate>
                                                                            -
                                                                        </ng-template>
                                                                    </span>
                                                                </div>
                                                                <div fxLayout="row" class="project-line--expansion-additional">
                                                                    <span fxFlex="15%" class="project-line--expansion-additional__header">Changed</span>
                                                                    <span class="project-line--expansion-additional__content">
                                                                        {{projectLine.value.modificationDate ? (projectLine.value.modificationDate | momentFormat) : '-'}}
                                                                    </span>
                                                                </div>
                                                                <div fxLayout="row" class="project-line--expansion-additional">
                                                                    <span fxFlex="15%" class="project-line--expansion-additional__header">Status</span>
                                                                    <span class="project-line--expansion-additional__content">
                                                                        {{projectLine.value.markedForLegacyDeletion ? 'Delete from sync' : projectLine.value.wasSynced ? 'Synced' : 'Not synced'}}
                                                                    </span>
                                                                </div>
                                                                <div fxLayout="row" class="project-line--expansion-additional">
                                                                    <span fxFlex="15%" class="project-line--expansion-additional__header">Optional info</span>
                                                                    <span class="project-line--expansion-additional__content">
                                                                        {{projectLine.value.optionalInvoicingInfo && projectLine.value.optionalInvoicingInfo !== '' ? projectLine.value.optionalInvoicingInfo : '-'}}
                                                                    </span>
                                                                </div>
                                                            </mat-expansion-panel>
                                                        </ng-container>
                                                    </mat-accordion>
                                                </ng-container>
                                            </div>
                                            <ng-container *ngIf="!readOnlyMode">
                                                <div fxLayout="row" fxLayoutAlign="start start" class="u-mb--10">
                                                    <button [ngClass]="consultant.value.projectLines?.length > 0 ? 'button-add' : 'button-outlined'" class="rates-and-fees--btn" mat-flat-button appPreventDoubleClick (throttledClick)="createOrEditProjectLine(consultantIndex)">
                                                        <ng-container *ngIf="consultant.value.projectLines?.length">
                                                            <mat-icon>add</mat-icon>
                                                        </ng-container>
                                                        Add project line
                                                    </button>
                                                </div>
                                            </ng-container>
                                        </div>
                                    </div>
                                </ng-container>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
            </form>

            <form [formGroup]="contractsSyncDataForm" id="syncLegalContractAnchor"
                class="workflow-form workflow-form--main u-w--100">
                <div fxLayout="column" fxLayoutAlign="start start" class="workflow-contracts--process-data u-w--100">
                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                        <h1 class="workflow-section--header-main">Sync & legal contracts</h1>
                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                            <span class="workflow-section--number">1</span>
                            <h2 class="workflow-section--header">Sync</h2>
                        </div>
                        <div class="workflow-section--content">
                            <ng-container *ngIf="readOnlyMode; else syncInput">
                                <ng-container *ngTemplateOutlet="syncStatus"></ng-container>
                                <mat-divider class="u-w--100"></mat-divider>
                            </ng-container>
                            <ng-template #syncInput>
                                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                    <button class="button-accept u-mb--10" mat-flat-button appPreventDoubleClick (throttledClick)="processSyncToLegacySystem()">
                                        Sync to legacy system
                                    </button>
                                    <ng-container *ngTemplateOutlet="syncStatus"></ng-container>

                                    <ng-container *ngIf="statusAfterSync">
                                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mb--10" [ngClass]="{'mat-form-field-invalid': validationTriggered && syncNotPossible}">
                                            <mat-icon class="u-mr--5" [ngClass]="{'icon-cancel': syncNotPossible}" [svgIcon]="syncNotPossible ? 'cancel-fill' : 'completed-icon'"></mat-icon>
                                            <span class="sync-hint-text">
                                                {{syncMessage}}
                                            </span>
                                        </div>
                                    </ng-container>
                                    <ng-container *ngIf="contractsSyncDataForm.showManualOption?.value">
                                        <div fxLayout="row" fxLayoutAlign="start start" class="u-w--100 u-mb--20">
                                            <mat-checkbox color="accent" formControlName="contractLinesDoneManuallyInOldPm" name="contractLinesDoneManuallyInOldPm" class="black-checkbox u-mt--10">
                                                Contract lines done manually in old PM
                                            </mat-checkbox>
                                        </div>
                                    </ng-container>
                                </div>
                                <mat-divider class="u-w--100"></mat-divider>
                            </ng-template>
                        </div>
                    </div>
                    <ng-container *ngIf="activeSideSection.typeId !== workflowSideSections.StartConsultantPeriod">
                        <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                            <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                                <span class="workflow-section--number">2</span>
                                <h2 class="workflow-section--header">Client legal contract</h2>
                            </div>
                            <div class="workflow-section--content">
                                <ng-container *ngIf="readOnlyMode; else legalContractsInput">
                                    <h3 class="workflow-gray--header u-mb--10">Client legal contracts</h3>
                                    <div fxLayout="row" fxLayoutAlign="start start" class="u-mb--20">
                                        <mat-icon class="u-mr--5" [ngClass]="{'icon-cancel': contractsSyncDataForm.clientLegalContractDoneStatusId?.value === 0}" [svgIcon]="detectContractModuleIcon(contractsSyncDataForm.clientLegalContractDoneStatusId?.value)"></mat-icon>
                                        <div fxLayout="column" fxLayoutAlign="start start">
                                            <span class="workflow-darkblue--text">Contract module for client</span>
                                            <ng-container *ngIf="legalContractStatuses !== undefined && legalContractStatuses !== null">
                                                <span class="sync-hint-text">
                                                    {{legalContractStatuses[contractsSyncDataForm.clientLegalContractDoneStatusId?.value]}}
                                                </span>
                                            </ng-container>
                                        </div>
                                    </div>
                                </ng-container>
                                <ng-template #legalContractsInput>
                                    <div fxLayout="column" fxLayoutAlign="start start" class="u-mb--20">
                                        <span [ngClass]="{'workflow-gray--header': readOnlyMode, 'workflow-darkblue--text': !readOnlyMode}">Client legal contracts</span>
                                        <div fxlayout="row" fxLayoutAlign="start center" class="u-mb--10 u-mt--10">
                                            <button class="button-accept u-mr--20" appPreventDoubleClick (throttledClick)="openContractModule(periodId!, contractsSyncDataForm.clientLegalContractDoneStatusId?.value, false, contractClientForm.pdcInvoicingEntityId?.value)" mat-flat-button [disabled]="!contractsSyncDataForm.enableLegalContractsButtons?.value">
                                                Open contract module for client
                                            </button>
                                            <ng-container *ngIf="activeSideSection.typeId === workflowSideSections.ChangeClientPeriod">
                                                <mat-checkbox color="accent" formControlName="newLegalContract" name="newLegalContract" class="black-checkbox u-mt--10">
                                                    New legal contract needed
                                                </mat-checkbox>
                                            </ng-container>
                                        </div>
                                        <ng-container *ngIf="contractsSyncDataForm.clientLegalContractDoneStatusId?.value !== 0">
                                            <div fxLayout="row" fxLayoutAlign="start center" class="u-mb--20">
                                                <mat-icon class="u-mr--5" [ngClass]="{'icon-cancel': contractsSyncDataForm.clientLegalContractDoneStatusId?.value === 0}" [svgIcon]="detectContractModuleIcon(contractsSyncDataForm.clientLegalContractDoneStatusId?.value)"></mat-icon>
                                                <ng-container *ngIf="legalContractStatuses !== undefined && legalContractStatuses !== null">
                                                    <span class="sync-hint-text">
                                                        {{legalContractStatuses[contractsSyncDataForm.clientLegalContractDoneStatusId?.value]}}
                                                    </span>
                                                </ng-container>
                                            </div>
                                        </ng-container>
                                    </div>
                                </ng-template>
                            </div>
                        </div>
                    </ng-container>
                    <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                        <div fxLayout="row" fxLayoutAlign="start center" class="u-mt--16 u-mb--16">
                            <span class="workflow-section--number">
                                {{activeSideSection.typeId !== workflowSideSections.StartConsultantPeriod ? '3' : '2'}}
                            </span>
                            <h2 class="workflow-section--header">Consultant legal contract</h2>
                        </div>
                        <div class="workflow-section--content">
                            <div fxLayout="column" fxLayoutAlign="start start" class="u-mb--20">
                                <ng-container formArrayName="consultants">
                                    <ng-container *ngFor="let consultant of contractsSyncDataForm.consultants.controls; let consultantIndex = index" [formGroupName]="consultantIndex" >
                                        <div class="workflow-form--consultants u-w--100">
                                            <span class="u-mt--20" [ngClass]="{'workflow-gray--header': readOnlyMode, 'workflow-darkblue--text': !readOnlyMode}">Consultant legal contracts</span>
                                            <app-consultant-information [consultantData]="consultant?.value?.consultant"></app-consultant-information>
                                            <ng-template #consultantNameOnly>
                                                <p class="workflow-contracts--consultant-name">
                                                    {{consultant.value?.nameOnly}}
                                                </p>
                                            </ng-template>
                                            <ng-container *ngIf="readOnlyMode">
                                                <div fxLayout="column" fxLayoutAlign="start start" class="u-w--100">
                                                    <ng-container *ngIf="(contractClientForm.pdcInvoicingEntityId?.value !== consultant?.value?.pdcPaymentEntityId)">
                                                        <div fxLayout="row" fxLayoutAlign="start center">
                                                            <mat-icon class="u-mr--5" [ngClass]="{'icon-cancel': consultant.value?.internalLegalContractDoneStatusId === 0}" [svgIcon]="detectContractModuleIcon(consultant.value?.internalLegalContractDoneStatusId)"></mat-icon>
                                                            <div fxLayout="column" fxLayoutAlign="start start">
                                                                <span class="workflow-darkblue--text">Internal legal contract module for consultant</span>
                                                                <ng-container *ngIf="legalContractStatuses !== undefined && legalContractStatuses !== null">
                                                                    <span class="sync-hint-text">
                                                                        {{legalContractStatuses[consultant.value?.internalLegalContractDoneStatusId]}}
                                                                    </span>
                                                                </ng-container>
                                                            </div>
                                                        </div>
                                                    </ng-container>
                                                    <div fxLayout="row" fxLayoutAlign="start center">
                                                        <mat-icon class="u-mr--5" [ngClass]="{'icon-cancel': consultant.value?.consultantLegalContractDoneStatusId === 0}" [svgIcon]="detectContractModuleIcon(consultant.value?.consultantLegalContractDoneStatusId)"></mat-icon>
                                                        <div fxLayout="column" fxLayoutAlign="start start">
                                                            <span class="workflow-darkblue--text">Legal contract module for consultant</span>
                                                            <ng-container *ngIf="legalContractStatuses !== undefined && legalContractStatuses !== null">
                                                                <span class="sync-hint-text">
                                                                    {{legalContractStatuses[consultant?.value?.consultantLegalContractDoneStatusId]}}
                                                                </span>
                                                            </ng-container>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-container>
                                            <ng-container *ngIf="!readOnlyMode && (contractClientForm.pdcInvoicingEntityId?.value !== consultant?.value?.pdcPaymentEntityId)">
                                                <div fxlayout="row" fxLayoutAlign="start center" class="u-mb--10">
                                                    <button class="button-outlined  u-mr--20" mat-flat-button [disabled]="!contractsSyncDataForm.enableLegalContractsButtons?.value" appPreventDoubleClick (throttledClick)="openContractModule(consultant.value?.consultantPeriodId!, consultant.value?.internalLegalContractDoneStatusId, true, contractClientForm.pdcInvoicingEntityId?.value, consultant.value.consultant)">
                                                        Open contract module for internal contract
                                                    </button>
                                                </div>
                                            </ng-container>
                                            <ng-container *ngIf="!readOnlyMode && consultant.value?.internalLegalContractDoneStatusId !== 0 && (contractClientForm.pdcInvoicingEntityId?.value !== consultant?.value?.pdcPaymentEntityId)">
                                                <div fxLayout="row" fxLayoutAlign="start center" class="u-mb--20">
                                                    <mat-icon class="u-mr--5" [ngClass]="{'icon-cancel': consultant.value?.internalLegalContractDoneStatusId === 0}" [svgIcon]="detectContractModuleIcon(consultant.value?.internalLegalContractDoneStatusId)"></mat-icon>
                                                    <div fxLayout="column" fxLayoutAlign="start start">
                                                        <ng-container *ngIf="legalContractStatuses !== undefined && legalContractStatuses !== null">
                                                            <span class="sync-hint-text">
                                                                {{legalContractStatuses[consultant?.value?.internalLegalContractDoneStatusId]}}
                                                            </span>
                                                        </ng-container>
                                                    </div>
                                                </div>
                                            </ng-container>
                                            <ng-container *ngIf="!readOnlyMode">
                                                <div fxlayout="row" fxLayoutAlign="start center" class="u-mb--10">
                                                    <button class="button-outlined  u-mr--20" mat-flat-button [disabled]="!contractsSyncDataForm.enableLegalContractsButtons?.value" appPreventDoubleClick (throttledClick)="openContractModule(consultant.value?.consultantPeriodId!, consultant.value?.consultantLegalContractDoneStatusId, false, consultant?.value?.pdcPaymentEntityId, consultant.value.consultant)">
                                                        Open contract module for consultant
                                                    </button>
                                                    <ng-container *ngIf="activeSideSection.typeId === workflowSideSections.ChangeClientPeriod">
                                                        <mat-checkbox color="accent" formControlName="newLegalContract" name="newLegalContract" class="black-checkbox u-mt--10">
                                                            New legal contract needed
                                                        </mat-checkbox>
                                                    </ng-container>
                                                </div>
                                            </ng-container>
                                            <ng-container *ngIf="!readOnlyMode && consultant.value?.consultantLegalContractDoneStatusId !== 0">
                                                <div fxLayout="row" fxLayoutAlign="start center" class="u-mb--20">
                                                    <mat-icon class="u-mr--5" [ngClass]="{'icon-cancel': consultant.value?.consultantLegalContractDoneStatusId === 0}" [svgIcon]="detectContractModuleIcon(consultant.value?.consultantLegalContractDoneStatusId)"></mat-icon>
                                                    <div fxLayout="column" fxLayoutAlign="start start">
                                                        <ng-container *ngIf="legalContractStatuses !== undefined && legalContractStatuses !== null">
                                                            <span class="sync-hint-text">
                                                                {{legalContractStatuses[consultant?.value?.consultantLegalContractDoneStatusId]}}
                                                            </span>
                                                        </ng-container>
                                                    </div>
                                                </div>
                                            </ng-container>
                                        </div>
                                    </ng-container>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </ng-container>
    </ng-container>
</div>

<ng-template #syncStatus>
    <ng-container *ngIf="!statusAfterSync">
        <div fxLayout="row" fxLayoutAlign="start center" class="u-mb--20 u-w--100"
            [ngClass]="{'mat-form-field-invalid': validationTriggered && contractsSyncDataForm.value.isNewSyncNeeded}">
            <mat-icon class="u-mr--5" [ngClass]="{'icon-cancel': contractsSyncDataForm.value?.isNewSyncNeeded}" [svgIcon]="contractsSyncDataForm.value.isNewSyncNeeded ? 'cancel-fill' : 'completed-icon'"></mat-icon>
            <span class="workflow-darkblue--text">
                {{contractsSyncDataForm.value.isNewSyncNeeded ? "New sync needed. " : ""}} {{contractsSyncDataForm.value.lastSyncedDate !== null && contractsSyncDataForm.value.lastSyncedDate !== undefined ? ("Last synced at " + (contractsSyncDataForm.value.lastSyncedDate | momentFormat: 'DD.MM.YYYY HH:mm')) : ""}}
            </span>
        </div>
    </ng-container>
</ng-template>
