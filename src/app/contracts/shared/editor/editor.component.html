<div class="versions">
	<mat-form-field class="dropdown" appearance="fill" floatLabel="never">
		<mat-select [formControl]="selectedVersionControl" placeholder="version">
			<mat-option *ngFor="let template of templateVersions$ | async" [value]="template.version">
				<b>Version {{ template.version }}</b> - {{template.createdDateUtc | momentFormat}}
			</mat-option>
		</mat-select>
	</mat-form-field>
</div>

<ng-container *ngIf="selectedVersion?.isCurrent">
	<p class="current">Current</p>
</ng-container>

<div richEditor class="editor" (saved)="saveAsComplete()"></div>
<div class="comment-sidebar">
	<app-comment-sidebar
		@inOutPaneAnimation
		*ngIf="commentSidebarEnabled$ | async"
		[entities]="comments$ | async"
		(created)="createComment($event)"
		(deleted)="deleteComment($event)"
		(edited)="editComment($event)">
	</app-comment-sidebar>
</div>
<app-insert-merge-field-popup [fields]="mergeFields$ | async" (mergeField)="mergeSelectedField($event)">
</app-insert-merge-field-popup>
<app-compare-select-version-popup
	[dataSource]="templateVersions$ | async"
	(select)="loadCompareTemplateByVersion($event)"></app-compare-select-version-popup>
<app-compare-select-document-popup
	[dataSource]="documentList$ | async"
	(select)="loadCompareDocumentTemplate($event)"></app-compare-select-document-popup>

	<!-- *ngIf="hasUnsavedChanges$ | async" -->
<ng-container>
	<ng-container *ngIf="selectedVersion?.isCurrent; else isDraft">
		<div class="save-actions">
			<button mat-button color="accent" (click)="cancel()">Cancel</button>
	
			<ng-container *ngIf="!(isAgreement$ | async)">
				<button [disabled]="isLoading" mat-stroked-button color="primary" (click)="saveCurrentAsDraft()">Save as a new version</button>
			</ng-container>
			<ng-container *ngIf="isAgreement$ | async">
				<button [disabled]="isLoading" mat-stroked-button color="primary" (click)="saveCurrentAsComplete(true)">Save as a new version</button>
			</ng-container>
	
			<ng-container *ngIf="!(isAgreement$ | async)">
				<button mat-flat-button color="primary" (click)="saveCurrentAsComplete(false)">Save</button>
			</ng-container>
		</div>
	</ng-container>
</ng-container>

<ng-template #isDraft>
	<div class="save-actions">
		<button [disabled]="isLoading" mat-button color="accent" (click)="cancel()">Cancel</button>

		<button [disabled]="isLoading" mat-stroked-button color="primary" (click)="saveDraftAsDraft()">Save as a draft</button>

		<button [disabled]="isLoading" *ngIf="!(isAgreement$ | async)" mat-flat-button color="primary" (click)="saveDraftAsComplete()">Complete</button>
	</div>
</ng-template>